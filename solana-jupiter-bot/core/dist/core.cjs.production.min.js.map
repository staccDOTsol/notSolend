{"version":3,"file":"core.cjs.production.min.js","sources":["../src/lib/idl/jupiter.ts","../src/constants.ts","../src/utils/layout.ts","../src/lib/cropper/swapLayout.ts","../src/lib/jupiterInstruction.ts","../src/lib/saber/saberAddDecimalsAmm.ts","../src/utils/getTwoPermutations.ts","../src/utils/chunks.ts","../src/utils/chunkedGetMultipleAccountInfos.ts","../src/lib/amm.ts","../src/lib/raydium/pools.ts","../src/lib/raydium/raydiumAmm.ts","../src/lib/serum/market.ts","../src/lib/serum/serumAmm.ts","../src/lib/split-trade/splitTradeAmm.ts","../src/lib/market.ts","../src/lib/saber/saberAmm.ts","../src/lib/aldrin/percentage.ts","../src/lib/aldrin/poolState.ts","../src/lib/aldrin/aldrinAmm.ts","../src/lib/spl-token-swap/splTokenSwapPools.ts","../src/lib/spl-token-swap/tokenSwapLayout.ts","../src/lib/spl-token-swap/splTokenSwapAmm.ts","../src/lib/mercurial/swapLayout.ts","../src/lib/mercurial/mercurialAmm.ts","../src/lib/cropper/cropperAmm.ts","../src/lib/crema/swapLayout.ts","../src/lib/crema/cremaAmm.ts","../src/lib/sencha/swapLayout.ts","../src/lib/sencha/senchaAmm.ts","../src/lib/lifinity/lifinityAmm.ts","../src/lib/lifinity/swapLayout.ts","../src/lib/whirlpool/whirlpoolAmm.ts","../src/lib/cykura/solanaTickDataProvider.ts","../src/lib/cykura/cykuraAmm.ts","../src/lib/routes.ts","../src/utils/token.ts","../src/utils/instruction.ts","../src/lib/routeToInstructions.ts","../src/lib/serum/openOrders.ts","../src/lib/fee.ts","../src/utils/TransactionBuilder.ts","../src/utils/Owner.ts","../src/utils/wait.ts","../src/utils/transactionHelpers.ts","../src/utils/cartesian.ts","../src/lib/computeRouteInfos.ts","../src/utils/tx/errors.ts","../src/lib/jupiter.ts","../src/lib/ammFactory.ts","../src/lib/getTopTokens.ts"],"sourcesContent":["export type Jupiter = {\n  version: '0.1.0';\n  name: 'jupiter';\n  instructions: [\n    {\n      name: 'mercurialExchange';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'swapState';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'poolAuthority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'userTransferAuthority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'sourceTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'destinationTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'saberExchange';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'swap';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'swapAuthority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'userAuthority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'clock';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'inputUserAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'inputTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'outputUserAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'outputTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'feesTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'saberSwap';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'swap';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'swapAuthority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'userAuthority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'inputUserAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'inputTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'outputUserAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'outputTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'feesTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'saberAddDecimalsDeposit';\n      accounts: [\n        {\n          name: 'addDecimalsProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'wrapper';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'wrapperMint';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'wrapperUnderlyingTokens';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'owner';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'userUnderlyingTokens';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userWrappedTokens';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'saberAddDecimalsWithdraw';\n      accounts: [\n        {\n          name: 'addDecimalsProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'wrapper';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'wrapperMint';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'wrapperUnderlyingTokens';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'owner';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'userUnderlyingTokens';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userWrappedTokens';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'senchaExchange';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'swap';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userAuthority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'inputUserAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'inputTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'inputFeesAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'outputUserAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'outputTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'outputFeesAccount';\n          isMut: true;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'serumSwap';\n      accounts: [\n        {\n          name: 'market';\n          accounts: [\n            {\n              name: 'market';\n              isMut: true;\n              isSigner: false;\n            },\n            {\n              name: 'openOrders';\n              isMut: true;\n              isSigner: false;\n            },\n            {\n              name: 'requestQueue';\n              isMut: true;\n              isSigner: false;\n            },\n            {\n              name: 'eventQueue';\n              isMut: true;\n              isSigner: false;\n            },\n            {\n              name: 'bids';\n              isMut: true;\n              isSigner: false;\n            },\n            {\n              name: 'asks';\n              isMut: true;\n              isSigner: false;\n            },\n            {\n              name: 'coinVault';\n              isMut: true;\n              isSigner: false;\n            },\n            {\n              name: 'pcVault';\n              isMut: true;\n              isSigner: false;\n            },\n            {\n              name: 'vaultSigner';\n              isMut: false;\n              isSigner: false;\n            },\n          ];\n        },\n        {\n          name: 'authority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'orderPayerTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'coinWallet';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'pcWallet';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'dexProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'rent';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'side';\n          type: {\n            defined: 'Side';\n          };\n        },\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'tokenSwap';\n      accounts: [\n        {\n          name: 'tokenSwapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'swap';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'authority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'userTransferAuthority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'source';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'swapSource';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'swapDestination';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'destination';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolMint';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolFee';\n          isMut: true;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'stepTokenSwap';\n      accounts: [\n        {\n          name: 'tokenSwapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'swap';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'authority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'userTransferAuthority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'source';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'swapSource';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'swapDestination';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'destination';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolMint';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolFee';\n          isMut: true;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'cropperTokenSwap';\n      accounts: [\n        {\n          name: 'tokenSwapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'swap';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'swapState';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'authority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'userTransferAuthority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'source';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'swapSource';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'swapDestination';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'destination';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolMint';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolFee';\n          isMut: true;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'raydiumSwap';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'ammId';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'ammAuthority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'ammOpenOrders';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'ammTargetOrders';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolCoinTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolPcTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumProgramId';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'serumMarket';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumBids';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumAsks';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumEventQueue';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumCoinVaultAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumPcVaultAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumVaultSigner';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'userSourceTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userDestinationTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userSourceOwner';\n          isMut: false;\n          isSigner: true;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'raydiumSwapV2';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'ammId';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'ammAuthority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'ammOpenOrders';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolCoinTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolPcTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumProgramId';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'serumMarket';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumBids';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumAsks';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumEventQueue';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumCoinVaultAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumPcVaultAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'serumVaultSigner';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'userSourceTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userDestinationTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userSourceOwner';\n          isMut: false;\n          isSigner: true;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'aldrinSwap';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'pool';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'poolSigner';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'poolMint';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'baseTokenVault';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'quoteTokenVault';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'feePoolTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'walletAuthority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'userBaseTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userQuoteTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'side';\n          type: {\n            defined: 'Side';\n          };\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'aldrinV2Swap';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'pool';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'poolSigner';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'poolMint';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'baseTokenVault';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'quoteTokenVault';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'feePoolTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'walletAuthority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'userBaseTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userQuoteTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'curve';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'side';\n          type: {\n            defined: 'Side';\n          };\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'cremaTokenSwap';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'pool';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolSigner';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'userSourceTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userDestinationTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolSourceTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolDestinationTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolTicksAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'walletAuthority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'lifinityTokenSwap';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'authority';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'amm';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'userTransferAuthority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'sourceInfo';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'destinationInfo';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'swapSource';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'swapDestination';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'poolMint';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'feeAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'pythAccount';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'pythPcAccount';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'configAccount';\n          isMut: true;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'cykuraSwap';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'signer';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'factoryState';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'poolState';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'inputTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'outputTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'inputVault';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'outputVault';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'lastObservationState';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'coreProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'whirlpoolSwap';\n      accounts: [\n        {\n          name: 'swapProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'tokenAuthority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'whirlpool';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tokenOwnerAccountA';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tokenVaultA';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tokenOwnerAccountB';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tokenVaultB';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tickArray0';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tickArray1';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tickArray2';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'oracle';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'inAmount';\n          type: {\n            option: 'u64';\n          };\n        },\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'aToB';\n          type: 'bool';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'riskCheckAndFee';\n      accounts: [\n        {\n          name: 'tokenLedger';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userDestinationTokenAccount';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'userTransferAuthority';\n          isMut: false;\n          isSigner: true;\n        },\n        {\n          name: 'tokenProgram';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [\n        {\n          name: 'minimumOutAmount';\n          type: 'u64';\n        },\n        {\n          name: 'platformFeeBps';\n          type: 'u8';\n        },\n      ];\n    },\n    {\n      name: 'initializeTokenLedger';\n      accounts: [\n        {\n          name: 'tokenLedger';\n          isMut: true;\n          isSigner: true;\n        },\n        {\n          name: 'payer';\n          isMut: true;\n          isSigner: true;\n        },\n        {\n          name: 'systemProgram';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [];\n    },\n    {\n      name: 'setTokenLedger';\n      accounts: [\n        {\n          name: 'tokenLedger';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'tokenAccount';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [];\n    },\n    {\n      name: 'createOpenOrders';\n      accounts: [\n        {\n          name: 'openOrders';\n          isMut: true;\n          isSigner: false;\n        },\n        {\n          name: 'payer';\n          isMut: true;\n          isSigner: true;\n        },\n        {\n          name: 'dexProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'systemProgram';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'rent';\n          isMut: false;\n          isSigner: false;\n        },\n        {\n          name: 'market';\n          isMut: false;\n          isSigner: false;\n        },\n      ];\n      args: [];\n    },\n  ];\n  accounts: [\n    {\n      name: 'tokenLedger';\n      type: {\n        kind: 'struct';\n        fields: [\n          {\n            name: 'tokenAccount';\n            type: 'publicKey';\n          },\n          {\n            name: 'amount';\n            type: 'u64';\n          },\n        ];\n      };\n    },\n  ];\n  types: [\n    {\n      name: 'Swap';\n      type: {\n        kind: 'struct';\n        fields: [\n          {\n            name: 'tokens';\n            type: 'u64';\n          },\n          {\n            name: 'minTokens';\n            type: 'u64';\n          },\n          {\n            name: 'side';\n            type: {\n              defined: 'Side';\n            };\n          },\n        ];\n      };\n    },\n    {\n      name: 'Swap';\n      type: {\n        kind: 'struct';\n        fields: [\n          {\n            name: 'tokens';\n            type: 'u64';\n          },\n          {\n            name: 'minTokens';\n            type: 'u64';\n          },\n          {\n            name: 'side';\n            type: {\n              defined: 'Side';\n            };\n          },\n        ];\n      };\n    },\n    {\n      name: 'Swap';\n      type: {\n        kind: 'struct';\n        fields: [\n          {\n            name: 'amountIn';\n            type: 'u64';\n          },\n          {\n            name: 'minimumAmountOut';\n            type: 'u64';\n          },\n        ];\n      };\n    },\n    {\n      name: 'Swap';\n      type: {\n        kind: 'struct';\n        fields: [\n          {\n            name: 'amount';\n            type: 'u64';\n          },\n          {\n            name: 'otherAmountThreshold';\n            type: 'u64';\n          },\n          {\n            name: 'sqrtPriceLimit';\n            type: 'u128';\n          },\n          {\n            name: 'amountSpecifiedIsInput';\n            type: 'bool';\n          },\n          {\n            name: 'aToB';\n            type: 'bool';\n          },\n        ];\n      };\n    },\n    {\n      name: 'SwapInstrution';\n      type: {\n        kind: 'enum';\n        variants: [\n          {\n            name: 'Swap';\n            fields: [\n              {\n                defined: 'Swap';\n              },\n            ];\n          },\n        ];\n      };\n    },\n    {\n      name: 'Side';\n      type: {\n        kind: 'enum';\n        variants: [\n          {\n            name: 'Bid';\n          },\n          {\n            name: 'Ask';\n          },\n        ];\n      };\n    },\n    {\n      name: 'Direction';\n      type: {\n        kind: 'enum';\n        variants: [\n          {\n            name: 'LeftToRight';\n          },\n          {\n            name: 'RightToLeft';\n          },\n        ];\n      };\n    },\n  ];\n  errors: [\n    {\n      code: 6000;\n      name: 'SlippageToleranceExceeded';\n      msg: 'Slippage tolerance exceeded';\n    },\n    {\n      code: 6001;\n      name: 'InvalidTokenLedger';\n      msg: 'Invalid token ledger';\n    },\n    {\n      code: 6002;\n      name: 'MissingTokenLedger';\n      msg: 'Missing token ledger';\n    },\n    {\n      code: 6003;\n      name: 'MissingMercurialExchangeTokenAccount';\n      msg: 'Missing mercurial exchange token account';\n    },\n    {\n      code: 6004;\n      name: 'LedgerTokenAccountDoesNotMatch';\n      msg: 'Ledger token account does not match';\n    },\n    {\n      code: 6005;\n      name: 'MissingPlatformFeeAccount';\n      msg: 'Missing platform fee account';\n    },\n    {\n      code: 6006;\n      name: 'InvalidCalculation';\n      msg: 'Invalid calculation';\n    },\n  ];\n};\n\nexport const IDL: Jupiter = {\n  version: '0.1.0',\n  name: 'jupiter',\n  instructions: [\n    {\n      name: 'mercurialExchange',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'swapState',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'poolAuthority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'userTransferAuthority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'sourceTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'destinationTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'saberExchange',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'swap',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'swapAuthority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'userAuthority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'clock',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'inputUserAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'inputTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'outputUserAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'outputTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'feesTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'saberSwap',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'swap',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'swapAuthority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'userAuthority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'inputUserAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'inputTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'outputUserAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'outputTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'feesTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'saberAddDecimalsDeposit',\n      accounts: [\n        {\n          name: 'addDecimalsProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'wrapper',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'wrapperMint',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'wrapperUnderlyingTokens',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'owner',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'userUnderlyingTokens',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userWrappedTokens',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'saberAddDecimalsWithdraw',\n      accounts: [\n        {\n          name: 'addDecimalsProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'wrapper',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'wrapperMint',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'wrapperUnderlyingTokens',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'owner',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'userUnderlyingTokens',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userWrappedTokens',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'senchaExchange',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'swap',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userAuthority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'inputUserAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'inputTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'inputFeesAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'outputUserAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'outputTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'outputFeesAccount',\n          isMut: true,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'serumSwap',\n      accounts: [\n        {\n          name: 'market',\n          accounts: [\n            {\n              name: 'market',\n              isMut: true,\n              isSigner: false,\n            },\n            {\n              name: 'openOrders',\n              isMut: true,\n              isSigner: false,\n            },\n            {\n              name: 'requestQueue',\n              isMut: true,\n              isSigner: false,\n            },\n            {\n              name: 'eventQueue',\n              isMut: true,\n              isSigner: false,\n            },\n            {\n              name: 'bids',\n              isMut: true,\n              isSigner: false,\n            },\n            {\n              name: 'asks',\n              isMut: true,\n              isSigner: false,\n            },\n            {\n              name: 'coinVault',\n              isMut: true,\n              isSigner: false,\n            },\n            {\n              name: 'pcVault',\n              isMut: true,\n              isSigner: false,\n            },\n            {\n              name: 'vaultSigner',\n              isMut: false,\n              isSigner: false,\n            },\n          ],\n        },\n        {\n          name: 'authority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'orderPayerTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'coinWallet',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'pcWallet',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'dexProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'rent',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'side',\n          type: {\n            defined: 'Side',\n          },\n        },\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'tokenSwap',\n      accounts: [\n        {\n          name: 'tokenSwapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'swap',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'authority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'userTransferAuthority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'source',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'swapSource',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'swapDestination',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'destination',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolMint',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolFee',\n          isMut: true,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'stepTokenSwap',\n      accounts: [\n        {\n          name: 'tokenSwapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'swap',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'authority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'userTransferAuthority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'source',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'swapSource',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'swapDestination',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'destination',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolMint',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolFee',\n          isMut: true,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'cropperTokenSwap',\n      accounts: [\n        {\n          name: 'tokenSwapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'swap',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'swapState',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'authority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'userTransferAuthority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'source',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'swapSource',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'swapDestination',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'destination',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolMint',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolFee',\n          isMut: true,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'raydiumSwap',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'ammId',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'ammAuthority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'ammOpenOrders',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'ammTargetOrders',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolCoinTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolPcTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumProgramId',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'serumMarket',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumBids',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumAsks',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumEventQueue',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumCoinVaultAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumPcVaultAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumVaultSigner',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'userSourceTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userDestinationTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userSourceOwner',\n          isMut: false,\n          isSigner: true,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'raydiumSwapV2',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'ammId',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'ammAuthority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'ammOpenOrders',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolCoinTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolPcTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumProgramId',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'serumMarket',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumBids',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumAsks',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumEventQueue',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumCoinVaultAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumPcVaultAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'serumVaultSigner',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'userSourceTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userDestinationTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userSourceOwner',\n          isMut: false,\n          isSigner: true,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'aldrinSwap',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'pool',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'poolSigner',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'poolMint',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'baseTokenVault',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'quoteTokenVault',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'feePoolTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'walletAuthority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'userBaseTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userQuoteTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'side',\n          type: {\n            defined: 'Side',\n          },\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'aldrinV2Swap',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'pool',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'poolSigner',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'poolMint',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'baseTokenVault',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'quoteTokenVault',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'feePoolTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'walletAuthority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'userBaseTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userQuoteTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'curve',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'side',\n          type: {\n            defined: 'Side',\n          },\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'cremaTokenSwap',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'pool',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolSigner',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'userSourceTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userDestinationTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolSourceTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolDestinationTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolTicksAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'walletAuthority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'lifinityTokenSwap',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'authority',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'amm',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'userTransferAuthority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'sourceInfo',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'destinationInfo',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'swapSource',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'swapDestination',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'poolMint',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'feeAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'pythAccount',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'pythPcAccount',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'configAccount',\n          isMut: true,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'cykuraSwap',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'signer',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'factoryState',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'poolState',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'inputTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'outputTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'inputVault',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'outputVault',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'lastObservationState',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'coreProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'whirlpoolSwap',\n      accounts: [\n        {\n          name: 'swapProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'tokenAuthority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'whirlpool',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tokenOwnerAccountA',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tokenVaultA',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tokenOwnerAccountB',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tokenVaultB',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tickArray0',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tickArray1',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tickArray2',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'oracle',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'inAmount',\n          type: {\n            option: 'u64',\n          },\n        },\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'aToB',\n          type: 'bool',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'riskCheckAndFee',\n      accounts: [\n        {\n          name: 'tokenLedger',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userDestinationTokenAccount',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'userTransferAuthority',\n          isMut: false,\n          isSigner: true,\n        },\n        {\n          name: 'tokenProgram',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [\n        {\n          name: 'minimumOutAmount',\n          type: 'u64',\n        },\n        {\n          name: 'platformFeeBps',\n          type: 'u8',\n        },\n      ],\n    },\n    {\n      name: 'initializeTokenLedger',\n      accounts: [\n        {\n          name: 'tokenLedger',\n          isMut: true,\n          isSigner: true,\n        },\n        {\n          name: 'payer',\n          isMut: true,\n          isSigner: true,\n        },\n        {\n          name: 'systemProgram',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [],\n    },\n    {\n      name: 'setTokenLedger',\n      accounts: [\n        {\n          name: 'tokenLedger',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'tokenAccount',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [],\n    },\n    {\n      name: 'createOpenOrders',\n      accounts: [\n        {\n          name: 'openOrders',\n          isMut: true,\n          isSigner: false,\n        },\n        {\n          name: 'payer',\n          isMut: true,\n          isSigner: true,\n        },\n        {\n          name: 'dexProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'systemProgram',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'rent',\n          isMut: false,\n          isSigner: false,\n        },\n        {\n          name: 'market',\n          isMut: false,\n          isSigner: false,\n        },\n      ],\n      args: [],\n    },\n  ],\n  accounts: [\n    {\n      name: 'tokenLedger',\n      type: {\n        kind: 'struct',\n        fields: [\n          {\n            name: 'tokenAccount',\n            type: 'publicKey',\n          },\n          {\n            name: 'amount',\n            type: 'u64',\n          },\n        ],\n      },\n    },\n  ],\n  types: [\n    {\n      name: 'Swap',\n      type: {\n        kind: 'struct',\n        fields: [\n          {\n            name: 'tokens',\n            type: 'u64',\n          },\n          {\n            name: 'minTokens',\n            type: 'u64',\n          },\n          {\n            name: 'side',\n            type: {\n              defined: 'Side',\n            },\n          },\n        ],\n      },\n    },\n    {\n      name: 'Swap',\n      type: {\n        kind: 'struct',\n        fields: [\n          {\n            name: 'tokens',\n            type: 'u64',\n          },\n          {\n            name: 'minTokens',\n            type: 'u64',\n          },\n          {\n            name: 'side',\n            type: {\n              defined: 'Side',\n            },\n          },\n        ],\n      },\n    },\n    {\n      name: 'Swap',\n      type: {\n        kind: 'struct',\n        fields: [\n          {\n            name: 'amountIn',\n            type: 'u64',\n          },\n          {\n            name: 'minimumAmountOut',\n            type: 'u64',\n          },\n        ],\n      },\n    },\n    {\n      name: 'Swap',\n      type: {\n        kind: 'struct',\n        fields: [\n          {\n            name: 'amount',\n            type: 'u64',\n          },\n          {\n            name: 'otherAmountThreshold',\n            type: 'u64',\n          },\n          {\n            name: 'sqrtPriceLimit',\n            type: 'u128',\n          },\n          {\n            name: 'amountSpecifiedIsInput',\n            type: 'bool',\n          },\n          {\n            name: 'aToB',\n            type: 'bool',\n          },\n        ],\n      },\n    },\n    {\n      name: 'SwapInstrution',\n      type: {\n        kind: 'enum',\n        variants: [\n          {\n            name: 'Swap',\n            fields: [\n              {\n                defined: 'Swap',\n              },\n            ],\n          },\n        ],\n      },\n    },\n    {\n      name: 'Side',\n      type: {\n        kind: 'enum',\n        variants: [\n          {\n            name: 'Bid',\n          },\n          {\n            name: 'Ask',\n          },\n        ],\n      },\n    },\n    {\n      name: 'Direction',\n      type: {\n        kind: 'enum',\n        variants: [\n          {\n            name: 'LeftToRight',\n          },\n          {\n            name: 'RightToLeft',\n          },\n        ],\n      },\n    },\n  ],\n  errors: [\n    {\n      code: 6000,\n      name: 'SlippageToleranceExceeded',\n      msg: 'Slippage tolerance exceeded',\n    },\n    {\n      code: 6001,\n      name: 'InvalidTokenLedger',\n      msg: 'Invalid token ledger',\n    },\n    {\n      code: 6002,\n      name: 'MissingTokenLedger',\n      msg: 'Missing token ledger',\n    },\n    {\n      code: 6003,\n      name: 'MissingMercurialExchangeTokenAccount',\n      msg: 'Missing mercurial exchange token account',\n    },\n    {\n      code: 6004,\n      name: 'LedgerTokenAccountDoesNotMatch',\n      msg: 'Ledger token account does not match',\n    },\n    {\n      code: 6005,\n      name: 'MissingPlatformFeeAccount',\n      msg: 'Missing platform fee account',\n    },\n    {\n      code: 6006,\n      name: 'InvalidCalculation',\n      msg: 'Invalid calculation',\n    },\n  ],\n};\n","import { Cluster, PublicKey } from '@solana/web3.js';\nimport { IDL } from './lib/idl/jupiter';\n\nexport const WRAPPED_SOL_MINT = new PublicKey('So11111111111111111111111111111111111111112');\n\nexport const MAINNET_SERUM_DEX_PROGRAM = new PublicKey('9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin');\n\nexport const DEVNET_SERUM_DEX_PROGRAM = new PublicKey('DESVgJVGajEgKGXhb6XmqDHGz3VjdgP7rEVESBgxmroY');\n\nexport const MARKETS_URL: Record<Cluster, string> = {\n  devnet: 'https://api.jup.ag/api/markets/cache/devnet',\n  'mainnet-beta': 'https://cache.jup.ag/markets?v=3',\n  testnet: 'https://api.jup.ag/api/markets/cache/devnet',\n};\n\nexport const TOKEN_LIST_URL: Record<Cluster, string> = {\n  devnet: 'https://api.jup.ag/api/tokens/devnet',\n  testnet: 'https://api.jup.ag/api/markets/devnet',\n  'mainnet-beta': 'https://cache.jup.ag/tokens',\n};\n\nexport const LAMPORTS_PER_SIGNATURE = 5000;\n\nexport const RAYDIUM_AMM_V4_PROGRAM_ID = new PublicKey('675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8');\n\nexport const ALDRIN_SWAP_PROGRAM_ID = new PublicKey('AMM55ShdkoGRB5jVYPjWziwk8m5MpwyDgsMWHaMSQWH6');\n\n// https://github.com/aldrin-exchange/aldrin-sdk/blob/f93fe3f2d847d79d8ddff507d8d4f62fd803421b/src/v2.json\nexport const ALDRIN_SWAP_V2_PROGRAM_ID = new PublicKey('CURVGoZn8zycx6FXwwevgBTB2gVvdbGTEpvMJDbgs2t4');\n\nexport const SABER_ADD_DECIMALS_PROGRAM_ID = new PublicKey('DecZY86MU5Gj7kppfUCEmd4LbXXuyZH1yHaP2NTqdiZB');\n\nexport const CROPPER_PROGRAM_ID = new PublicKey('CTMAxxk34HjKWxQ3QLZK1HpaLXmBveao3ESePXbiyfzh');\n\nexport const SENCHA_PROGRAM_ID = new PublicKey('SCHAtsf8mbjyjiv4LkhLKutTf6JnZAbdJKFkXQNMFHZ');\n\nexport const LIFINITY_PROGRAM_ID = new PublicKey('EewxydAPCCVuNEyrVN68PuSYdQ7wKn27V9Gjeoi8dy3S');\n\nexport const CREMA_PROGRAM_ID = new PublicKey('6MLxLqiXaaSUpkgMnWDTuejNZEz3kE7k2woyHGVFw319');\n\nexport const JUPITER_WALLET = new PublicKey('BUX7s2ef2htTGb2KKoPHWkmzxPj4nTWMWRgs5CSbQxf9');\n\nexport const MERCURIAL_SWAP_PROGRAM_ID = new PublicKey('MERLuDFBMmsHnsBPZw2sDQZHvXFMwp8EdjudcU2HKky');\n\nexport const WHIRLPOOL_PROGRAM_ID = new PublicKey('whirLbMiicVdio4qvUfM5KAg6Ct8VwpYzGff3uctyCc');\n\nexport const CYKURA_PROGRAM_ID = new PublicKey('cysPXAjehMpVKUapzbMCCnpFxUFFryEWEaLgnb9NrR8');\n\nexport const CYKURA_FACTORY_STATE_ADDRESS = new PublicKey('DBsMwKfeoUHhxMi9x6wd2AsT12UwUCssjNbUzu1aKgqj');\n\n/** Tokens which are fundamental pivot in certain protocols */\nexport const SWAP_PROTOCOL_TOKENS = [\n  'StepAscQoEioFxxWGnh2sLBDFp9d8rvKz2Yp39iDpyT', // STEP\n  'DubwWZNWiNGMMeeQHPnMATNj77YZPZSAz2WVR5WjLJqz', // CRP\n];\n\ninterface ErrorDetails {\n  code: number;\n  name: string;\n  msg: string;\n}\n\ntype JUPITER_ERROR_TYPES =\n  | 'TransactionNotConfirmed'\n  | 'BalancesNotExtractedProperly'\n  | typeof IDL.errors[number]['name'];\n\nexport const JUPITER_ERRORS: Record<JUPITER_ERROR_TYPES, ErrorDetails> = Object.freeze({\n  TransactionNotConfirmed: {\n    code: 7000, // a code that is not in the list of errors\n    name: 'TransactionNotConfirmed',\n    msg: 'Transaction was not confirmed',\n  },\n  BalancesNotExtractedProperly: {\n    code: 7001, // a code that is not in the list of errors\n    name: 'BalancesNotExtractedProperly',\n    msg: 'Balances cannot be extracted properly',\n  },\n  ...IDL.errors.reduce((accErrors, error) => {\n    return { ...accErrors, [error.name]: error };\n  }, {} as Record<typeof IDL.errors[number]['name'], ErrorDetails>),\n});\n\nexport const IS_DEV = process.env.NODE_ENV === 'development';\n","import { blob, Layout, Structure, u8, union } from '@solana/buffer-layout';\nimport { u64 } from '@solana/spl-token';\nimport { PublicKey } from '@solana/web3.js';\n\nclass PublicKeyLayout extends Layout<PublicKey> {\n  private layout: Layout<any>;\n\n  constructor(property?: string) {\n    const layout = blob(32);\n    super(layout.span, property);\n    this.layout = layout;\n  }\n\n  getSpan(b: Uint8Array, offset?: number) {\n    return this.layout.getSpan(b, offset);\n  }\n\n  decode(b: Uint8Array, offset?: number): PublicKey {\n    return new PublicKey(this.layout.decode(b, offset));\n  }\n\n  encode(src: PublicKey, b: Uint8Array, offset: number): number {\n    return this.layout.encode(src.toBuffer(), b, offset);\n  }\n}\n\n/**\n * Layout for a public key\n */\nexport const publicKey = (property: string) => new PublicKeyLayout(property);\n\nclass U64Layout extends Layout<u64> {\n  private layout: Layout<any>;\n\n  constructor(span = 8, property: string) {\n    const layout = blob(span);\n    super(layout.span, property);\n    this.layout = layout;\n  }\n\n  getSpan(b: Uint8Array, offset?: number) {\n    return this.layout.getSpan(b, offset);\n  }\n\n  decode(b: Uint8Array, offset?: number): u64 {\n    const bn = new u64(this.layout.decode(b, offset), 10, 'le');\n\n    return bn;\n  }\n\n  encode(src: u64, b: Uint8Array, offset: number): number {\n    return this.layout.encode(src.toArrayLike(Buffer, 'le', this.layout.span), b, offset);\n  }\n}\n\n/**\n * Layout for a 64bit unsigned value\n */\nexport const uint64 = (property: string) => new U64Layout(8, property);\n\nexport const uint128 = (property: string) => new U64Layout(16, property);\n\nexport const rustEnum = (variants: Structure<any>[], property: string) => {\n  // @ts-expect-error TODO: fix this\n  const unionLayout = union(u8(), u8(), property);\n  variants.forEach((variant, index) => unionLayout.addVariant(index, variant, variant.property || ''));\n  return unionLayout;\n};\n","import { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { blob, struct, u8 } from '@solana/buffer-layout';\nimport { u64 } from '@solana/spl-token';\nimport { AccountInfo, PublicKey } from '@solana/web3.js';\nimport { publicKey, uint64 } from '../../utils/layout';\n\ninterface CropperTokenSwapLayout {\n  version: number;\n  isInitialized: number;\n  nonce: number;\n  ammId: PublicKey;\n  serumProgramId: PublicKey;\n  serumMarket: PublicKey;\n  tokenProgramId: PublicKey;\n  tokenAAccount: PublicKey;\n  tokenBAccount: PublicKey;\n  poolMint: PublicKey;\n  mintA: PublicKey;\n  mintB: PublicKey;\n}\n\nexport const CropperTokenSwapLayout = struct<CropperTokenSwapLayout>([\n  u8('version'),\n  u8('isInitialized'),\n  u8('nonce'),\n  publicKey('ammId'),\n  publicKey('serumProgramId'),\n  publicKey('serumMarket'),\n  publicKey('tokenProgramId'),\n  publicKey('tokenAAccount'),\n  publicKey('tokenBAccount'),\n  publicKey('poolMint'),\n  publicKey('mintA'),\n  publicKey('mintB'),\n]);\n\ninterface CropperStateLayout {\n  isInitialized: number;\n  stateOwner: PublicKey;\n  feeOwner: PublicKey;\n  initialSupply: u64;\n  returnFeeNumerator: u64;\n  fixedFeeNumerator: u64;\n  feeDenominator: u64;\n  curveType: number;\n  curveParameters: Uint8Array;\n}\n\nconst CropperStateLayout = struct<CropperStateLayout>([\n  u8('isInitialized'),\n  publicKey('stateOwner'),\n  publicKey('feeOwner'),\n  uint64('initialSupply'),\n  uint64('returnFeeNumerator'),\n  uint64('fixedFeeNumerator'),\n  uint64('feeDenominator'),\n  u8('curveType'),\n  blob(32, 'curveParameters'),\n]);\n\nexport interface CropperState {\n  isInitialized: boolean;\n  stateOwner: PublicKey;\n  feeOwner: PublicKey;\n  initialSupply: u64;\n  returnFeeNumerator: number;\n  fixedFeeNumerator: number;\n  feeDenominator: number;\n  curveType: number;\n  curveParameters: Uint8Array;\n}\n\nexport interface CropperPoolState {\n  programId: PublicKey;\n  authority: PublicKey;\n  version: number;\n  isInitialized: boolean;\n  nonce: number;\n  ammId: PublicKey;\n  serumProgramId: PublicKey;\n  serumMarket: PublicKey;\n  tokenProgramId: PublicKey;\n  tokenAAccount: PublicKey;\n  tokenBAccount: PublicKey;\n  poolMint: PublicKey;\n  mintA: PublicKey;\n  mintB: PublicKey;\n}\n\n// This seems to be hardcoded.\nexport const CROPPER_STATE_ADDRESS = new PublicKey('3hsU1VgsBgBgz5jWiqdw9RfGU6TpWdCmdah1oi4kF3Tq');\n\nexport const accountInfoToCropperPoolState = (\n  address: PublicKey,\n  accountInfo: AccountInfo<Buffer>,\n): CropperPoolState => {\n  const programId = accountInfo.owner;\n\n  const decoded = CropperTokenSwapLayout.decode(accountInfo.data);\n  const [authority] = findProgramAddressSync([address.toBuffer()], programId);\n\n  return {\n    programId,\n    authority,\n    version: decoded.version,\n    isInitialized: Boolean(decoded.isInitialized),\n    nonce: decoded.nonce,\n    ammId: decoded.ammId,\n    serumProgramId: decoded.serumProgramId,\n    tokenProgramId: decoded.tokenProgramId,\n    tokenAAccount: decoded.tokenAAccount,\n    tokenBAccount: decoded.tokenBAccount,\n    serumMarket: decoded.serumMarket,\n    poolMint: decoded.poolMint,\n    mintA: decoded.mintA,\n    mintB: decoded.mintB,\n  };\n};\n\nexport const stateAccountInfoToCropperState = (accountInfo: AccountInfo<Buffer>): CropperState => {\n  const decoded = CropperStateLayout.decode(accountInfo.data);\n\n  return {\n    isInitialized: Boolean(decoded.isInitialized),\n    stateOwner: decoded.stateOwner,\n    feeOwner: decoded.feeOwner,\n    initialSupply: decoded.initialSupply,\n    returnFeeNumerator: decoded.returnFeeNumerator.toNumber(),\n    fixedFeeNumerator: decoded.fixedFeeNumerator.toNumber(),\n    feeDenominator: decoded.feeDenominator.toNumber(),\n    curveType: decoded.curveType,\n    curveParameters: decoded.curveParameters,\n  };\n};\n","import type { Provider } from '@project-serum/anchor';\nimport { Program } from '@project-serum/anchor';\nimport { createProgramAddressSync, findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { Market } from '@project-serum/serum';\nimport { TOKEN_PROGRAM_ID } from '@solana/spl-token';\nimport { AccountMeta, PublicKey, SystemProgram, SYSVAR_RENT_PUBKEY, TransactionInstruction } from '@solana/web3.js';\nimport { BN } from 'bn.js';\nimport { Jupiter as JupiterIDL, IDL } from './idl/jupiter';\nimport type { RaydiumAmm } from './raydium/raydiumAmm';\nimport { StableSwap } from '@saberhq/stableswap-sdk';\nimport {\n  ALDRIN_SWAP_PROGRAM_ID,\n  ALDRIN_SWAP_V2_PROGRAM_ID,\n  RAYDIUM_AMM_V4_PROGRAM_ID,\n  SABER_ADD_DECIMALS_PROGRAM_ID,\n  MERCURIAL_SWAP_PROGRAM_ID,\n  CYKURA_PROGRAM_ID,\n  CYKURA_FACTORY_STATE_ADDRESS,\n  WHIRLPOOL_PROGRAM_ID,\n} from '../constants';\nimport { AldrinPoolState } from './aldrin/poolState';\nimport type { TokenSwapState } from './spl-token-swap/tokenSwapLayout';\nimport { PlatformFee } from './types';\nimport type { AddDecimals } from './saber/saberAddDecimalsAmm';\nimport { CropperPoolState, CROPPER_STATE_ADDRESS } from './cropper/swapLayout';\nimport { SenchaPoolState } from './sencha/swapLayout';\nimport { CremaPoolState } from './crema/swapLayout';\nimport { MercurialSwapLayoutState } from './mercurial/swapLayout';\nimport { LifinitySwapLayoutState } from './lifinity/swapLayout';\n\n// Side rust enum used for the program's RPC API.\nconst Side = {\n  Bid: { bid: {} },\n  Ask: { ask: {} },\n};\n\nexport const JUPITER_PROGRAM_ID_STAGING = new PublicKey('BUG9oTodrkqFqxLhvvaUtwsPLtk1wkcTC544fQn9fWPm');\nexport const JUPITER_PROGRAM_ID_PRODUCTION = new PublicKey('JUP2jxvXaqu7NQY1GmNF4m1vodw12LVXYxbFL2uJvfo');\n\nconst JUPITER_PROGRAM_ID = JUPITER_PROGRAM_ID_PRODUCTION; // JUPITER_PROGRAM_ID_PRODUCTION;\n\nconst JUPITER_PROGRAM = new Program<JupiterIDL>(IDL, JUPITER_PROGRAM_ID, {} as Provider);\n\nexport const STAGING_TOKEN_LEDGER = new PublicKey('FartgFP53i6ejPsr1owuc4ya2vxJGdcy5uEzMLJRcuzn');\nexport const PRODUCTION_TOKEN_LEDGER = new PublicKey('7h51TX1pNvSaNyjg4koKroJqoe7atKB7xWUfir7ZqX81');\n\nexport const PRODUCTION_TOKEN_LEDGERS = [\n  new PublicKey('7h51TX1pNvSaNyjg4koKroJqoe7atKB7xWUfir7ZqX81'),\n  new PublicKey('HgeLVK1nJ1kNdWSUNCKj6DfGqfhwgx67dfGPRcBSdE2d'),\n  new PublicKey('8ME9HwwchNknEVrcCSKYAQCa1YAYi3LZrEXJrY4ZNkkg'),\n  new PublicKey('Edg9J3CMky9AVJq2WrSar2JR38jFkg4S7vAW7Xsix8oV'),\n  new PublicKey('B5mW68TkDewnKvWNc2trkmmdSRxcCjZz3Yd9BWxQTSRU'),\n  new PublicKey('7E3TDrnS2zEp8uVri8EtPU8MyQ3qjLTc6cCGJAnAM48p'),\n];\n\nexport const TOKEN_LEDGER: PublicKey =\n  PRODUCTION_TOKEN_LEDGERS[Math.floor(Math.random() * PRODUCTION_TOKEN_LEDGERS.length)];\n\ntype CreateSwapInstructionParams = {\n  sourceMint: PublicKey;\n  userSourceTokenAccount: PublicKey;\n  userDestinationTokenAccount: PublicKey;\n  userTransferAuthority: PublicKey;\n  inAmount: number | null;\n  minimumOutAmount: number;\n  tokenLedger: PublicKey;\n  platformFee?: PlatformFee;\n};\n\nfunction stableSwapNPoolIntoMercurialExchange(\n  swayLayout: MercurialSwapLayoutState,\n  sourceTokenAccount: PublicKey,\n  destinationTokenAccount: PublicKey,\n  userTransferAuthority: PublicKey,\n) {\n  return {\n    swapProgram: MERCURIAL_SWAP_PROGRAM_ID,\n    swapState: swayLayout.ammId,\n    tokenProgram: TOKEN_PROGRAM_ID,\n    poolAuthority: swayLayout.authority,\n    userTransferAuthority: userTransferAuthority,\n\n    sourceTokenAccount,\n    destinationTokenAccount,\n  };\n}\n\nfunction raydiumAmmToRaydiumSwap(\n  raydiumAmm: RaydiumAmm,\n  userSourceTokenAccount: PublicKey,\n  userDestinationTokenAccount: PublicKey,\n  userTransferAuthority: PublicKey,\n) {\n  const [ammAuthority] = findProgramAddressSync(\n    [new Uint8Array(Buffer.from('amm authority'.replace('\\u00A0', ' '), 'utf-8'))],\n    RAYDIUM_AMM_V4_PROGRAM_ID,\n  );\n\n  if (!raydiumAmm.serumMarketKeys) {\n    throw new Error('RaydiumAmm is missing serumMarketKeys');\n  }\n\n  return {\n    swapProgram: RAYDIUM_AMM_V4_PROGRAM_ID,\n    tokenProgram: TOKEN_PROGRAM_ID,\n    ammId: raydiumAmm.ammId,\n    ammAuthority,\n    ammOpenOrders: raydiumAmm.ammOpenOrders,\n    poolCoinTokenAccount: raydiumAmm.poolCoinTokenAccount,\n    poolPcTokenAccount: raydiumAmm.poolPcTokenAccount,\n    serumProgramId: raydiumAmm.serumProgramId,\n    serumMarket: raydiumAmm.serumMarket,\n    serumBids: raydiumAmm.serumMarketKeys.serumBids,\n    serumAsks: raydiumAmm.serumMarketKeys.serumAsks,\n    serumEventQueue: raydiumAmm.serumMarketKeys.serumEventQueue,\n    serumCoinVaultAccount: raydiumAmm.serumMarketKeys.serumCoinVaultAccount,\n    serumPcVaultAccount: raydiumAmm.serumMarketKeys.serumPcVaultAccount,\n    serumVaultSigner: raydiumAmm.serumMarketKeys.serumVaultSigner,\n    userSourceTokenAccount: userSourceTokenAccount,\n    userDestinationTokenAccount: userDestinationTokenAccount,\n    userSourceOwner: userTransferAuthority,\n  };\n}\n\nfunction marketIntoSerumSwap(\n  market: Market,\n  openOrdersAddress: PublicKey,\n  orderPayerTokenAccountAddress: PublicKey,\n  coinWallet: PublicKey,\n  pcWallet: PublicKey,\n  userTransferAuthority: PublicKey,\n) {\n  const vaultSigner = createProgramAddressSync(\n    [market.address.toBuffer(), market.decoded.vaultSignerNonce.toArrayLike(Buffer, 'le', 8)],\n    market.programId,\n  );\n\n  return {\n    market: {\n      market: market.address,\n      openOrders: openOrdersAddress,\n      requestQueue: market.decoded.requestQueue,\n      eventQueue: market.decoded.eventQueue,\n      bids: market.bidsAddress,\n      asks: market.asksAddress,\n      coinVault: market.decoded.baseVault,\n      pcVault: market.decoded.quoteVault,\n      vaultSigner,\n    },\n    authority: userTransferAuthority,\n    orderPayerTokenAccount: orderPayerTokenAccountAddress,\n    coinWallet,\n    pcWallet,\n    // Programs.\n    dexProgram: market.programId,\n    tokenProgram: TOKEN_PROGRAM_ID,\n    // Sysvars.\n    rent: SYSVAR_RENT_PUBKEY,\n  };\n}\n\nexport function createMercurialExchangeInstruction({\n  swapLayout,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { swapLayout: MercurialSwapLayoutState } & CreateSwapInstructionParams): TransactionInstruction {\n  const remainingAccounts: AccountMeta[] = [];\n\n  for (const swapTokenAccount of swapLayout.tokenAccounts) {\n    remainingAccounts.push({\n      pubkey: swapTokenAccount,\n      isSigner: false,\n      isWritable: true,\n    });\n  }\n  remainingAccounts.push(...prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount));\n\n  return JUPITER_PROGRAM.instruction.mercurialExchange(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: stableSwapNPoolIntoMercurialExchange(\n        swapLayout,\n        userSourceTokenAccount,\n        userDestinationTokenAccount,\n        userTransferAuthority,\n      ),\n      remainingAccounts,\n    },\n  );\n}\n\nexport function createSerumSwapInstruction({\n  market,\n  sourceMint,\n  openOrdersAddress,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n  referrer,\n}: {\n  market: Market;\n  openOrdersAddress: PublicKey;\n  referrer: PublicKey | undefined;\n} & CreateSwapInstructionParams): TransactionInstruction {\n  const { side, coinWallet, pcWallet } = sourceMint.equals(market.baseMintAddress)\n    ? {\n        side: Side.Ask,\n        coinWallet: userSourceTokenAccount,\n        pcWallet: userDestinationTokenAccount,\n      }\n    : {\n        side: Side.Bid,\n        coinWallet: userDestinationTokenAccount,\n        pcWallet: userSourceTokenAccount,\n      };\n\n  let remainingAccounts = prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount);\n\n  if (referrer) {\n    remainingAccounts.push({\n      pubkey: referrer,\n      isSigner: false,\n      isWritable: true,\n    });\n  }\n\n  return JUPITER_PROGRAM.instruction.serumSwap(\n    side,\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: marketIntoSerumSwap(\n        market,\n        openOrdersAddress,\n        userSourceTokenAccount,\n        coinWallet,\n        pcWallet,\n        userTransferAuthority,\n      ),\n      remainingAccounts,\n    },\n  );\n}\n\nexport function createTokenSwapInstruction({\n  tokenSwapState,\n  sourceMint,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n  isStep,\n}: { tokenSwapState: TokenSwapState; isStep: boolean } & CreateSwapInstructionParams): TransactionInstruction {\n  const [swapSource, swapDestination] = sourceMint.equals(tokenSwapState.mintA)\n    ? [tokenSwapState.tokenAccountA, tokenSwapState.tokenAccountB]\n    : [tokenSwapState.tokenAccountB, tokenSwapState.tokenAccountA];\n\n  return (isStep ? JUPITER_PROGRAM.instruction.stepTokenSwap : JUPITER_PROGRAM.instruction.tokenSwap)(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        tokenSwapProgram: tokenSwapState.programId,\n        tokenProgram: TOKEN_PROGRAM_ID,\n        swap: tokenSwapState.address,\n        authority: tokenSwapState.authority,\n        userTransferAuthority: userTransferAuthority,\n        source: userSourceTokenAccount,\n        swapSource,\n        swapDestination,\n        destination: userDestinationTokenAccount,\n        poolMint: tokenSwapState.poolToken,\n        poolFee: tokenSwapState.feeAccount,\n      },\n      remainingAccounts: prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount),\n    },\n  );\n}\n\nexport function createSenchaSwapInstruction({\n  poolState,\n  sourceMint,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { poolState: SenchaPoolState } & CreateSwapInstructionParams): TransactionInstruction {\n  const [swapSource, swapDestination] = sourceMint.equals(poolState.token0Mint)\n    ? [poolState.token0Reserves, poolState.token1Reserves]\n    : [poolState.token1Reserves, poolState.token0Reserves];\n\n  const [feesSource, feesDestination] = sourceMint.equals(poolState.token0Mint)\n    ? [poolState.token0Fees, poolState.token1Fees]\n    : [poolState.token1Fees, poolState.token0Fees];\n\n  return JUPITER_PROGRAM.instruction.senchaExchange(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        swapProgram: poolState.programId,\n        tokenProgram: TOKEN_PROGRAM_ID,\n        swap: poolState.ammId,\n        userAuthority: userTransferAuthority,\n        inputUserAccount: userSourceTokenAccount,\n        inputTokenAccount: swapSource,\n        inputFeesAccount: feesSource,\n        outputUserAccount: userDestinationTokenAccount,\n        outputTokenAccount: swapDestination,\n        outputFeesAccount: feesDestination,\n      },\n      remainingAccounts: prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount),\n    },\n  );\n}\n\nexport function createCropperSwapInstruction({\n  poolState,\n  feeAccount,\n  sourceMint,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { poolState: CropperPoolState; feeAccount: PublicKey } & CreateSwapInstructionParams): TransactionInstruction {\n  const [swapSource, swapDestination] = sourceMint.equals(poolState.mintA)\n    ? [poolState.tokenAAccount, poolState.tokenBAccount]\n    : [poolState.tokenBAccount, poolState.tokenAAccount];\n\n  return JUPITER_PROGRAM.instruction.cropperTokenSwap(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        tokenSwapProgram: poolState.programId,\n        tokenProgram: TOKEN_PROGRAM_ID,\n        swap: poolState.ammId,\n        swapState: CROPPER_STATE_ADDRESS,\n        authority: poolState.authority,\n        userTransferAuthority: userTransferAuthority,\n        source: userSourceTokenAccount,\n        swapSource,\n        swapDestination,\n        destination: userDestinationTokenAccount,\n        poolMint: poolState.poolMint,\n        poolFee: feeAccount,\n      },\n      remainingAccounts: prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount),\n    },\n  );\n}\n\nexport function createRaydiumSwapInstruction({\n  raydiumAmm,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { raydiumAmm: RaydiumAmm } & CreateSwapInstructionParams): TransactionInstruction {\n  return JUPITER_PROGRAM.instruction.raydiumSwapV2(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: raydiumAmmToRaydiumSwap(\n        raydiumAmm,\n        userSourceTokenAccount,\n        userDestinationTokenAccount,\n        userTransferAuthority,\n      ),\n      remainingAccounts: prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount),\n    },\n  );\n}\n\nexport function createAldrinSwapInstruction({\n  poolState,\n  sourceMint,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: {\n  poolState: AldrinPoolState;\n} & CreateSwapInstructionParams): TransactionInstruction {\n  const [side, userBaseTokenAccount, userQuoteTokenAccount] = sourceMint.equals(poolState.baseTokenMint)\n    ? [Side.Ask, userSourceTokenAccount, userDestinationTokenAccount]\n    : [Side.Bid, userDestinationTokenAccount, userSourceTokenAccount];\n\n  return JUPITER_PROGRAM.instruction.aldrinSwap(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    side,\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        swapProgram: ALDRIN_SWAP_PROGRAM_ID,\n        pool: poolState.address,\n        poolSigner: poolState.poolSigner,\n        poolMint: poolState.poolMint,\n        baseTokenVault: poolState.baseTokenVault,\n        quoteTokenVault: poolState.quoteTokenVault,\n        feePoolTokenAccount: poolState.feePoolTokenAccount,\n        walletAuthority: userTransferAuthority,\n        userBaseTokenAccount,\n        userQuoteTokenAccount,\n        tokenProgram: TOKEN_PROGRAM_ID,\n      },\n      remainingAccounts: prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount),\n    },\n  );\n}\n\nexport function createAldrinV2SwapInstruction({\n  poolState,\n  sourceMint,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  curve,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { poolState: AldrinPoolState; curve: PublicKey } & CreateSwapInstructionParams): TransactionInstruction {\n  const [side, userBaseTokenAccount, userQuoteTokenAccount] = sourceMint.equals(poolState.baseTokenMint)\n    ? [Side.Ask, userSourceTokenAccount, userDestinationTokenAccount]\n    : [Side.Bid, userDestinationTokenAccount, userSourceTokenAccount];\n\n  return JUPITER_PROGRAM.instruction.aldrinV2Swap(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    side,\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        swapProgram: ALDRIN_SWAP_V2_PROGRAM_ID,\n        pool: poolState.address,\n        poolSigner: poolState.poolSigner,\n        poolMint: poolState.poolMint,\n        baseTokenVault: poolState.baseTokenVault,\n        quoteTokenVault: poolState.quoteTokenVault,\n        feePoolTokenAccount: poolState.feePoolTokenAccount,\n        walletAuthority: userTransferAuthority,\n        userBaseTokenAccount,\n        userQuoteTokenAccount,\n        curve,\n        tokenProgram: TOKEN_PROGRAM_ID,\n      },\n      remainingAccounts: prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount),\n    },\n  );\n}\n\nexport function createCremaSwapInstruction({\n  poolState,\n  sourceMint,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { poolState: CremaPoolState } & CreateSwapInstructionParams): TransactionInstruction {\n  const [swapSource, swapDestination] = sourceMint.equals(poolState.mintA)\n    ? [poolState.tokenAAccount, poolState.tokenBAccount]\n    : [poolState.tokenBAccount, poolState.tokenAAccount];\n\n  return JUPITER_PROGRAM.instruction.cremaTokenSwap(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        swapProgram: poolState.programId,\n        pool: poolState.ammId,\n        poolSigner: poolState.authority,\n        userSourceTokenAccount: userSourceTokenAccount,\n        userDestinationTokenAccount: userDestinationTokenAccount,\n        poolSourceTokenAccount: swapSource,\n        poolDestinationTokenAccount: swapDestination,\n        poolTicksAccount: poolState.ticksKey,\n        walletAuthority: userTransferAuthority,\n        tokenProgram: TOKEN_PROGRAM_ID,\n      },\n      remainingAccounts: prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount),\n    },\n  );\n}\n\nexport function createRiskCheckAndFeeInstruction(\n  userDestinationTokenAccount: PublicKey,\n  userTransferAuthority: PublicKey,\n  minimumOutAmount: number,\n  tokenLedger: PublicKey,\n  platformFee: PlatformFee | undefined,\n): TransactionInstruction {\n  const remainingAccounts: AccountMeta[] = [];\n\n  if (platformFee?.feeAccount) {\n    remainingAccounts.push({\n      pubkey: platformFee.feeAccount,\n      isSigner: false,\n      isWritable: true,\n    });\n  }\n\n  return JUPITER_PROGRAM.instruction.riskCheckAndFee(new BN(minimumOutAmount), platformFee?.feeBps ?? 0, {\n    accounts: {\n      tokenLedger,\n      userDestinationTokenAccount,\n      userTransferAuthority,\n      tokenProgram: TOKEN_PROGRAM_ID,\n    },\n    remainingAccounts,\n  });\n}\n\nexport function createSetTokenLedgerInstruction(\n  tokenLedger: PublicKey,\n  tokenAccountAddress: PublicKey,\n): TransactionInstruction {\n  return JUPITER_PROGRAM.instruction.setTokenLedger({\n    accounts: {\n      tokenLedger,\n      tokenAccount: tokenAccountAddress,\n    },\n  });\n}\n\nexport function createInitializeTokenLedgerInstruction(\n  tokenLedger: PublicKey,\n  payer: PublicKey,\n): TransactionInstruction {\n  return JUPITER_PROGRAM.instruction.initializeTokenLedger({\n    accounts: {\n      tokenLedger,\n      payer,\n      systemProgram: SystemProgram.programId,\n    },\n  });\n}\n\nexport function createOpenOrdersInstruction(\n  market: Market,\n  userTransferAuthority: PublicKey,\n): [PublicKey, TransactionInstruction] {\n  const [openOrders] = findProgramAddressSync(\n    [Buffer.from('open_orders'), market.publicKey.toBuffer(), userTransferAuthority.toBuffer()],\n    JUPITER_PROGRAM_ID,\n  );\n\n  const ix = JUPITER_PROGRAM.instruction.createOpenOrders({\n    accounts: {\n      openOrders,\n      payer: userTransferAuthority,\n      dexProgram: market.programId,\n      systemProgram: SystemProgram.programId,\n      rent: SYSVAR_RENT_PUBKEY,\n      market: market.publicKey,\n    },\n  });\n  return [openOrders, ix];\n}\n\nfunction saberPoolIntoSaberSwap(\n  saberPool: StableSwap,\n  sourceMintAddress: PublicKey,\n  userSourceTokenAccount: PublicKey,\n  userDestinationTokenAccount: PublicKey,\n  userTransferAuthority: PublicKey,\n) {\n  const feesTokenAccount = sourceMintAddress.equals(saberPool.state.tokenA.mint)\n    ? saberPool.state.tokenB.adminFeeAccount\n    : saberPool.state.tokenA.adminFeeAccount;\n  const [inputTokenAccount, outputTokenAccount] = sourceMintAddress.equals(saberPool.state.tokenA.mint)\n    ? [saberPool.state.tokenA.reserve, saberPool.state.tokenB.reserve]\n    : [saberPool.state.tokenB.reserve, saberPool.state.tokenA.reserve];\n\n  return {\n    swapProgram: saberPool.config.swapProgramID,\n    tokenProgram: TOKEN_PROGRAM_ID,\n    swap: saberPool.config.swapAccount,\n    swapAuthority: saberPool.config.authority,\n    userAuthority: userTransferAuthority,\n    inputUserAccount: userSourceTokenAccount,\n    inputTokenAccount,\n    outputUserAccount: userDestinationTokenAccount,\n    outputTokenAccount,\n    feesTokenAccount,\n  };\n}\n\nexport function createSaberSwapInstruction({\n  stableSwap,\n  sourceMint,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { stableSwap: StableSwap } & CreateSwapInstructionParams): TransactionInstruction {\n  const remainingAccounts = prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount);\n  return JUPITER_PROGRAM.instruction.saberSwap(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: saberPoolIntoSaberSwap(\n        stableSwap,\n        sourceMint,\n        userSourceTokenAccount,\n        userDestinationTokenAccount,\n        userTransferAuthority,\n      ),\n      remainingAccounts,\n    },\n  );\n}\n\nexport function createSaberAddDecimalsDepositInstruction({\n  addDecimals,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { addDecimals: AddDecimals } & CreateSwapInstructionParams) {\n  const remainingAccounts = prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount);\n  return JUPITER_PROGRAM.instruction.saberAddDecimalsDeposit(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        addDecimalsProgram: SABER_ADD_DECIMALS_PROGRAM_ID,\n        wrapper: addDecimals.wrapper,\n        wrapperMint: addDecimals.mint,\n        wrapperUnderlyingTokens: addDecimals.wrapperUnderlyingTokens,\n        owner: userTransferAuthority,\n        userUnderlyingTokens: userSourceTokenAccount,\n        userWrappedTokens: userDestinationTokenAccount,\n        tokenProgram: TOKEN_PROGRAM_ID,\n      },\n      remainingAccounts,\n    },\n  );\n}\n\nexport function createSaberAddDecimalsWithdrawInstruction({\n  addDecimals,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { addDecimals: AddDecimals } & CreateSwapInstructionParams) {\n  const remainingAccounts = prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount);\n  return JUPITER_PROGRAM.instruction.saberAddDecimalsWithdraw(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        addDecimalsProgram: SABER_ADD_DECIMALS_PROGRAM_ID,\n        wrapper: addDecimals.wrapper,\n        wrapperMint: addDecimals.mint,\n        wrapperUnderlyingTokens: addDecimals.wrapperUnderlyingTokens,\n        owner: userTransferAuthority,\n        userUnderlyingTokens: userDestinationTokenAccount,\n        userWrappedTokens: userSourceTokenAccount,\n        tokenProgram: TOKEN_PROGRAM_ID,\n      },\n      remainingAccounts,\n    },\n  );\n}\n\nexport function createLifinitySwapInstruction({\n  swapState,\n  sourceMint,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { swapState: LifinitySwapLayoutState } & CreateSwapInstructionParams): TransactionInstruction {\n  const [swapSource, swapDestination] = sourceMint.equals(swapState.tokenAMint)\n    ? [swapState.poolCoinTokenAccount, swapState.poolPcTokenAccount]\n    : [swapState.poolPcTokenAccount, swapState.poolCoinTokenAccount];\n\n  return JUPITER_PROGRAM.instruction.lifinityTokenSwap(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        swapProgram: swapState.programId,\n        authority: swapState.authority,\n        amm: swapState.amm,\n        userTransferAuthority: userTransferAuthority,\n        sourceInfo: userSourceTokenAccount,\n        destinationInfo: userDestinationTokenAccount,\n        swapSource,\n        swapDestination,\n        poolMint: swapState.poolMint,\n        feeAccount: swapState.feeAccount,\n        tokenProgram: TOKEN_PROGRAM_ID,\n        pythAccount: swapState.pythAccount,\n        pythPcAccount: swapState.pythPcAccount,\n        configAccount: swapState.configAccount,\n      },\n      remainingAccounts: prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount),\n    },\n  );\n}\n\ntype CykuraSwapInstructionArgs = {\n  poolAddress: PublicKey;\n  inputVault: PublicKey;\n  outputVault: PublicKey;\n  nextObservationState: PublicKey;\n  lastObservationState: PublicKey;\n  swapAccountMetas: AccountMeta[];\n};\n\nexport function createCykuraSwapInstruction({\n  additionalArgs,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { additionalArgs: CykuraSwapInstructionArgs } & CreateSwapInstructionParams): TransactionInstruction {\n  const remainingAccounts = prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount);\n\n  return JUPITER_PROGRAM.instruction.cykuraSwap(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        swapProgram: CYKURA_PROGRAM_ID,\n        signer: userTransferAuthority,\n        factoryState: CYKURA_FACTORY_STATE_ADDRESS,\n        poolState: additionalArgs.poolAddress,\n        inputTokenAccount: userSourceTokenAccount,\n        outputTokenAccount: userDestinationTokenAccount,\n        inputVault: additionalArgs.inputVault,\n        outputVault: additionalArgs.outputVault,\n        lastObservationState: additionalArgs.lastObservationState,\n        coreProgram: CYKURA_PROGRAM_ID, // Duplicated as in Cykura accounts\n        tokenProgram: TOKEN_PROGRAM_ID,\n      },\n      remainingAccounts: remainingAccounts.concat([\n        ...additionalArgs.swapAccountMetas,\n        { pubkey: additionalArgs.nextObservationState, isSigner: false, isWritable: true },\n      ]),\n    },\n  );\n}\n\ntype WhirlpoolSwapInstructionArgs = {\n  aToB: boolean;\n  whirlpool: PublicKey;\n  tokenVaultA: PublicKey;\n  tokenVaultB: PublicKey;\n  tickArray0: PublicKey;\n  tickArray1: PublicKey;\n  tickArray2: PublicKey;\n  oracle: PublicKey;\n};\n\nexport function createWhirlpoolSwapInstruction({\n  additionalArgs,\n  userSourceTokenAccount,\n  userDestinationTokenAccount,\n  userTransferAuthority,\n  inAmount,\n  minimumOutAmount,\n  tokenLedger,\n  platformFee,\n}: { additionalArgs: WhirlpoolSwapInstructionArgs } & CreateSwapInstructionParams): TransactionInstruction {\n  const [tokenOwnerAccountA, tokenOwnerAccountB] = additionalArgs.aToB\n    ? [userSourceTokenAccount, userDestinationTokenAccount]\n    : [userDestinationTokenAccount, userSourceTokenAccount];\n\n  return JUPITER_PROGRAM.instruction.whirlpoolSwap(\n    inAmount ? new BN(inAmount) : inAmount,\n    new BN(minimumOutAmount),\n    additionalArgs.aToB,\n    platformFee?.feeBps ?? 0,\n    {\n      accounts: {\n        swapProgram: WHIRLPOOL_PROGRAM_ID,\n        tokenProgram: TOKEN_PROGRAM_ID,\n        tokenAuthority: userTransferAuthority,\n        whirlpool: additionalArgs.whirlpool,\n        tokenOwnerAccountA,\n        tokenVaultA: additionalArgs.tokenVaultA,\n        tokenOwnerAccountB,\n        tokenVaultB: additionalArgs.tokenVaultB,\n        tickArray0: additionalArgs.tickArray0,\n        tickArray1: additionalArgs.tickArray1,\n        tickArray2: additionalArgs.tickArray2,\n        oracle: additionalArgs.oracle,\n      },\n      remainingAccounts: prepareRemainingAccounts(inAmount, tokenLedger, platformFee?.feeAccount),\n    },\n  );\n}\n\nfunction prepareRemainingAccounts(\n  inAmount: number | null,\n  tokenLedger: PublicKey,\n  feeAccount: PublicKey | undefined,\n): AccountMeta[] {\n  const remainingAccounts = [];\n\n  if (inAmount === null) {\n    remainingAccounts.push({\n      pubkey: tokenLedger,\n      isSigner: false,\n      isWritable: true,\n    });\n  }\n  if (feeAccount) {\n    remainingAccounts.push({\n      pubkey: feeAccount,\n      isSigner: false,\n      isWritable: true,\n    });\n  }\n\n  return remainingAccounts;\n}\n","import { PublicKey, TransactionInstruction } from '@solana/web3.js';\nimport JSBI from 'jsbi';\nimport { AccountInfoMap, Amm, QuoteParams, SwapParams } from '../amm';\n// Modified from saber's registry to contain the underlying mint decimal to avoid pointless queries\nimport addDecimalsJson from './add-decimals-complete-state.mainnet-beta.json';\nimport {\n  createSaberAddDecimalsDepositInstruction,\n  createSaberAddDecimalsWithdrawInstruction,\n} from '../jupiterInstruction';\n\nexport interface AddDecimals {\n  wrapper: PublicKey;\n  underlying: PublicKey;\n  underlyingDecimals: number;\n  wrapperUnderlyingTokens: PublicKey;\n  mint: PublicKey;\n  decimals: number;\n}\n\nexport function getSaberWrappedDecimalsAmms() {\n  return addDecimalsJson.map((addDecimalJson) => {\n    const addDecimals = {\n      wrapper: new PublicKey(addDecimalJson.wrapper),\n      underlying: new PublicKey(addDecimalJson.underlying),\n      underlyingDecimals: addDecimalJson.underlyingDecimals,\n      wrapperUnderlyingTokens: new PublicKey(addDecimalJson.wrapperUnderlyingTokens),\n      mint: new PublicKey(addDecimalJson.mint),\n      decimals: addDecimalJson.decimals,\n    };\n\n    return new SaberAddDecimalsAmm(new WrappedToken(addDecimals));\n  });\n}\n\nexport class WrappedToken {\n  constructor(public addDecimals: AddDecimals) {}\n\n  private get multiplier() {\n    return 10 ** (this.addDecimals.decimals - this.addDecimals.underlyingDecimals);\n  }\n\n  getOutputAmount(inputAmount: number, inputMint: PublicKey): JSBI {\n    if (this.addDecimals.mint.equals(inputMint)) {\n      // withdraw, so divide\n      return this.calculateWithdrawOutputAmount(inputAmount);\n    } else if (this.addDecimals.underlying.equals(inputMint)) {\n      // deposit, so multiply\n      return this.calculateDepositOutputAmount(inputAmount);\n    }\n    throw new Error(`unknown input token: ${inputMint.toString()}`);\n  }\n\n  private calculateDepositOutputAmount(inputAmount: number) {\n    return JSBI.multiply(JSBI.BigInt(inputAmount), JSBI.BigInt(this.multiplier));\n  }\n\n  private calculateWithdrawOutputAmount(inputAmount: number) {\n    return JSBI.divide(JSBI.BigInt(inputAmount), JSBI.BigInt(this.multiplier));\n  }\n}\n\n// This isn't technically an Amm but this the smoothest solution to allow its usage without a major refactor of the abstractions for now\nexport class SaberAddDecimalsAmm implements Amm {\n  id: string;\n  label = 'Saber (Decimals)' as const;\n  shouldPrefetch = false;\n\n  constructor(public wrappedToken: WrappedToken) {\n    this.id = this.wrappedToken.addDecimals.wrapper.toBase58();\n  }\n\n  getAccountsForUpdate() {\n    return new Array<PublicKey>();\n  }\n\n  update(_accountInfoMap: AccountInfoMap) {}\n\n  getQuote({ sourceMint, amount }: QuoteParams) {\n    const outAmount = JSBI.toNumber(this.wrappedToken.getOutputAmount(amount, sourceMint));\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount,\n      feeAmount: 0,\n      feeMint: sourceMint.toBase58(),\n      feePct: 0,\n      priceImpactPct: 0,\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams) {\n    if (this.wrappedToken.addDecimals.underlying.equals(swapParams.sourceMint)) {\n      return [\n        createSaberAddDecimalsDepositInstruction({\n          addDecimals: this.wrappedToken.addDecimals,\n          ...swapParams,\n        }),\n      ];\n    } else {\n      return [\n        createSaberAddDecimalsWithdrawInstruction({\n          addDecimals: this.wrappedToken.addDecimals,\n          ...swapParams,\n        }),\n      ];\n    }\n  }\n\n  get reserveTokenMints() {\n    return [this.wrappedToken.addDecimals.underlying, this.wrappedToken.addDecimals.mint];\n  }\n}\n","export function getTwoPermutations<T>(array: T[]) {\n  return array.reduce((acc, item) => {\n    array.forEach((otherItem) => {\n      if (item !== otherItem) {\n        acc.push([item, otherItem]);\n      }\n    });\n    return acc;\n  }, new Array<T[]>());\n}\n","export function chunks<T>(array: T[], size: number): T[][] {\n  return Array.apply<number, T[], T[][]>(0, new Array(Math.ceil(array.length / size))).map((_, index) =>\n    array.slice(index * size, (index + 1) * size),\n  );\n}\n","import { AccountInfo, Connection, PublicKey } from '@solana/web3.js';\nimport { chunks } from './chunks';\n\ninterface Result {\n  jsonrpc: string;\n  result: {\n    context: { slot: number };\n    value: Array<AccountInfo<string[]> | null>;\n  };\n}\n\nexport async function chunkedGetMultipleAccountInfos(\n  connection: Connection,\n  pks: string[],\n  batchChunkSize: number = 1000,\n  maxAccountsChunkSize: number = 100,\n): Promise<Array<AccountInfo<Buffer> | null>> {\n  return (\n    await Promise.all(\n      chunks(pks, batchChunkSize).map(async (batchPubkeys) => {\n        const batch = chunks(batchPubkeys, maxAccountsChunkSize).map((pubkeys) => ({\n          methodName: 'getMultipleAccounts',\n          args: connection._buildArgs([pubkeys], connection.commitment, 'base64'),\n        }));\n\n        return (\n          // getMultipleAccounts is quite slow, so we use fetch directly\n          connection\n            // @ts-ignore\n            ._rpcBatchRequest(batch)\n            .then((batchResults: Result[]) => {\n              const accounts = batchResults.reduce((acc, res) => {\n                acc.push(...res.result.value);\n                return acc;\n              }, [] as Result['result']['value']);\n\n              accounts.forEach((item) => {\n                if (item) {\n                  const value = item as unknown as AccountInfo<Buffer>;\n                  value.data = Buffer.from(item.data[0], item.data[1] as 'base64');\n                  value.owner = new PublicKey(value.owner);\n                }\n              });\n\n              return accounts;\n            })\n            .catch((e: any) => {\n              console.error('Failed to fetch account infos', e);\n              return batchPubkeys.map(() => null);\n            })\n        );\n      }),\n    )\n  ).flat();\n}\n","import { AccountInfo, Connection, PublicKey, TransactionInstruction } from '@solana/web3.js';\nimport { PlatformFee, QuoteMintToReferrer, TokenMintAddress } from '..';\nimport { AccountInfo as TokenAccountInfo } from '@solana/spl-token';\nimport JSBI from 'jsbi';\nimport { chunkedGetMultipleAccountInfos } from '../utils/chunkedGetMultipleAccountInfos';\n\nexport interface QuoteParams {\n  sourceMint: PublicKey;\n  destinationMint: PublicKey;\n  amount: number;\n}\n\nexport interface Quote {\n  notEnoughLiquidity: boolean;\n  minInAmount?: number;\n  minOutAmount?: number;\n  inAmount: number;\n  outAmount: number;\n  feeAmount: number;\n  feeMint: TokenMintAddress;\n  feePct: number;\n  priceImpactPct: number;\n}\n\nexport interface SwapParams {\n  sourceMint: PublicKey;\n  destinationMint: PublicKey;\n  userSourceTokenAccount: PublicKey;\n  userDestinationTokenAccount: PublicKey;\n  userTransferAuthority: PublicKey;\n  inAmount: number | null;\n  minimumOutAmount: number;\n  tokenLedger: PublicKey;\n  openOrdersAddress?: PublicKey;\n  platformFee?: PlatformFee;\n  quoteMintToReferrer?: QuoteMintToReferrer;\n}\n\nexport type AccountInfoMap = Map<string, AccountInfo<Buffer> | null>;\n\nexport interface Amm {\n  /* Label for UI usage */\n  label: string;\n  /* Unique id to recognize the AMM */\n  id: string;\n  /* Reserve token mints for the purpose of routing */\n  reserveTokenMints: PublicKey[];\n  /* State if we need to prefetch the accounts 1 time */\n  shouldPrefetch: Boolean;\n\n  getAccountsForUpdate(): PublicKey[];\n  update(accountInfoMap: AccountInfoMap): void;\n  getQuote(quoteParams: QuoteParams): Quote;\n  createSwapInstructions(swapParams: SwapParams): TransactionInstruction[];\n}\n\nexport const mapAddressToAccountInfos = (accountInfoMap: AccountInfoMap, addresses: PublicKey[]) => {\n  const accountInfos = addresses.map((address) => {\n    const accountInfo = accountInfoMap.get(address.toString());\n    if (!accountInfo) {\n      throw new Error(`Account info ${address.toBase58()} missing`);\n    }\n    return accountInfo;\n  });\n\n  return accountInfos;\n};\n\nexport const tokenAccountsToJSBIs = (tokenAccounts: TokenAccountInfo[]): JSBI[] => {\n  return tokenAccounts.map((tokenAccount) => {\n    return JSBI.BigInt(tokenAccount.amount);\n  });\n};\n\nexport const prefetchAmms = async (amms: Amm[], connection: Connection) => {\n  const accounts = amms.map((amm) => amm.getAccountsForUpdate().map((item) => item.toBase58())).flat();\n  const accountInfosMap = new Map<string, AccountInfo<Buffer>>();\n  const accountInfos = await chunkedGetMultipleAccountInfos(connection, accounts);\n\n  accountInfos.forEach((item, index) => {\n    const publicKey = accounts[index];\n    if (item) {\n      accountInfosMap.set(publicKey, item);\n    }\n  });\n\n  for (let amm of amms) {\n    amm.update(accountInfosMap);\n  }\n};\n","// Only a few hardcoded pools for now, until we query the whole lot through api\nimport { struct, nu64 } from '@solana/buffer-layout';\nimport { u64 } from '@solana/spl-token';\nimport { PublicKey } from '@solana/web3.js';\nimport { publicKey, uint128, uint64 } from '../../utils/layout';\n\ninterface AmmInfoLayoutV4 {\n  status: number;\n  nonce: number;\n  orderNum: number;\n  depth: number;\n  coinDecimals: number;\n  pcDecimals: number;\n  state: number;\n  resetFlag: number;\n  minSize: number;\n  volMaxCutRatio: number;\n  amountWaveRatio: number;\n  coinLotSize: number;\n  pcLotSize: number;\n  minPriceMultiplier: number;\n  maxPriceMultiplier: number;\n  systemDecimalsValue: number;\n  minSeparateNumerator: number;\n  minSeparateDenominator: number;\n  tradeFeeNumerator: number;\n  tradeFeeDenominator: number;\n  pnlNumerator: number;\n  pnlDenominator: number;\n  swapFeeNumerator: u64;\n  swapFeeDenominator: u64;\n  needTakePnlCoin: number;\n  needTakePnlPc: number;\n  totalPnlPc: number;\n  totalPnlCoin: number;\n  poolTotalDepositPc: u64;\n  poolTotalDepositCoin: u64;\n  swapCoinInAmount: u64;\n  swapPcOutAmount: u64;\n  swapCoin2PcFee: number;\n  swapPcInAmount: u64;\n  swapCoinOutAmount: u64;\n  swapPc2CoinFee: number;\n  poolCoinTokenAccount: PublicKey;\n  poolPcTokenAccount: PublicKey;\n  coinMintAddress: PublicKey;\n  pcMintAddress: PublicKey;\n  lpMintAddress: PublicKey;\n  ammOpenOrders: PublicKey;\n  serumMarket: PublicKey;\n  serumProgramId: PublicKey;\n  ammTargetOrders: PublicKey;\n  poolWithdrawQueue: PublicKey;\n  poolTempLpTokenAccount: PublicKey;\n  ammOwner: PublicKey;\n  pnlOwner: PublicKey;\n}\n\nexport const AMM_INFO_LAYOUT_V4 = struct<AmmInfoLayoutV4>([\n  nu64('status'),\n  nu64('nonce'),\n  nu64('orderNum'),\n  nu64('depth'),\n  nu64('coinDecimals'),\n  nu64('pcDecimals'),\n  nu64('state'),\n  nu64('resetFlag'),\n  nu64('minSize'),\n  nu64('volMaxCutRatio'),\n  nu64('amountWaveRatio'),\n  nu64('coinLotSize'),\n  nu64('pcLotSize'),\n  nu64('minPriceMultiplier'),\n  nu64('maxPriceMultiplier'),\n  nu64('systemDecimalsValue'),\n  // Fees\n  nu64('minSeparateNumerator'),\n  nu64('minSeparateDenominator'),\n  nu64('tradeFeeNumerator'),\n  nu64('tradeFeeDenominator'),\n  nu64('pnlNumerator'),\n  nu64('pnlDenominator'),\n  nu64('swapFeeNumerator'),\n  nu64('swapFeeDenominator'),\n  // OutPutData\n  nu64('needTakePnlCoin'),\n  nu64('needTakePnlPc'),\n  nu64('totalPnlPc'),\n  nu64('totalPnlCoin'),\n  uint128('poolTotalDepositPc'),\n  uint128('poolTotalDepositCoin'),\n  uint128('swapCoinInAmount'),\n  uint128('swapPcOutAmount'),\n  nu64('swapCoin2PcFee'),\n  uint128('swapPcInAmount'),\n  uint128('swapCoinOutAmount'),\n  nu64('swapPc2CoinFee'),\n\n  publicKey('poolCoinTokenAccount'),\n  publicKey('poolPcTokenAccount'),\n  publicKey('coinMintAddress'),\n  publicKey('pcMintAddress'),\n  publicKey('lpMintAddress'),\n  publicKey('ammOpenOrders'),\n  publicKey('serumMarket'),\n  publicKey('serumProgramId'),\n  publicKey('ammTargetOrders'),\n  publicKey('poolWithdrawQueue'),\n  publicKey('poolTempLpTokenAccount'),\n  publicKey('ammOwner'),\n  publicKey('pnlOwner'),\n]);\n","// https://github.com/raydium-io/raydium-ui/blob/4048286f79fc4b71c3ffbfd9095470ab0c7d3862/src/utils/liquidity.ts#L30-L82\n\nimport { Fraction, TokenSwapConstantProduct, ZERO_FRACTION } from '@jup-ag/math';\nimport { createProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { Market, OpenOrders } from '@project-serum/serum';\nimport { u64 } from '@solana/spl-token';\nimport { AccountInfo, PublicKey } from '@solana/web3.js';\nimport Decimal from 'decimal.js';\nimport JSBI from 'jsbi';\nimport { AccountInfoMap, Amm, mapAddressToAccountInfos, Quote, QuoteParams, SwapParams } from '../amm';\nimport { createRaydiumSwapInstruction } from '../jupiterInstruction';\nimport { AMM_INFO_LAYOUT_V4 } from './pools';\n\n// Explained here\n// https://discordapp.com/channels/813741812598439958/813750197423308820/900288485028683776\n// total_pc = amminfo.pc_vault.balance + amminfo.openorder.total_quote - amminfo.need_taken_pnl_pc\n// total_coin = amminfo.coin_vault.balance + amminfo.openorder.total_base - amminfo.need_taken_pnl_coin\n\ntype SerumMarketKeys = {\n  serumBids: PublicKey;\n  serumAsks: PublicKey;\n  serumEventQueue: PublicKey;\n  serumCoinVaultAccount: PublicKey;\n  serumPcVaultAccount: PublicKey;\n  serumVaultSigner: PublicKey;\n};\n\ntype SerumMarketKeysString = Record<keyof SerumMarketKeys, string>;\nexport class RaydiumAmm implements Amm {\n  id: string;\n  label = 'Raydium' as const;\n  shouldPrefetch = false;\n\n  coinMint: PublicKey;\n  pcMint: PublicKey;\n\n  status: number;\n  serumProgramId: PublicKey;\n  serumMarket: PublicKey;\n  ammOpenOrders: PublicKey;\n  ammTargetOrders: PublicKey;\n  poolCoinTokenAccount: PublicKey;\n  poolPcTokenAccount: PublicKey;\n\n  serumMarketKeys: SerumMarketKeys;\n\n  coinReserve: u64 | undefined;\n  pcReserve: u64 | undefined;\n\n  private feePct: Decimal;\n  private calculator: TokenSwapConstantProduct;\n\n  constructor(public ammId: PublicKey, ammAccountInfo: AccountInfo<Buffer>, params: SerumMarketKeysString) {\n    this.id = ammId.toBase58();\n    const decoded = AMM_INFO_LAYOUT_V4.decode(ammAccountInfo.data);\n\n    this.status = decoded.status;\n    this.coinMint = new PublicKey(decoded.coinMintAddress);\n    this.pcMint = new PublicKey(decoded.pcMintAddress);\n\n    this.poolCoinTokenAccount = new PublicKey(decoded.poolCoinTokenAccount);\n    this.poolPcTokenAccount = new PublicKey(decoded.poolPcTokenAccount);\n\n    this.serumProgramId = new PublicKey(decoded.serumProgramId);\n    this.serumMarket = new PublicKey(decoded.serumMarket);\n    this.ammOpenOrders = new PublicKey(decoded.ammOpenOrders);\n    this.ammTargetOrders = new PublicKey(decoded.ammTargetOrders);\n\n    this.serumMarketKeys = (Object.keys(params) as Array<keyof SerumMarketKeysString>).reduce((acc, item) => {\n      const pk = params[item];\n      if (!pk) throw new Error(`Could not find ${item} in params`);\n      acc[item] = new PublicKey(params[item]);\n      return acc;\n    }, {} as SerumMarketKeys);\n\n    const swapFeeNumerator = decoded.swapFeeNumerator;\n    const swapFeeDenominator = decoded.swapFeeDenominator;\n\n    this.feePct = new Decimal(swapFeeNumerator.toString()).div(swapFeeDenominator.toString());\n\n    this.calculator = new TokenSwapConstantProduct(\n      new Fraction(JSBI.BigInt(swapFeeNumerator), JSBI.BigInt(swapFeeDenominator)),\n      ZERO_FRACTION,\n    );\n  }\n\n  static decodeSerumMarketKeysString(\n    serumProgramId: PublicKey,\n    serumMarket: PublicKey,\n    serumMarketInfo: AccountInfo<Buffer>,\n  ): SerumMarketKeysString {\n    const decodedMarket = Market.getLayout(serumProgramId).decode(serumMarketInfo.data);\n    const serumVaultSigner = createProgramAddressSync(\n      [serumMarket.toBuffer(), decodedMarket.vaultSignerNonce.toArrayLike(Buffer, 'le', 8)],\n      serumProgramId,\n    );\n\n    return {\n      serumBids: decodedMarket.bids.toBase58(),\n      serumAsks: decodedMarket.asks.toBase58(),\n      serumEventQueue: decodedMarket.eventQueue.toBase58(),\n      serumCoinVaultAccount: decodedMarket.baseVault.toBase58(),\n      serumPcVaultAccount: decodedMarket.quoteVault.toBase58(),\n      serumVaultSigner: serumVaultSigner.toBase58(),\n    };\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    return [this.ammId, this.poolCoinTokenAccount, this.poolPcTokenAccount, this.ammOpenOrders];\n  }\n\n  update(accountInfoMap: AccountInfoMap) {\n    const [ammAccountInfo, poolCoinTokenAccountInfo, poolPcTokenAccountInfo, ammOpenOrdersAccountInfo] =\n      mapAddressToAccountInfos(accountInfoMap, this.getAccountsForUpdate());\n\n    const [coinAmount, pcAmount] = [\n      RaydiumAmm.tokenAmountAccessor(poolCoinTokenAccountInfo),\n      RaydiumAmm.tokenAmountAccessor(poolPcTokenAccountInfo),\n    ];\n\n    const openOrders = OpenOrders.fromAccountInfo(\n      this.ammOpenOrders,\n      ammOpenOrdersAccountInfo,\n      ammOpenOrdersAccountInfo.owner,\n    );\n\n    const decoded = AMM_INFO_LAYOUT_V4.decode(ammAccountInfo.data);\n\n    this.coinReserve = coinAmount.add(openOrders.baseTokenTotal).sub(new u64(String(decoded.needTakePnlCoin)));\n\n    this.pcReserve = pcAmount.add(openOrders.quoteTokenTotal).sub(new u64(String(decoded.needTakePnlPc)));\n  }\n\n  private static tokenAmountAccessor(tokenAccountInfo: AccountInfo<Buffer>): u64 {\n    return u64.fromBuffer(tokenAccountInfo.data.slice(64, 64 + 8));\n  }\n\n  getQuote({ sourceMint, amount }: QuoteParams): Quote {\n    const { coinReserve, pcReserve } = this;\n    if (!coinReserve || !pcReserve) {\n      throw new Error('Pool token accounts balances not refreshed or empty');\n    }\n\n    const outputIndex = this.coinMint.equals(sourceMint) ? 1 : 0;\n    const result = this.calculator.exchange(\n      [JSBI.BigInt(coinReserve), JSBI.BigInt(pcReserve)],\n      JSBI.BigInt(amount),\n      outputIndex,\n    );\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount: JSBI.toNumber(result.expectedOutputAmount),\n      feeAmount: JSBI.toNumber(result.fees),\n      feeMint: sourceMint.toBase58(),\n      feePct: this.feePct.toNumber(),\n      priceImpactPct: result.priceImpact.toNumber(),\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams) {\n    return [\n      createRaydiumSwapInstruction({\n        raydiumAmm: this,\n        ...swapParams,\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return [this.coinMint, this.pcMint];\n  }\n}\n","import { ZERO } from '@jup-ag/math';\nimport { Market, Orderbook } from '@project-serum/serum';\nimport { PublicKey } from '@solana/web3.js';\nimport BN from 'bn.js';\nimport Decimal from 'decimal.js';\nimport JSBI from 'jsbi';\n\nconst TAKER_FEE_PCT = 0.0004;\nconst STABLE_TAKER_FEE_PCT = 0.0001;\n\n// Stable markets are hardcoded in the program\nconst STABLE_MARKET_ADDRESSES = [\n  '77quYg4MGneUdjgXCunt9GgM1usmrxKY31twEy3WHwcS', // USDT/USDC\n  '5cLrMai1DsLRYc1Nio9qMTicsWtvzjzZfJPXyAoF4t1Z', // mSOL/SOL\n  'EERNEEnBqdGzBS8dd46wwNY5F2kwnaCQ3vsq2fNKGogZ', // UST/USDC\n  '8sFf9TW3KzxLiBXcDcjAxqabEsRroo4EiRr3UG1xbJ9m', // UST/USDT\n  '2iDSTGhjJEiRxNaLF27CY6daMYPs5hgYrP2REHd5YD62', // stSOL/SOL\n];\n\ninterface IMarketMeta {\n  /** buy or sell side */\n  side: 'buy' | 'sell';\n  /** indicate that your order is too huge for the market */\n  notEnoughLiquidity: boolean;\n  /** minimum in amount and the corresponding out amount */\n  minimum: {\n    in: number;\n    out: number;\n  };\n  /** amount in taken for the trade */\n  inAmount: number;\n  /** the amount out for the trade */\n  outAmount: number;\n  /** the total fee amount */\n  feeAmount: number;\n  /** price impact percentage */\n  priceImpactPct: number;\n  /** fee percentage */\n  feePct: number;\n}\n\n// Provides swap like out amount, with slippage and corresponding minimum amount out\nexport function getOutAmountMeta({\n  market,\n  asks,\n  bids,\n  fromAmount,\n  fromMint,\n  toMint,\n}: {\n  market: Market;\n  asks: Orderbook;\n  bids: Orderbook;\n  fromMint: PublicKey;\n  toMint: PublicKey;\n  fromAmount: number;\n}) {\n  const takerFeePct = STABLE_MARKET_ADDRESSES.includes(market.address.toBase58())\n    ? STABLE_TAKER_FEE_PCT\n    : TAKER_FEE_PCT;\n\n  if (fromMint.equals(market.quoteMintAddress) && toMint.equals(market.baseMintAddress)) {\n    // buy\n    return forecastBuy(market, asks, fromAmount, takerFeePct);\n  } else {\n    return forecastSell(market, bids, fromAmount, takerFeePct);\n  }\n}\n\nexport function forecastBuy(market: Market, orderbook: Orderbook, pcIn: number, takerFeePct: number): IMarketMeta {\n  let coinOut = JSBI.BigInt(0);\n  let bestPrice: JSBI = JSBI.BigInt(0);\n  let worstPrice: JSBI = JSBI.BigInt(0);\n  // total base price\n  let totalCost = JSBI.BigInt(0);\n  let totalCoins = JSBI.BigInt(0);\n\n  // might be decimal, e.g: 0.001\n  const quoteSizeLots = market.quoteSizeLotsToNumber(new BN(1));\n\n  // Serum buy order take fee in quote tokens\n  let availablePc = quoteSizeLots ? JSBI.BigInt(Math.floor(pcIn / (1 + takerFeePct) / quoteSizeLots)) : ZERO;\n\n  const baseSizeLots = JSBI.BigInt(market.baseSizeLotsToNumber(new BN(1)).toString());\n\n  for (let [lotPrice, lotQuantity] of getL2(orderbook)) {\n    if (JSBI.equal(bestPrice, ZERO)) {\n      bestPrice = lotPrice;\n    }\n\n    worstPrice = lotPrice;\n\n    const orderCoinAmount = JSBI.multiply(lotQuantity, baseSizeLots);\n    const orderPcAmount = JSBI.multiply(lotQuantity, lotPrice);\n\n    totalCoins = JSBI.add(totalCoins, orderCoinAmount);\n\n    if (JSBI.greaterThanOrEqual(orderPcAmount, availablePc)) {\n      const numberLotsPurchasable = JSBI.divide(availablePc, lotPrice);\n\n      totalCost = JSBI.add(totalCost, JSBI.multiply(lotPrice, numberLotsPurchasable));\n      coinOut = JSBI.add(coinOut, JSBI.multiply(baseSizeLots, numberLotsPurchasable));\n      availablePc = ZERO;\n      break;\n    } else {\n      totalCost = JSBI.add(totalCost, JSBI.multiply(lotPrice, lotQuantity));\n      coinOut = JSBI.add(coinOut, orderCoinAmount);\n      availablePc = JSBI.subtract(availablePc, orderPcAmount);\n    }\n  }\n\n  const bestPriceDecimal = new Decimal(bestPrice.toString());\n  const worstPriceDecimal = new Decimal(worstPrice.toString());\n\n  const priceImpactPct = worstPriceDecimal.sub(bestPriceDecimal).div(bestPriceDecimal).toNumber();\n\n  const bestPriceSizeLots = priceLotsToDecimal(market, new BN(bestPrice.toString()));\n  const totalCostSizeLots = priceLotsToDecimal(market, new BN(totalCost.toString()));\n\n  return {\n    side: 'buy',\n    notEnoughLiquidity: JSBI.lessThanOrEqual(totalCoins, coinOut),\n    minimum: {\n      in: new Decimal(bestPriceSizeLots.toString())\n        .mul(baseSizeLots.toString())\n        .mul(1 + takerFeePct)\n        .ceil()\n        .toNumber(),\n      out: JSBI.toNumber(baseSizeLots),\n    },\n    inAmount: new Decimal(totalCostSizeLots.toString())\n      .mul(baseSizeLots.toString())\n      .mul(1 + takerFeePct)\n      .ceil()\n      .toNumber(),\n    outAmount: JSBI.toNumber(coinOut),\n    feeAmount: new Decimal(totalCost.toString()).mul(takerFeePct).toNumber(),\n    priceImpactPct,\n    feePct: takerFeePct,\n  };\n}\n\nexport function forecastSell(market: Market, orderbook: Orderbook, coinIn: number, takerFeePct: number): IMarketMeta {\n  let pcOut = JSBI.BigInt(0);\n  let bestPrice = JSBI.BigInt(0);\n  let worstPrice = JSBI.BigInt(0);\n  let totalCoin = JSBI.BigInt(0);\n  let availableCoin = JSBI.BigInt(coinIn);\n  let inAmount = JSBI.BigInt(0);\n\n  const baseSizeLots = JSBI.BigInt(market.baseSizeLotsToNumber(new BN(1)));\n  const quoteSizeLots = JSBI.BigInt(market.quoteSizeLotsToNumber(new BN(1)));\n\n  for (const [lotPrice, lotQuantity] of getL2(orderbook)) {\n    if (JSBI.equal(bestPrice, ZERO)) {\n      bestPrice = lotPrice;\n    }\n\n    worstPrice = lotPrice;\n\n    const orderCoinAmount = JSBI.multiply(baseSizeLots, lotQuantity);\n    const orderPcAmount = JSBI.multiply(lotQuantity, JSBI.multiply(lotPrice, quoteSizeLots));\n    totalCoin = JSBI.add(totalCoin, orderCoinAmount);\n\n    if (JSBI.greaterThanOrEqual(orderCoinAmount, availableCoin)) {\n      const numberLotsCanSell = JSBI.divide(availableCoin, baseSizeLots);\n      const totalCoinAmountToSell = JSBI.multiply(numberLotsCanSell, lotPrice);\n      pcOut = JSBI.add(pcOut, JSBI.multiply(totalCoinAmountToSell, quoteSizeLots));\n      availableCoin = JSBI.subtract(availableCoin, totalCoinAmountToSell);\n      inAmount = JSBI.add(inAmount, JSBI.multiply(numberLotsCanSell, baseSizeLots));\n      break;\n    } else {\n      pcOut = JSBI.add(pcOut, orderPcAmount);\n      availableCoin = JSBI.subtract(availableCoin, orderCoinAmount);\n      inAmount = JSBI.add(inAmount, orderCoinAmount);\n    }\n  }\n\n  let pcOutInteger = new Decimal(pcOut.toString())\n    .mul(1 - takerFeePct)\n    .floor()\n    .toNumber();\n\n  const bestPriceDecimal = priceLotsToDecimal(market, new BN(bestPrice.toString()));\n  const worstPriceDecimal = priceLotsToDecimal(market, new BN(worstPrice.toString()));\n\n  const priceImpactPct = bestPriceDecimal.minus(worstPriceDecimal).div(bestPriceDecimal).toNumber();\n\n  return {\n    side: 'sell',\n    notEnoughLiquidity: JSBI.greaterThan(JSBI.BigInt(coinIn), totalCoin),\n    minimum: {\n      in: JSBI.toNumber(baseSizeLots),\n      out: bestPriceDecimal\n        .mul(JSBI.toNumber(baseSizeLots))\n        .mul(1 - takerFeePct)\n        .floor()\n        .toNumber(),\n    },\n    inAmount: JSBI.toNumber(inAmount),\n    outAmount: pcOutInteger,\n    feeAmount: new Decimal(JSBI.toNumber(pcOut)).mul(takerFeePct).round().toNumber(),\n    priceImpactPct,\n    feePct: takerFeePct,\n  };\n}\n\nexport function* getL2(orderbook: Orderbook): Generator<[JSBI, JSBI]> {\n  const descending = orderbook.isBids;\n  for (const { key, quantity } of orderbook.slab.items(descending)) {\n    const price = JSBI.BigInt(key.ushrn(64).toString());\n    yield [price, JSBI.BigInt(quantity.toString())];\n  }\n}\n\nfunction divideBnToDecimal(numerator: BN, denominator: BN): Decimal {\n  const quotient = new Decimal(numerator.div(denominator).toString());\n  const rem = numerator.umod(denominator);\n  const gcd = rem.gcd(denominator);\n  return quotient.add(new Decimal(rem.div(gcd).toString()).div(new Decimal(denominator.div(gcd).toString())));\n}\n\nfunction priceLotsToDecimal(market: Market, price: BN) {\n  // @ts-expect-error _decoded\n  const baseLotSize = market._decoded.baseLotSize;\n  if (baseLotSize.isZero()) return new Decimal(0);\n\n  return divideBnToDecimal(\n    // @ts-expect-error _decoded _baseSplTokenMultiplier is private\n    price.mul(market._decoded.quoteLotSize).mul(market._baseSplTokenMultiplier),\n    // @ts-expect-error _quoteSplTokenMultiplier is private\n    baseLotSize.mul(market._quoteSplTokenMultiplier),\n  );\n}\n","import { Orderbook } from '@project-serum/serum';\nimport { PublicKey } from '@solana/web3.js';\nimport { AccountInfoMap, Amm, mapAddressToAccountInfos, Quote, QuoteParams, SwapParams } from '../amm';\nimport { createSerumSwapInstruction } from '../jupiterInstruction';\nimport { SerumMarket } from '../market';\nimport { getL2, getOutAmountMeta } from './market';\n\nexport class SerumAmm implements Amm {\n  id: string;\n  label = 'Serum' as const;\n  shouldPrefetch = false;\n\n  private _orderbooks: { asks: Orderbook; bids: Orderbook } | undefined;\n\n  constructor(public market: SerumMarket) {\n    this.id = market.address.toBase58();\n  }\n\n  get orderbooks() {\n    return this._orderbooks;\n  }\n\n  static getL2 = getL2;\n\n  getAccountsForUpdate(): PublicKey[] {\n    return [this.market.asksAddress, this.market.bidsAddress];\n  }\n\n  update(accountInfoMap: AccountInfoMap): void {\n    const [asksAccountInfo, bidsAccountInfo] = mapAddressToAccountInfos(accountInfoMap, this.getAccountsForUpdate());\n\n    const asks = Orderbook.decode(this.market, asksAccountInfo.data);\n    const bids = Orderbook.decode(this.market, bidsAccountInfo.data);\n\n    this._orderbooks = {\n      asks,\n      bids,\n    };\n  }\n\n  getQuote({ sourceMint, destinationMint, amount }: QuoteParams): Quote {\n    if (!this.orderbooks) {\n      throw new Error('Failed to find orderbooks');\n    }\n\n    const outAmountMeta = getOutAmountMeta({\n      market: this.market,\n      asks: this.orderbooks.asks,\n      bids: this.orderbooks.bids,\n      fromMint: sourceMint,\n      toMint: destinationMint,\n      fromAmount: amount,\n    });\n\n    return {\n      notEnoughLiquidity: outAmountMeta.notEnoughLiquidity,\n      minInAmount: outAmountMeta.minimum.in,\n      minOutAmount: outAmountMeta.minimum.out,\n      inAmount: outAmountMeta.inAmount,\n      outAmount: outAmountMeta.outAmount,\n      feeAmount: outAmountMeta.feeAmount,\n      feeMint: this.market.quoteMintAddress.toBase58(),\n      feePct: outAmountMeta.feePct,\n      priceImpactPct: outAmountMeta.priceImpactPct,\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams) {\n    if (!swapParams.openOrdersAddress) {\n      throw new Error('Missing open orders');\n    }\n\n    return [\n      createSerumSwapInstruction({\n        market: this.market,\n        openOrdersAddress: swapParams.openOrdersAddress,\n        referrer: swapParams?.quoteMintToReferrer?.get(this.market.quoteMintAddress.toBase58()),\n        ...swapParams,\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return [this.market.baseMintAddress, this.market.quoteMintAddress];\n  }\n}\n","import { PublicKey } from '@solana/web3.js';\nimport { getTwoPermutations } from '../../utils/getTwoPermutations';\nimport { AccountInfoMap, Amm, Quote, QuoteParams, SwapParams } from '../amm';\nimport { RaydiumAmm } from '../raydium/raydiumAmm';\nimport { createRiskCheckAndFeeInstruction } from '../jupiterInstruction';\nimport { SerumAmm } from '../serum/serumAmm';\nimport { SerumMarket } from '../market';\n\ninterface SplitSolution {\n  outAmount: number;\n  portion: number;\n  firstQuote: Quote | undefined;\n  secondQuote: Quote | undefined;\n}\n\nfunction isSplitSupported(firstAmm: Amm, secondAmm: Amm) {\n  if (\n    (firstAmm instanceof SerumAmm && secondAmm instanceof RaydiumAmm) ||\n    (firstAmm instanceof RaydiumAmm && secondAmm instanceof SerumAmm) ||\n    (firstAmm instanceof SerumAmm && secondAmm instanceof SerumAmm)\n  ) {\n    return false;\n  }\n  return true;\n}\n\n// Create an iteration to quote with a stepped split\nexport class SplitTradeAmm implements Amm {\n  market: SerumMarket | null;\n  shouldPrefetch = false;\n  private portion1: number = 0;\n  private portion2: number = 0;\n\n  constructor(public firstAmm: Amm, public secondAmm: Amm, public reserveTokenMints: PublicKey[]) {\n    this.market =\n      firstAmm instanceof SerumAmm ? firstAmm.market : secondAmm instanceof SerumAmm ? secondAmm.market : null;\n  }\n\n  static getAmmIdsFromSplitTradeAmmId(id: string): string[] {\n    const ammIds = id.split('-');\n\n    return ammIds.length > 1 ? ammIds : [];\n  }\n\n  static create(firstAmm: Amm, secondAmm: Amm) {\n    if (!isSplitSupported(firstAmm, secondAmm)) return;\n\n    const firstAmmTwoPermutations = getTwoPermutations(firstAmm.reserveTokenMints);\n    const secondAmmTwoPermutations = getTwoPermutations(secondAmm.reserveTokenMints);\n\n    for (const firstAmmTwoPermutation of firstAmmTwoPermutations) {\n      for (const secondAmmTwoPermutation of secondAmmTwoPermutations) {\n        if (firstAmmTwoPermutation.every((value, index) => value.equals(secondAmmTwoPermutation[index]))) {\n          return new SplitTradeAmm(firstAmm, secondAmm, firstAmmTwoPermutation);\n        }\n      }\n    }\n  }\n\n  setPortions(portion1: number, portion2: number) {\n    if (portion1 + portion2 !== 100) {\n      throw new Error('Split trade portions must sum to 100');\n    }\n\n    this.portion1 = portion1;\n    this.portion2 = portion2;\n  }\n\n  get id() {\n    return `${this.firstAmm.id}-${this.secondAmm.id}`;\n  }\n\n  get label() {\n    const labelWithPortions = [\n      { label: this.firstAmm.label, portion: this.portion1 },\n      { label: this.secondAmm.label, portion: this.portion2 },\n    ].sort((a, b) => b.portion - a.portion);\n\n    return labelWithPortions.map(({ label, portion }) => `${label} (${portion}%)`).join(' + ');\n  }\n\n  getAccountsForUpdate() {\n    return [];\n  }\n\n  update(_accountInfoMap: AccountInfoMap) {\n    // Underlying amms are updated\n  }\n\n  getQuote(quoteParams: QuoteParams): Quote {\n    const sourceMintString = quoteParams.sourceMint.toBase58();\n    const amount = quoteParams.amount;\n    // Portion in % directly to please the UI\n    let bestSolution: SplitSolution = {\n      outAmount: 0,\n      portion: 0,\n      firstQuote: undefined,\n      secondQuote: undefined,\n    };\n\n    // Increase portion until 100\n    for (let p = 100; (p -= 5); p > 0) {\n      const firstAmount = Math.floor((amount * p) / 100);\n      const secondAmount = amount - firstAmount;\n\n      const firstQuote = this.firstAmm.getQuote({\n        ...quoteParams,\n        amount: firstAmount,\n      });\n      const secondQuote = this.secondAmm.getQuote({\n        ...quoteParams,\n        amount: secondAmount,\n      });\n      const outAmount = firstQuote.outAmount + secondQuote.outAmount;\n\n      if (outAmount < bestSolution.outAmount) {\n        break;\n      }\n\n      bestSolution = {\n        outAmount,\n        portion: p,\n        firstQuote,\n        secondQuote,\n      };\n    }\n\n    if (!bestSolution.firstQuote || !bestSolution.secondQuote) {\n      throw new Error('Unreachable: There was no better solution than getting 0 outAmount');\n    }\n\n    const { outAmount, portion, firstQuote, secondQuote } = bestSolution;\n    const portion1 = portion;\n    const portion2 = 100 - portion1;\n\n    // For UI display\n    this.portion1 = portion1;\n    this.portion2 = portion2;\n\n    let firstAmmFee = {\n      amount: firstQuote.feeAmount,\n      mint: firstQuote.feeMint,\n    };\n    let secondAmmFee = {\n      amount: secondQuote.feeAmount,\n      mint: secondQuote.feeMint,\n    };\n\n    if (firstAmmFee.mint !== secondAmmFee.mint) {\n      // Then we convert destinationMint fee into a sourceMint, to please the current data structure\n      // This will lead to inexact fees but this doesn't affect the user minimum out amount\n      if (firstAmmFee.mint !== sourceMintString) {\n        firstAmmFee = {\n          amount: Math.floor((firstAmmFee.amount * amount * portion1) / 100 / bestSolution.outAmount),\n          mint: sourceMintString,\n        };\n      }\n      if (secondAmmFee.mint !== sourceMintString) {\n        secondAmmFee = {\n          amount: Math.floor((secondAmmFee.amount * amount * portion2) / 100 / bestSolution.outAmount),\n          mint: sourceMintString,\n        };\n      }\n    }\n\n    const feePct = (portion1 * firstQuote.feePct + portion2 * secondQuote.feePct) / 100;\n    const priceImpactPct = (portion1 * firstQuote.priceImpactPct + portion2 * secondQuote.priceImpactPct) / 100;\n\n    // Not sure about the relevance on minInAmount and minOutAmount in this case\n    const minInAmount =\n      firstQuote.minInAmount || secondQuote.minInAmount\n        ? (firstQuote.minInAmount ?? 0) + (secondQuote.minInAmount ?? 0)\n        : undefined;\n    const minOutAmount =\n      firstQuote.minOutAmount || secondQuote.minOutAmount\n        ? (firstQuote.minOutAmount ?? 0) + (secondQuote.minOutAmount ?? 0)\n        : undefined;\n    return {\n      notEnoughLiquidity: false,\n      inAmount: quoteParams.amount,\n      outAmount: outAmount,\n      minInAmount,\n      minOutAmount,\n      feeAmount: firstAmmFee.amount + secondAmmFee.amount,\n      feeMint: firstAmmFee.mint, // Guaranteed identical mint at this point\n      feePct,\n      priceImpactPct,\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams) {\n    const inAmount = swapParams.inAmount;\n    if (inAmount === null) {\n      throw new Error('Split trade cannot be used with a null inAmount');\n    }\n\n    // We rely on the fact that this.portion1 is set, what if it isn't?\n    const firstAmount = Math.floor((inAmount * this.portion1) / 100);\n    const secondAmount = inAmount - firstAmount;\n\n    return [\n      ...this.firstAmm.createSwapInstructions({\n        ...swapParams,\n        inAmount: firstAmount,\n        minimumOutAmount: 0,\n        platformFee: undefined,\n      }),\n      ...this.secondAmm.createSwapInstructions({\n        ...swapParams,\n        inAmount: secondAmount,\n        minimumOutAmount: 0,\n        platformFee: undefined,\n      }),\n      createRiskCheckAndFeeInstruction(\n        swapParams.userDestinationTokenAccount,\n        swapParams.userTransferAuthority,\n        swapParams.minimumOutAmount,\n        swapParams.tokenLedger,\n        swapParams.platformFee,\n      ),\n    ];\n  }\n}\n","import { Market as SerumMarket } from '@project-serum/serum';\nimport { PublicKey } from '@solana/web3.js';\nimport { StableSwap } from '@saberhq/stableswap-sdk';\nimport { SaberAddDecimalsAmm } from './saber/saberAddDecimalsAmm';\nimport { SplitTradeAmm } from './split-trade/splitTradeAmm';\nimport { RaydiumAmm } from './raydium/raydiumAmm';\nimport { SerumAmm } from './serum/serumAmm';\nimport { Amm } from './amm';\n\nexport interface Fee {\n  amount: number;\n  mint: string;\n  pct: number;\n}\n\nexport { SerumMarket, StableSwap };\n\nexport interface MarketInfo {\n  amm: Amm; //name: string, // pair for serum, pool name for mer pool\n  inputMint: PublicKey;\n  outputMint: PublicKey;\n  minInAmount?: number;\n  minOutAmount?: number;\n  inAmount: number;\n  outAmount: number;\n  notEnoughLiquidity: boolean;\n  priceImpactPct: number;\n  lpFee: Fee;\n  platformFee: Fee;\n}\n\n// This is to check if the two markets are supported by the aggregator\nexport const isValidRoute = (ammA: Amm, ammB: Amm) => {\n  // dont match the same amm together\n  if (ammA.id === ammB.id) {\n    return false;\n  }\n  // don't show decimal as input or output\n  else if (ammA instanceof SaberAddDecimalsAmm && ammB instanceof SaberAddDecimalsAmm) {\n    return false;\n  } else if (ammA instanceof SplitTradeAmm || ammB instanceof SplitTradeAmm) {\n    return false;\n  }\n\n  return true;\n};\n\nexport function isSerumAndRaydium(marketInfos: MarketInfo[]) {\n  if (marketInfos.length < 2) return false;\n\n  const [firstAmm, secondAmm] = marketInfos.map((mi) => mi.amm);\n\n  return (\n    (firstAmm instanceof RaydiumAmm && secondAmm instanceof SerumAmm) ||\n    (firstAmm instanceof SerumAmm && secondAmm instanceof RaydiumAmm)\n  );\n}\n","import { calculateAmpFactor, StableSwap } from '@saberhq/stableswap-sdk';\nimport { PublicKey } from '@solana/web3.js';\nimport { Fraction, ONE, Stable, TWO } from '@jup-ag/math';\nimport JSBI from 'jsbi';\nimport Decimal from 'decimal.js';\nimport {\n  AccountInfoMap,\n  Amm,\n  mapAddressToAccountInfos,\n  Quote,\n  QuoteParams,\n  tokenAccountsToJSBIs,\n  SwapParams,\n} from '../amm';\nimport { createSaberSwapInstruction } from '../jupiterInstruction';\nimport { deserializeAccount } from '@mercurial-finance/optimist';\nimport { AccountInfo } from '@solana/spl-token';\n\nexport class SaberAmm implements Amm {\n  id: string;\n  label = 'Saber' as const;\n  shouldPrefetch = false;\n  private tokenAccounts: AccountInfo[] = [];\n  private calculator: Stable;\n\n  constructor(private stableSwap: StableSwap) {\n    this.id = stableSwap.config.swapAccount.toBase58();\n\n    this.calculator = new Stable(\n      TWO,\n      calculateAmpFactor(this.stableSwap.state),\n      [ONE, ONE],\n      new Fraction(this.stableSwap.state.fees.trade.numerator, this.stableSwap.state.fees.trade.denominator),\n    );\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    return [this.stableSwap.state.tokenA.reserve, this.stableSwap.state.tokenB.reserve];\n  }\n\n  update(accountInfoMap: AccountInfoMap) {\n    let tokenAccountInfos = mapAddressToAccountInfos(accountInfoMap, this.getAccountsForUpdate());\n\n    this.tokenAccounts = tokenAccountInfos.map((info) => {\n      const tokenAccount = deserializeAccount(info.data);\n      if (!tokenAccount) {\n        throw new Error('Invalid token account data');\n      }\n      return tokenAccount;\n    });\n  }\n\n  getQuote({ sourceMint, destinationMint, amount }: QuoteParams): Quote {\n    if (this.tokenAccounts.length === 0) {\n      throw new Error('Unable to fetch accounts for specified tokens.');\n    }\n\n    const feePct = new Decimal(this.stableSwap.state.fees.trade.asFraction.toFixed(4));\n\n    const [inputIndex, outputIndex] = this.tokenAccounts[0].mint.equals(sourceMint) ? [0, 1] : [1, 0];\n\n    this.calculator.setAmp(calculateAmpFactor(this.stableSwap.state));\n    const result = this.calculator.exchange(\n      tokenAccountsToJSBIs(this.tokenAccounts),\n      JSBI.BigInt(amount),\n      inputIndex,\n      outputIndex,\n    );\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount: JSBI.toNumber(result.expectedOutputAmount),\n      feeAmount: JSBI.toNumber(result.fees),\n      feeMint: destinationMint.toBase58(),\n      feePct: feePct.toNumber(),\n      priceImpactPct: result.priceImpact.toNumber(),\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams) {\n    return [\n      createSaberSwapInstruction({\n        stableSwap: this.stableSwap,\n        ...swapParams,\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return [this.stableSwap.state.tokenA.mint, this.stableSwap.state.tokenB.mint];\n  }\n}\n","import { u64 } from '@solana/spl-token';\nimport Decimal from 'decimal.js';\n\nconst ZERO = new u64(0);\n\nexport class Percentage {\n  readonly numerator: u64;\n  readonly denominator: u64;\n\n  constructor(numerator: u64, denominator: u64) {\n    this.numerator = numerator;\n    this.denominator = denominator;\n  }\n\n  public static fromDecimal(number: Decimal): Percentage {\n    return Percentage.fromFraction(number.toDecimalPlaces(1).mul(10).toNumber(), 1000);\n  }\n\n  public static fromFraction(numerator: u64 | number, denominator: u64 | number): Percentage {\n    const num = typeof numerator === 'number' ? new u64(numerator.toString()) : numerator;\n    const denom = typeof denominator === 'number' ? new u64(denominator.toString()) : denominator;\n    return new Percentage(num, denom);\n  }\n\n  public toString = (): string => {\n    return `${this.numerator.toString()}/${this.denominator.toString()}`;\n  };\n\n  public toDecimal() {\n    if (this.denominator.eq(ZERO)) {\n      return new Decimal(0);\n    }\n    return new Decimal(this.numerator.toString()).div(new Decimal(this.denominator.toString()));\n  }\n\n  public add(p2: Percentage): Percentage {\n    const denomGcd = this.denominator.gcd(p2.denominator);\n    const denomLcm = this.denominator.div(denomGcd).mul(p2.denominator);\n\n    const p1DenomAdjustment = denomLcm.div(this.denominator);\n    const p2DenomAdjustment = denomLcm.div(p2.denominator);\n\n    const p1NumeratorAdjusted = this.numerator.mul(p1DenomAdjustment);\n    const p2NumeratorAdjusted = p2.numerator.mul(p2DenomAdjustment);\n\n    const newNumerator = p1NumeratorAdjusted.add(p2NumeratorAdjusted);\n\n    return new Percentage(new u64(newNumerator.toString()), new u64(denomLcm.toString()));\n  }\n}\n","import { struct, blob, u8, Structure } from '@solana/buffer-layout';\nimport { u64 } from '@solana/spl-token';\nimport { AccountInfo, PublicKey } from '@solana/web3.js';\nimport { ALDRIN_SWAP_V2_PROGRAM_ID } from '../../constants';\nimport { publicKey, rustEnum, uint64 } from '../../utils/layout';\nimport { Percentage } from './percentage';\n\ntype FeeStructure = {\n  traderFee: Percentage;\n  ownerFee: Percentage;\n};\n\ninterface FeeLayout {\n  tradeFeeNumerator: u64;\n  tradeFeeDenominator: u64;\n  ownerTradeFeeNumerator: u64;\n  ownerTradeFeeDenominator: u64;\n  ownerWithdrawFeeNumerator: u64;\n  ownerWithdrawFeeDenominator: u64;\n}\n\n// https://github.com/aldrin-exchange/aldrin-sdk/blob/78527e3adfc02e186956f420b5083fa0950e7263/src/pools/layout.ts\nconst FEES_LAYOUT = struct<FeeLayout>(\n  [\n    uint64('tradeFeeNumerator'),\n    uint64('tradeFeeDenominator'),\n    uint64('ownerTradeFeeNumerator'),\n    uint64('ownerTradeFeeDenominator'),\n    uint64('ownerWithdrawFeeNumerator'),\n    uint64('ownerWithdrawFeeDenominator'),\n  ],\n  'fees',\n);\n\nconst POOL_FIELDS_COMMON = [\n  blob(8, 'padding'),\n  publicKey('lpTokenFreezeVault'),\n  publicKey('poolMint'),\n  publicKey('baseTokenVault'),\n  publicKey('baseTokenMint'),\n  publicKey('quoteTokenVault'),\n  publicKey('quoteTokenMint'),\n  publicKey('poolSigner'),\n  u8('poolSignerNonce'),\n  publicKey('authority'),\n  publicKey('initializerAccount'),\n  publicKey('feeBaseAccount'),\n  publicKey('feeQuoteAccount'),\n  publicKey('feePoolTokenAccount'),\n  FEES_LAYOUT,\n];\n\ninterface PoolLayout {\n  padding: any;\n  lpTokenFreezeVault: PublicKey;\n  poolMint: PublicKey;\n  baseTokenVault: PublicKey;\n  baseTokenMint: PublicKey;\n  quoteTokenVault: PublicKey;\n  quoteTokenMint: PublicKey;\n  poolSigner: PublicKey;\n  poolSignerNonce: number;\n  authority: PublicKey;\n  initializerAccount: PublicKey;\n  feeBaseAccount: PublicKey;\n  feeQuoteAccount: PublicKey;\n  feePoolTokenAccount: PublicKey;\n  fees: FeeLayout;\n}\n\nexport const POOL_LAYOUT = struct<PoolLayout>(POOL_FIELDS_COMMON);\n\ninterface PoolV2Layout extends PoolLayout {\n  curveType: number;\n  curve: PublicKey;\n}\n\nexport const POOL_V2_LAYOUT = struct<PoolV2Layout>([...POOL_FIELDS_COMMON, u8('curveType'), publicKey('curve')]);\n\ninterface StableCurveLayout {\n  padding: any;\n  amp: u64;\n}\n\nexport const STABLE_CURVE_LAYOUT = struct<StableCurveLayout>([blob(8, 'padding'), uint64('amp')]);\n\ninterface SwapInstructionLayout {\n  instruction: any;\n  tokens: u64;\n  minTokens: u64;\n  side: 'bid' | 'ask';\n}\n\nexport const SWAP_INSTRUCTION_LAYOUT = struct<SwapInstructionLayout>([\n  blob(8, 'instruction'),\n  uint64('tokens'),\n  uint64('minTokens'),\n  rustEnum([new Structure([], 'bid'), new Structure([], 'ask')], 'side'),\n]);\n\nexport function accountInfoToAldrinPoolState(address: PublicKey, accountInfo: AccountInfo<Buffer>): AldrinPoolState {\n  const isV2 = accountInfo.owner.equals(ALDRIN_SWAP_V2_PROGRAM_ID) ? true : false;\n\n  const decoded: PoolV2Layout | PoolLayout = (isV2 ? POOL_V2_LAYOUT : POOL_LAYOUT).decode(accountInfo.data) as\n    | PoolV2Layout\n    | PoolLayout;\n\n  const curveObject = 'curveType' in decoded ? { curveType: decoded.curveType, curve: decoded.curve } : {};\n\n  return {\n    isV2,\n    address,\n    poolMint: decoded.poolMint,\n    baseTokenVault: decoded.baseTokenVault,\n    baseTokenMint: decoded.baseTokenMint,\n    quoteTokenVault: decoded.quoteTokenVault,\n    quoteTokenMint: decoded.quoteTokenMint,\n    poolSigner: decoded.poolSigner,\n    feeBaseAccount: decoded.feeBaseAccount,\n    feeQuoteAccount: decoded.feeQuoteAccount,\n    feePoolTokenAccount: decoded.feePoolTokenAccount,\n    fees: {\n      traderFee: Percentage.fromFraction(decoded.fees.tradeFeeNumerator, decoded.fees.tradeFeeDenominator),\n      ownerFee: Percentage.fromFraction(decoded.fees.ownerTradeFeeNumerator, decoded.fees.ownerTradeFeeDenominator),\n    },\n    ...curveObject,\n  };\n}\n\nexport interface AldrinPoolState {\n  isV2: Boolean;\n  address: PublicKey;\n  poolMint: PublicKey;\n  baseTokenVault: PublicKey;\n  baseTokenMint: PublicKey;\n  quoteTokenVault: PublicKey;\n  quoteTokenMint: PublicKey;\n  poolSigner: PublicKey;\n  feeBaseAccount: PublicKey;\n  feeQuoteAccount: PublicKey;\n  feePoolTokenAccount: PublicKey;\n  fees: FeeStructure;\n  curveType?: number;\n  curve?: PublicKey;\n}\n","import { Fraction, TokenSwapConstantProduct, TokenSwapStable } from '@jup-ag/math';\nimport { AccountInfo, PublicKey, TransactionInstruction } from '@solana/web3.js';\nimport JSBI from 'jsbi';\nimport { deserializeAccount } from '@mercurial-finance/optimist';\nimport {\n  AccountInfoMap,\n  Amm,\n  mapAddressToAccountInfos,\n  Quote,\n  QuoteParams,\n  tokenAccountsToJSBIs,\n  SwapParams,\n} from '../amm';\nimport { createAldrinSwapInstruction, createAldrinV2SwapInstruction } from '../jupiterInstruction';\nimport { accountInfoToAldrinPoolState, AldrinPoolState, STABLE_CURVE_LAYOUT } from './poolState';\nimport { AccountInfo as TokenAccountInfo } from '@solana/spl-token';\nimport Decimal from 'decimal.js';\n\ninterface AldrinParams {\n  amp?: number;\n}\n\nexport class AldrinAmm implements Amm {\n  id: string;\n  label = 'Aldrin' as const;\n  shouldPrefetch = false;\n  poolState: AldrinPoolState;\n  private tokenAccounts: TokenAccountInfo[] = [];\n  calculator: TokenSwapConstantProduct | TokenSwapStable;\n\n  constructor(address: PublicKey, accountInfo: AccountInfo<Buffer>, private params: AldrinParams) {\n    this.poolState = accountInfoToAldrinPoolState(address, accountInfo);\n    this.id = address.toBase58();\n\n    if (this.poolState.curveType === 1) {\n      const { amp } = this.params;\n      if (!amp) {\n        throw new Error('Amp is required for a stable curve');\n      }\n\n      this.calculator = new TokenSwapStable(\n        JSBI.BigInt(amp),\n        new Fraction(\n          JSBI.BigInt(this.poolState.fees.traderFee.numerator.toString()),\n          JSBI.BigInt(this.poolState.fees.traderFee.denominator.toString()),\n        ),\n        new Fraction(\n          JSBI.BigInt(this.poolState.fees.ownerFee.numerator.toString()),\n          JSBI.BigInt(this.poolState.fees.ownerFee.denominator.toString()),\n        ),\n      );\n    } else {\n      this.calculator = new TokenSwapConstantProduct(\n        new Fraction(\n          JSBI.BigInt(this.poolState.fees.traderFee.numerator.toString()),\n          JSBI.BigInt(this.poolState.fees.traderFee.denominator.toString()),\n        ),\n        new Fraction(\n          JSBI.BigInt(this.poolState.fees.ownerFee.numerator.toString()),\n          JSBI.BigInt(this.poolState.fees.ownerFee.denominator.toString()),\n        ),\n      );\n    }\n  }\n\n  static accountInfoToAldrinPoolState = accountInfoToAldrinPoolState;\n\n  static decodeStableCurveAmp(accountInfo: AccountInfo<Buffer>) {\n    const { amp } = STABLE_CURVE_LAYOUT.decode(accountInfo.data);\n\n    return amp.toNumber() * 2; // times two for their AMP, dont ask me why, it is what it is\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    return [this.poolState.quoteTokenVault, this.poolState.baseTokenVault];\n  }\n\n  update(accountInfoMap: AccountInfoMap): void {\n    const tokenAccountInfos = mapAddressToAccountInfos(accountInfoMap, this.getAccountsForUpdate());\n\n    this.tokenAccounts = tokenAccountInfos.map((info) => {\n      const tokenAccount = deserializeAccount(info.data);\n      if (!tokenAccount) throw new Error('Invalid token account');\n      return tokenAccount;\n    });\n  }\n\n  getQuote({ sourceMint, amount }: QuoteParams): Quote {\n    if (this.tokenAccounts.length === 0) {\n      throw new Error('Unable to fetch accounts for specified tokens.');\n    }\n\n    let feePct = new Decimal(this.poolState.fees.traderFee.numerator.toString())\n      .div(this.poolState.fees.traderFee.denominator.toString())\n      .add(\n        new Decimal(this.poolState.fees.ownerFee.numerator.toString()).div(\n          this.poolState.fees.ownerFee.denominator.toString(),\n        ),\n      );\n\n    const outputIndex = this.tokenAccounts[0].mint.equals(sourceMint) ? 1 : 0;\n    let result = this.calculator.exchange(tokenAccountsToJSBIs(this.tokenAccounts), JSBI.BigInt(amount), outputIndex);\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount: JSBI.toNumber(result.expectedOutputAmount),\n      feeAmount: JSBI.toNumber(result.fees),\n      feeMint: sourceMint.toBase58(),\n      feePct: feePct.toNumber(),\n      priceImpactPct: result.priceImpact.toNumber(),\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams): TransactionInstruction[] {\n    if (this.poolState.isV2) {\n      if (!this.poolState.curve) {\n        throw new Error('Unable to fetch curve account.');\n      }\n\n      const curve = this.poolState.curve;\n      return [\n        createAldrinV2SwapInstruction({\n          poolState: this.poolState,\n          curve,\n          ...swapParams,\n        }),\n      ];\n    }\n\n    return [\n      createAldrinSwapInstruction({\n        poolState: this.poolState,\n        ...swapParams,\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return [this.poolState.baseTokenMint, this.poolState.quoteTokenMint];\n  }\n}\n","import { PublicKey } from '@solana/web3.js';\n\nexport const STEP_TOKEN_SWAP_PROGRAM_ID = new PublicKey('SSwpMgqNDsyV7mAgN9ady4bDVu5ySjmmXejXvy2vLt1');\n\nexport const PROGRAM_ID_TO_LABEL = new Map<string, string>([\n  ['9W959DqEETiGZocYWCQPaJ6sBmUzgfxXfqGeTEdp3aQP', 'Orca'],\n  [STEP_TOKEN_SWAP_PROGRAM_ID.toBase58(), 'Step'],\n  ['PSwapMdSai8tjrEXcxFeQth87xC4rRsa4VA5mhGhXkP', 'Penguin'],\n  ['SSwapUtytfBdBn1b9NUGG6foMVPtcWgpRU32HToDUZr', 'Saros'],\n]);\n","import { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { struct, u8, blob } from '@solana/buffer-layout';\nimport { u64 } from '@solana/spl-token';\nimport { AccountInfo, PublicKey } from '@solana/web3.js';\nimport { publicKey, uint64 } from '../../utils/layout';\nimport { STEP_TOKEN_SWAP_PROGRAM_ID } from './splTokenSwapPools';\n\ninterface TokenSwapLayout {\n  version: number;\n  isInitialized: number;\n  bumpSeed: number;\n  tokenProgramId: PublicKey;\n  tokenAccountA: PublicKey;\n  tokenAccountB: PublicKey;\n  tokenPool: PublicKey;\n  mintA: PublicKey;\n  mintB: PublicKey;\n  feeAccount: PublicKey;\n  tradeFeeNumerator: u64;\n  tradeFeeDenominator: u64;\n  ownerTradeFeeNumerator: u64;\n  ownerTradeFeeDenominator: u64;\n  ownerWithdrawFeeNumerator: u64;\n  ownerWithdrawFeeDenominator: u64;\n  hostFeeNumerator: u64;\n  hostFeeDenominator: u64;\n  curveType: number;\n  curveParameters: Uint8Array;\n}\n\nconst TokenSwapLayout = struct<TokenSwapLayout>([\n  u8('version'),\n  u8('isInitialized'),\n  u8('bumpSeed'),\n  publicKey('tokenProgramId'),\n  publicKey('tokenAccountA'),\n  publicKey('tokenAccountB'),\n  publicKey('tokenPool'),\n  publicKey('mintA'),\n  publicKey('mintB'),\n  publicKey('feeAccount'),\n  uint64('tradeFeeNumerator'),\n  uint64('tradeFeeDenominator'),\n  uint64('ownerTradeFeeNumerator'),\n  uint64('ownerTradeFeeDenominator'),\n  uint64('ownerWithdrawFeeNumerator'),\n  uint64('ownerWithdrawFeeDenominator'),\n  uint64('hostFeeNumerator'),\n  uint64('hostFeeDenominator'),\n  u8('curveType'),\n  blob(32, 'curveParameters'),\n]);\n\ninterface StepTokenSwapLayout extends TokenSwapLayout {\n  poolNonce: u64;\n}\n\nconst StepTokenSwapLayout = struct<StepTokenSwapLayout>([\n  u8('version'),\n  u8('isInitialized'),\n  u8('bumpSeed'),\n  publicKey('tokenProgramId'),\n  publicKey('tokenAccountA'),\n  publicKey('tokenAccountB'),\n  publicKey('tokenPool'),\n  publicKey('mintA'),\n  publicKey('mintB'),\n  publicKey('feeAccount'),\n  uint64('tradeFeeNumerator'),\n  uint64('tradeFeeDenominator'),\n  uint64('ownerTradeFeeNumerator'),\n  uint64('ownerTradeFeeDenominator'),\n  uint64('ownerWithdrawFeeNumerator'),\n  uint64('ownerWithdrawFeeDenominator'),\n  u8('curveType'),\n  blob(32, 'curveParameters'),\n  u8('poolNonce'),\n]);\n\nexport interface TokenSwapState {\n  address: PublicKey;\n  programId: PublicKey;\n  tokenProgramId: PublicKey;\n  poolToken: PublicKey;\n  feeAccount: PublicKey;\n  authority: PublicKey;\n  tokenAccountA: PublicKey;\n  tokenAccountB: PublicKey;\n  mintA: PublicKey;\n  mintB: PublicKey;\n  tradeFeeNumerator: u64;\n  tradeFeeDenominator: u64;\n  ownerTradeFeeNumerator: u64;\n  ownerTradeFeeDenominator: u64;\n  ownerWithdrawFeeNumerator: u64;\n  ownerWithdrawFeeDenominator: u64;\n  curveType: number;\n  curveParameters: Uint8Array;\n  poolNonce?: u64;\n}\n\nexport function accountInfoToTokenSwapState(\n  address: PublicKey,\n  tokenSwapAccountInfo: AccountInfo<Buffer>,\n): TokenSwapState {\n  const programId = tokenSwapAccountInfo.owner;\n\n  // The layout difference only affects fields we do not actively use\n  const tokenSwapData = (\n    programId.equals(STEP_TOKEN_SWAP_PROGRAM_ID)\n      ? StepTokenSwapLayout.decode(tokenSwapAccountInfo.data)\n      : TokenSwapLayout.decode(tokenSwapAccountInfo.data)\n  ) as TokenSwapLayout | StepTokenSwapLayout;\n\n  if (!tokenSwapData.isInitialized) {\n    throw new Error(`Invalid token swap state`);\n  }\n\n  const [authority] = findProgramAddressSync([address.toBuffer()], programId);\n\n  const poolToken = new PublicKey(tokenSwapData.tokenPool);\n  const feeAccount = new PublicKey(tokenSwapData.feeAccount);\n  const tokenAccountA = new PublicKey(tokenSwapData.tokenAccountA);\n  const tokenAccountB = new PublicKey(tokenSwapData.tokenAccountB);\n  const mintA = new PublicKey(tokenSwapData.mintA);\n  const mintB = new PublicKey(tokenSwapData.mintB);\n  const tokenProgramId = new PublicKey(tokenSwapData.tokenProgramId);\n\n  const tradeFeeNumerator = tokenSwapData.tradeFeeNumerator;\n  const tradeFeeDenominator = tokenSwapData.tradeFeeDenominator;\n  const ownerTradeFeeNumerator = tokenSwapData.ownerTradeFeeNumerator;\n  const ownerTradeFeeDenominator = tokenSwapData.ownerTradeFeeDenominator;\n  const ownerWithdrawFeeNumerator = tokenSwapData.ownerWithdrawFeeNumerator;\n  const ownerWithdrawFeeDenominator = tokenSwapData.ownerWithdrawFeeDenominator;\n\n  const curveType = tokenSwapData.curveType;\n  const curveParameters = tokenSwapData.curveParameters;\n\n  const poolNonce = 'poolNonce' in tokenSwapData ? tokenSwapData.poolNonce : undefined;\n\n  return {\n    address,\n    programId,\n    tokenProgramId,\n    poolToken,\n    feeAccount,\n    authority,\n    tokenAccountA,\n    tokenAccountB,\n    mintA,\n    mintB,\n    tradeFeeNumerator,\n    tradeFeeDenominator,\n    ownerTradeFeeNumerator,\n    ownerTradeFeeDenominator,\n    ownerWithdrawFeeNumerator,\n    ownerWithdrawFeeDenominator,\n    curveType,\n    curveParameters,\n    poolNonce,\n  };\n}\n","import { AccountInfo, PublicKey } from '@solana/web3.js';\nimport Decimal from 'decimal.js';\nimport {\n  AccountInfoMap,\n  Amm,\n  mapAddressToAccountInfos,\n  Quote,\n  QuoteParams,\n  SwapParams,\n  tokenAccountsToJSBIs,\n} from '../amm';\nimport { createTokenSwapInstruction } from '../jupiterInstruction';\nimport { accountInfoToTokenSwapState, TokenSwapState } from './tokenSwapLayout';\nimport { deserializeAccount } from '@mercurial-finance/optimist';\nimport { Fraction, TokenSwapConstantProduct, TokenSwapStable } from '@jup-ag/math';\nimport JSBI from 'jsbi';\nimport { AccountInfo as TokenAccountInfo } from '@solana/spl-token';\nimport { STEP_TOKEN_SWAP_PROGRAM_ID } from './splTokenSwapPools';\n\nenum CurveType {\n  ConstantProduct = 0,\n  Stable = 2,\n}\n\n// Abstract any SPL token swap based AMM\nexport class SplTokenSwapAmm implements Amm {\n  id: string;\n  shouldPrefetch = false;\n  private tokenSwapState: TokenSwapState;\n  private curveType: CurveType;\n\n  private tokenAccounts: TokenAccountInfo[] = [];\n  calculator: TokenSwapConstantProduct | TokenSwapStable;\n\n  constructor(address: PublicKey, swapStateAccountInfo: AccountInfo<Buffer>, public label: string) {\n    this.id = address.toBase58();\n    this.tokenSwapState = accountInfoToTokenSwapState(address, swapStateAccountInfo);\n\n    this.curveType = this.tokenSwapState.curveType;\n\n    if (!(this.curveType in CurveType)) {\n      throw new Error(`curveType ${this.tokenSwapState.curveType} is not supported`);\n    }\n\n    if (this.tokenSwapState.curveType === CurveType.ConstantProduct) {\n      this.calculator = new TokenSwapConstantProduct(\n        new Fraction(\n          JSBI.BigInt(this.tokenSwapState.tradeFeeNumerator.toString()),\n          JSBI.BigInt(this.tokenSwapState.tradeFeeDenominator.toString()),\n        ),\n        new Fraction(\n          JSBI.BigInt(this.tokenSwapState.ownerTradeFeeNumerator.toString()),\n          JSBI.BigInt(this.tokenSwapState.ownerTradeFeeDenominator.toString()),\n        ),\n      );\n    } else {\n      this.calculator = new TokenSwapStable(\n        JSBI.BigInt(this.tokenSwapState.curveParameters[0]),\n        new Fraction(\n          JSBI.BigInt(this.tokenSwapState.tradeFeeNumerator.toString()),\n          JSBI.BigInt(this.tokenSwapState.tradeFeeDenominator.toString()),\n        ),\n        new Fraction(\n          JSBI.BigInt(this.tokenSwapState.ownerTradeFeeNumerator.toString()),\n          JSBI.BigInt(this.tokenSwapState.ownerTradeFeeDenominator.toString()),\n        ),\n      );\n    }\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    return [this.tokenSwapState.tokenAccountA, this.tokenSwapState.tokenAccountB];\n  }\n\n  update(accountInfoMap: AccountInfoMap): void {\n    const tokenAccountInfos = mapAddressToAccountInfos(accountInfoMap, this.getAccountsForUpdate());\n\n    this.tokenAccounts = tokenAccountInfos.map((info) => {\n      const tokenAccount = deserializeAccount(info.data);\n      if (!tokenAccount) {\n        throw new Error('Invalid token account');\n      }\n      return tokenAccount;\n    });\n  }\n\n  getQuote({ sourceMint, amount }: QuoteParams): Quote {\n    if (this.tokenAccounts.length === 0) {\n      throw new Error('Unable to fetch accounts for specified tokens.');\n    }\n\n    let feePct = new Decimal(this.tokenSwapState.tradeFeeNumerator.toString())\n      .div(this.tokenSwapState.tradeFeeDenominator.toString())\n      .add(\n        new Decimal(this.tokenSwapState.ownerTradeFeeNumerator.toString()).div(\n          this.tokenSwapState.ownerTradeFeeDenominator.toString(),\n        ),\n      );\n\n    const outputIndex = this.tokenAccounts[0].mint.equals(sourceMint) ? 1 : 0;\n    let result = this.calculator.exchange(\n      tokenAccountsToJSBIs(this.tokenAccounts),\n      JSBI.BigInt(Math.floor(amount)),\n      outputIndex,\n    );\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount: JSBI.toNumber(result.expectedOutputAmount),\n      feeAmount: JSBI.toNumber(result.fees),\n      feeMint: sourceMint.toBase58(),\n      feePct: feePct.toNumber(),\n      priceImpactPct: result.priceImpact.toNumber(),\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams) {\n    return [\n      createTokenSwapInstruction({\n        tokenSwapState: this.tokenSwapState,\n        ...swapParams,\n        isStep: this.tokenSwapState.programId.equals(STEP_TOKEN_SWAP_PROGRAM_ID),\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return [this.tokenSwapState.mintA, this.tokenSwapState.mintB];\n  }\n}\n","import { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { struct, u8, u32 } from '@solana/buffer-layout';\nimport { u64 } from '@solana/spl-token';\nimport { AccountInfo, PublicKey } from '@solana/web3.js';\nimport { uint64, publicKey } from '../../utils/layout';\n\nexport const FEE_DENOMINATOR = Math.pow(10, 10);\n\ninterface MercurialSwapLayout {\n  version: number;\n  isInitialized: number;\n  nonce: number;\n  amplificationCoefficient: u64;\n  feeNumerator: u64;\n  adminFeeNumerator: u64;\n  tokenAccountsLength: number;\n  precisionFactor: u64;\n  precisionMultiplierA: u64;\n  precisionMultiplierB: u64;\n  precisionMultiplierC: u64;\n  precisionMultiplierD: u64;\n  tokenAccountA: PublicKey;\n  tokenAccountB: PublicKey;\n  tokenAccountC: PublicKey;\n  tokenAccountD: PublicKey;\n}\n\nexport const MercurialSwapLayout = struct<MercurialSwapLayout>([\n  u8('version'),\n  u8('isInitialized'),\n  u8('nonce'),\n  uint64('amplificationCoefficient'),\n  uint64('feeNumerator'),\n  uint64('adminFeeNumerator'),\n  u32('tokenAccountsLength'),\n  uint64('precisionFactor'),\n  uint64('precisionMultiplierA'),\n  uint64('precisionMultiplierB'),\n  uint64('precisionMultiplierC'),\n  uint64('precisionMultiplierD'),\n  publicKey('tokenAccountA'),\n  publicKey('tokenAccountB'),\n  publicKey('tokenAccountC'),\n  publicKey('tokenAccountD'),\n]);\n\nexport interface MercurialSwapLayoutState {\n  programId: PublicKey;\n  authority: PublicKey;\n  isInitialized: boolean;\n  nonce: number;\n  ammId: PublicKey;\n  amplificationCoefficient: number;\n  feeNumerator: number;\n  tokenAccountsLength: number;\n  precisionFactor: number;\n  precisionMultipliers: number[];\n  tokenAccounts: PublicKey[];\n}\n\nexport const accountInfoToMercurialSwapLayout = (\n  address: PublicKey,\n  accountInfo: AccountInfo<Buffer>,\n): MercurialSwapLayoutState => {\n  const programId = accountInfo.owner;\n  const decoded = MercurialSwapLayout.decode(accountInfo.data);\n  const tokenAccountsLength = decoded.tokenAccountsLength;\n  const [authority] = findProgramAddressSync([address.toBuffer()], programId);\n\n  const precisionMultipliers = [\n    decoded.precisionMultiplierA.toNumber(),\n    decoded.precisionMultiplierB.toNumber(),\n    decoded.precisionMultiplierC.toNumber(),\n    decoded.precisionMultiplierD.toNumber(),\n  ].slice(0, tokenAccountsLength);\n\n  const tokenAccounts = [\n    decoded.tokenAccountA,\n    decoded.tokenAccountB,\n    decoded.tokenAccountC,\n    decoded.tokenAccountD,\n  ].slice(0, tokenAccountsLength);\n\n  return {\n    programId,\n    authority,\n    isInitialized: Boolean(decoded.isInitialized),\n    nonce: decoded.nonce,\n    ammId: address,\n    amplificationCoefficient: decoded.amplificationCoefficient.toNumber(),\n    feeNumerator: decoded.feeNumerator.toNumber(),\n    tokenAccountsLength,\n    precisionFactor: decoded.precisionFactor.toNumber(),\n    precisionMultipliers,\n    tokenAccounts,\n  };\n};\n","import { Fraction, Stable } from '@jup-ag/math';\nimport { AccountInfo, PublicKey, TransactionInstruction } from '@solana/web3.js';\nimport JSBI from 'jsbi';\nimport {\n  AccountInfoMap,\n  Amm,\n  mapAddressToAccountInfos,\n  Quote,\n  QuoteParams,\n  tokenAccountsToJSBIs,\n  SwapParams,\n} from '../amm';\nimport { createMercurialExchangeInstruction } from '../jupiterInstruction';\nimport { deserializeAccount } from '@mercurial-finance/optimist';\nimport { AccountInfo as TokenAccountInfo } from '@solana/spl-token';\nimport { accountInfoToMercurialSwapLayout, FEE_DENOMINATOR, MercurialSwapLayoutState } from './swapLayout';\n\ninterface MercurialParams {\n  tokenMints: string[];\n}\n\nexport class MercurialAmm implements Amm {\n  id: string;\n  label = 'Mercurial';\n  shouldPrefetch = false;\n  swapLayout: MercurialSwapLayoutState;\n  private tokenAccounts: TokenAccountInfo[] = [];\n  private calculator: Stable;\n\n  static decodeSwapLayout = accountInfoToMercurialSwapLayout;\n\n  constructor(address: PublicKey, accountInfo: AccountInfo<Buffer>, private params: MercurialParams) {\n    this.id = address.toBase58();\n    this.swapLayout = accountInfoToMercurialSwapLayout(address, accountInfo);\n    this.calculator = new Stable(\n      JSBI.BigInt(this.swapLayout.tokenAccountsLength),\n      JSBI.BigInt(this.swapLayout.amplificationCoefficient),\n      this.swapLayout.precisionMultipliers.map((precisionMultiplier) => JSBI.BigInt(precisionMultiplier)),\n      new Fraction(JSBI.BigInt(this.swapLayout.feeNumerator), JSBI.BigInt(FEE_DENOMINATOR)),\n    );\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    return this.swapLayout.tokenAccounts;\n  }\n\n  update(accountInfoMap: AccountInfoMap) {\n    let tokenAccountInfos = mapAddressToAccountInfos(accountInfoMap, this.getAccountsForUpdate());\n\n    this.tokenAccounts = tokenAccountInfos\n      .map((info) => deserializeAccount(info.data))\n      .filter((x): x is TokenAccountInfo => x !== null);\n  }\n\n  getQuote({ sourceMint, destinationMint, amount }: QuoteParams): Quote {\n    if (this.tokenAccounts.length === 0) {\n      throw new Error('Unable to fetch accounts for specified tokens.');\n    }\n\n    const inputIndex = this.tokenAccounts.findIndex((tokenAccount) => tokenAccount.mint.equals(sourceMint));\n    const outputIndex = this.tokenAccounts.findIndex((tokenAccount) => tokenAccount.mint.equals(destinationMint));\n    const result = this.calculator.exchange(\n      tokenAccountsToJSBIs(this.tokenAccounts),\n      JSBI.BigInt(amount),\n      inputIndex,\n      outputIndex,\n    );\n\n    const feePct = this.swapLayout.feeNumerator / FEE_DENOMINATOR;\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount: JSBI.toNumber(result.expectedOutputAmount),\n      feeAmount: JSBI.toNumber(result.fees),\n      feeMint: destinationMint.toBase58(),\n      feePct: feePct,\n      priceImpactPct: result.priceImpact.toNumber(),\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams): TransactionInstruction[] {\n    return [\n      createMercurialExchangeInstruction({\n        swapLayout: this.swapLayout,\n        ...swapParams,\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return this.params.tokenMints.map((tokenMint) => new PublicKey(tokenMint));\n  }\n}\n","import { Fraction, TokenSwapConstantProduct } from '@jup-ag/math';\nimport { AccountInfo, Connection, PublicKey, TransactionInstruction } from '@solana/web3.js';\nimport JSBI from 'jsbi';\nimport { deserializeAccount } from '@mercurial-finance/optimist';\nimport {\n  AccountInfoMap,\n  Amm,\n  mapAddressToAccountInfos,\n  Quote,\n  QuoteParams,\n  tokenAccountsToJSBIs,\n  SwapParams,\n} from '../amm';\nimport { createCropperSwapInstruction } from '../jupiterInstruction';\n\nimport { AccountInfo as TokenAccountInfo } from '@solana/spl-token';\nimport {\n  accountInfoToCropperPoolState,\n  CropperPoolState,\n  stateAccountInfoToCropperState,\n  CROPPER_STATE_ADDRESS,\n} from './swapLayout';\nimport Decimal from 'decimal.js';\n\ninterface CropperParams {\n  tokenAFeeAccount: PublicKey;\n  tokenBFeeAccount: PublicKey;\n  returnFeeNumerator: number;\n  fixedFeeNumerator: number;\n  feeDenominator: number;\n}\n\nexport class CropperAmm implements Amm {\n  id: string;\n  label = 'Cropper' as const;\n  shouldPrefetch = false;\n  poolState: CropperPoolState;\n  private tokenAccounts: TokenAccountInfo[] = [];\n  private calculator: TokenSwapConstantProduct;\n  private feePct: Decimal;\n\n  // Hardcoded because no where to query this\n  static async getStateFromStateAccount(connection: Connection) {\n    const accountInfo = await connection.getAccountInfo(CROPPER_STATE_ADDRESS);\n\n    if (!accountInfo) {\n      throw new Error('State account not found');\n    }\n\n    return stateAccountInfoToCropperState(accountInfo);\n  }\n\n  static decodePoolState = accountInfoToCropperPoolState;\n\n  constructor(address: PublicKey, accountInfo: AccountInfo<Buffer>, private params: CropperParams) {\n    this.id = address.toBase58();\n    this.poolState = accountInfoToCropperPoolState(address, accountInfo);\n\n    this.feePct = new Decimal(this.params.fixedFeeNumerator)\n      .div(this.params.feeDenominator)\n      .add(new Decimal(this.params.returnFeeNumerator).div(this.params.feeDenominator));\n\n    this.params.tokenAFeeAccount = new PublicKey(this.params.tokenAFeeAccount);\n    this.params.tokenBFeeAccount = new PublicKey(this.params.tokenBFeeAccount);\n\n    this.calculator = new TokenSwapConstantProduct(\n      new Fraction(JSBI.BigInt(this.params.fixedFeeNumerator), JSBI.BigInt(this.params.feeDenominator)),\n      new Fraction(JSBI.BigInt(this.params.returnFeeNumerator), JSBI.BigInt(this.params.feeDenominator)),\n    );\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    return [this.poolState.tokenAAccount, this.poolState.tokenBAccount];\n  }\n\n  update(accountInfoMap: AccountInfoMap): void {\n    const tokenAccountInfos = mapAddressToAccountInfos(accountInfoMap, this.getAccountsForUpdate());\n\n    this.tokenAccounts = tokenAccountInfos.map((info) => {\n      const tokenAccount = deserializeAccount(info.data);\n      if (!tokenAccount) {\n        throw new Error('Invalid token account');\n      }\n      return tokenAccount;\n    });\n  }\n\n  getQuote({ sourceMint, amount }: QuoteParams): Quote {\n    if (this.tokenAccounts.length === 0) {\n      throw new Error('Unable to fetch accounts for specified tokens.');\n    }\n\n    const outputIndex = this.tokenAccounts[0].mint.equals(sourceMint) ? 1 : 0;\n    const result = this.calculator.exchange(tokenAccountsToJSBIs(this.tokenAccounts), JSBI.BigInt(amount), outputIndex);\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount: JSBI.toNumber(result.expectedOutputAmount),\n      feeAmount: JSBI.toNumber(result.fees),\n      feeMint: sourceMint.toBase58(),\n      feePct: this.feePct.toNumber(),\n      priceImpactPct: result.priceImpact.toNumber(),\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams): TransactionInstruction[] {\n    const feeAccount = swapParams.sourceMint.equals(this.poolState.mintA)\n      ? this.params.tokenAFeeAccount\n      : this.params.tokenBFeeAccount;\n\n    return [\n      createCropperSwapInstruction({\n        poolState: this.poolState,\n        feeAccount,\n        ...swapParams,\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return [this.poolState.mintA, this.poolState.mintB];\n  }\n}\n","import { TokenSwapAccountLayout } from '@jup-ag/crema-sdk';\nimport { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { AccountInfo, PublicKey } from '@solana/web3.js';\nimport Decimal from 'decimal.js';\n\nexport interface CremaPoolState {\n  programId: PublicKey;\n  authority: PublicKey;\n  version: number;\n  isInitialized: boolean;\n  nonce: number;\n  ammId: PublicKey;\n  tokenProgramId: PublicKey;\n  tokenAAccount: PublicKey;\n  tokenBAccount: PublicKey;\n  ticksKey: PublicKey;\n  mintA: PublicKey;\n  mintB: PublicKey;\n  fee: Decimal;\n  currentSqrtPrice: Decimal;\n  currentLiquity: Decimal;\n}\n\nexport const accountInfoToCremaPoolState = (address: PublicKey, accountInfo: AccountInfo<Buffer>): CremaPoolState => {\n  const programId = accountInfo.owner;\n\n  const decoded = TokenSwapAccountLayout.decode(accountInfo.data);\n  const [authority] = findProgramAddressSync([address.toBuffer()], programId);\n\n  return {\n    programId,\n    authority,\n    version: decoded.version,\n    isInitialized: Boolean(decoded.isInitialized),\n    nonce: decoded.nonce,\n    ammId: address,\n    tokenProgramId: decoded.tokenProgramId,\n    tokenAAccount: decoded.swapTokenA,\n    tokenBAccount: decoded.swapTokenB,\n    ticksKey: decoded.ticksKey,\n    mintA: decoded.tokenAMint,\n    mintB: decoded.tokenBMint,\n    fee: decoded.fee,\n    currentSqrtPrice: decoded.currentSqrtPrice,\n    currentLiquity: decoded.currentLiquity,\n  };\n};\n","import { AccountInfoMap, Amm, mapAddressToAccountInfos, Quote, QuoteParams, SwapParams } from '../amm';\nimport { AccountInfo, PublicKey, TransactionInstruction } from '@solana/web3.js';\nimport { accountInfoToCremaPoolState, CremaPoolState } from './swapLayout';\nimport { createCremaSwapInstruction } from '../jupiterInstruction';\nimport { calculateSwapA2B, calculateSwapB2A, parseTicksAccount, Tick } from '@jup-ag/crema-sdk';\nimport Decimal from 'decimal.js';\n\nexport class CremaAmm implements Amm {\n  id: string;\n  label = 'Crema';\n  shouldPrefetch = false;\n  private ticks: Tick[] | undefined;\n  private poolState: CremaPoolState;\n\n  constructor(address: PublicKey, accountInfo: AccountInfo<Buffer>) {\n    this.poolState = accountInfoToCremaPoolState(address, accountInfo);\n    this.id = address.toBase58();\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    return [this.poolState.ammId, this.poolState.ticksKey];\n  }\n\n  update(accountInfoMap: AccountInfoMap): void {\n    const [tokenSwapAccountInfo, ticksAccountInfo] = mapAddressToAccountInfos(\n      accountInfoMap,\n      this.getAccountsForUpdate(),\n    );\n\n    this.poolState = accountInfoToCremaPoolState(this.poolState.ammId, tokenSwapAccountInfo);\n\n    const ticksInfo = parseTicksAccount(this.poolState.ticksKey, ticksAccountInfo);\n    if (!ticksInfo) throw new Error(`Ticks account invalid: ${this.poolState.ticksKey.toBase58()}`);\n    this.ticks = ticksInfo.data.ticks;\n  }\n\n  getQuote({ sourceMint, amount }: QuoteParams): Quote {\n    if (!this.ticks) {\n      throw new Error('Unable to fetch accounts for ticks.');\n    }\n\n    // Crema SDK doesn't support 0 amount input\n    if (amount === 0) {\n      return {\n        notEnoughLiquidity: false,\n        inAmount: amount,\n        outAmount: 0,\n        feeAmount: 0,\n        feeMint: sourceMint.toBase58(),\n        feePct: this.poolState.fee.toNumber(),\n        priceImpactPct: 0,\n      };\n    }\n\n    const result = this.poolState.mintA.equals(sourceMint)\n      ? this.preSwapA(new Decimal(amount))\n      : this.preSwapB(new Decimal(amount));\n\n    if (result.revert) {\n      throw new Error('Crema error: insufficient liquidity');\n    }\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount: result.amountOut.toNumber(),\n      feeAmount: result.feeUsed.toNumber(),\n      feeMint: sourceMint.toBase58(),\n      feePct: this.poolState.fee.toNumber(),\n      priceImpactPct: result.impact.toNumber(),\n    };\n  }\n\n  preSwapA(amountIn: Decimal): {\n    amountOut: Decimal;\n    amountUsed: Decimal;\n    feeUsed: Decimal;\n    afterPrice: Decimal;\n    afterLiquity: Decimal;\n    impact: Decimal;\n    revert: boolean;\n  } {\n    if (!this.ticks) {\n      throw new Error('Unable to fetch accounts for ticks.');\n    }\n\n    const result = calculateSwapA2B(\n      this.ticks,\n      this.poolState.currentSqrtPrice,\n      this.poolState.fee,\n      this.poolState.currentLiquity,\n      amountIn,\n    );\n\n    const currentPriceA = this.poolState.currentSqrtPrice.pow(2);\n    const transactionPriceA = result.amountOut.div(result.amountUsed);\n    const impact = transactionPriceA.sub(currentPriceA).div(currentPriceA).abs();\n    const revert = result.amountUsed.lessThan(amountIn);\n\n    return {\n      ...result,\n      impact,\n      revert,\n    };\n  }\n\n  preSwapB(amountIn: Decimal): {\n    amountOut: Decimal;\n    amountUsed: Decimal;\n    feeUsed: Decimal;\n    afterPrice: Decimal;\n    afterLiquity: Decimal;\n    impact: Decimal;\n    revert: boolean;\n  } {\n    if (!this.ticks) {\n      throw new Error('Unable to fetch accounts for ticks.');\n    }\n\n    const result = calculateSwapB2A(\n      this.ticks,\n      this.poolState.currentSqrtPrice,\n      this.poolState.fee,\n      this.poolState.currentLiquity,\n      amountIn,\n    );\n\n    const currentPriceA = this.poolState.currentSqrtPrice.pow(2);\n    const currentPriceB = new Decimal(1).div(currentPriceA);\n    const transactionPriceB = result.amountOut.div(result.amountUsed);\n    const impact = transactionPriceB.sub(currentPriceB).div(currentPriceB).abs();\n    const revert = result.amountUsed.lessThan(amountIn);\n\n    return {\n      ...result,\n      impact,\n      revert,\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams): TransactionInstruction[] {\n    return [\n      createCremaSwapInstruction({\n        poolState: this.poolState,\n        ...swapParams,\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return [this.poolState.mintA, this.poolState.mintB];\n  }\n}\n","import { struct, u8, Layout, blob } from '@solana/buffer-layout';\nimport { PublicKey, AccountInfo } from '@solana/web3.js';\nimport { u64 } from '@solana/spl-token';\nimport { publicKey, uint64 } from '../../utils/layout';\n\ninterface SenchaSwapLayout {\n  discriminator: any;\n  factory: PublicKey;\n  bump: number;\n  index: u64;\n  admin: PublicKey;\n  token0Reserves: PublicKey;\n  token0Mint: PublicKey;\n  token0Fees: PublicKey;\n  token1Reserves: PublicKey;\n  token1Mint: PublicKey;\n  token1Fees: PublicKey;\n  isPaused: number;\n  poolMint: PublicKey;\n  tradeFeeKbps: u64;\n  withdrawFeeKbps: u64;\n  adminTradeFeeKbps: u64;\n  adminWithdrawFeeKbps: u64;\n}\n\nexport const SenchaSwapLayout = struct<SenchaSwapLayout>([\n  blob(8, 'discriminator'),\n  publicKey('factory'),\n  u8('bump'),\n  uint64('index'),\n  publicKey('admin'),\n  publicKey('token0Reserves'),\n  publicKey('token0Mint'),\n  publicKey('token0Fees'),\n  publicKey('token1Reserves'),\n  publicKey('token1Mint'),\n  publicKey('token1Fees'),\n  u8('isPaused'),\n  publicKey('poolMint'),\n  uint64('tradeFeeKbps'),\n  uint64('withdrawFeeKbps'),\n  uint64('adminTradeFeeKbps'),\n  uint64('adminWithdrawFeeKbps'),\n]);\n\nexport interface SenchaPoolState {\n  programId: PublicKey;\n  isPaused: boolean;\n  bump: number;\n  ammId: PublicKey;\n  token0Reserves: PublicKey;\n  token1Reserves: PublicKey;\n  token0Mint: PublicKey;\n  token1Mint: PublicKey;\n  token0Fees: PublicKey;\n  token1Fees: PublicKey;\n  poolMint: PublicKey;\n  tradeFeeKbps: number;\n}\n\nexport const accountInfoToSenchaPoolState = (address: PublicKey, accountInfo: AccountInfo<Buffer>): SenchaPoolState => {\n  const programId = accountInfo.owner;\n  const decoded = SenchaSwapLayout.decode(accountInfo.data);\n\n  return {\n    programId,\n    isPaused: Boolean(decoded.isPaused),\n    bump: decoded.bump,\n    ammId: address,\n    token0Reserves: decoded.token0Reserves,\n    token1Reserves: decoded.token1Reserves,\n    token0Mint: decoded.token0Mint,\n    token1Mint: decoded.token1Mint,\n    token0Fees: decoded.token0Fees,\n    token1Fees: decoded.token1Fees,\n    poolMint: decoded.poolMint,\n    tradeFeeKbps: decoded.tradeFeeKbps.toNumber(),\n  };\n};\n","import { AccountInfo, PublicKey, TransactionInstruction } from '@solana/web3.js';\nimport {\n  AccountInfoMap,\n  Amm,\n  mapAddressToAccountInfos,\n  Quote,\n  QuoteParams,\n  tokenAccountsToJSBIs,\n  SwapParams,\n} from '../amm';\nimport { accountInfoToSenchaPoolState, SenchaPoolState } from './swapLayout';\nimport { AccountInfo as TokenAccountInfo } from '@solana/spl-token';\nimport { deserializeAccount } from '@mercurial-finance/optimist';\nimport { createSenchaSwapInstruction } from '../jupiterInstruction';\nimport { Fraction, TokenSwapConstantProduct, ZERO } from '@jup-ag/math';\nimport JSBI from 'jsbi';\n\nexport class SenchaAmm implements Amm {\n  id: string;\n  label = 'Sencha' as const;\n  shouldPrefetch = false;\n  poolState: SenchaPoolState;\n  private calculator: TokenSwapConstantProduct;\n  private tokenAccounts: TokenAccountInfo[] = [];\n\n  constructor(address: PublicKey, accountInfo: AccountInfo<Buffer>) {\n    this.id = address.toBase58();\n    this.poolState = accountInfoToSenchaPoolState(address, accountInfo);\n    this.calculator = new TokenSwapConstantProduct(\n      new Fraction(\n        JSBI.BigInt(this.poolState.tradeFeeKbps),\n        JSBI.BigInt(10000000), // 100% = 10000000kbps\n      ),\n      new Fraction(ZERO, ZERO),\n      false,\n    );\n  }\n\n  get isPaused() {\n    return this.poolState.isPaused;\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    return [this.poolState.token0Reserves, this.poolState.token1Reserves];\n  }\n\n  update(accountInfoMap: AccountInfoMap): void {\n    const tokenAccountInfos = mapAddressToAccountInfos(accountInfoMap, this.getAccountsForUpdate());\n\n    this.tokenAccounts = tokenAccountInfos.map((info) => {\n      const tokenAccount = deserializeAccount(info.data);\n      if (!tokenAccount) {\n        throw new Error('Invalid token account');\n      }\n      return tokenAccount;\n    });\n  }\n\n  getQuote({ sourceMint, amount }: QuoteParams): Quote {\n    if (this.tokenAccounts.length === 0) {\n      throw new Error('Unable to fetch accounts for specified tokens.');\n    }\n\n    const outputIndex = this.tokenAccounts[0].mint.equals(sourceMint) ? 1 : 0;\n    let result = this.calculator.exchange(tokenAccountsToJSBIs(this.tokenAccounts), JSBI.BigInt(amount), outputIndex);\n\n    let feePct = this.poolState.tradeFeeKbps / 10000000; // 100% kbps\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount: JSBI.toNumber(result.expectedOutputAmount),\n      feeAmount: JSBI.toNumber(result.fees),\n      feeMint: sourceMint.toBase58(),\n      feePct,\n      priceImpactPct: result.priceImpact.toNumber(),\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams): TransactionInstruction[] {\n    return [\n      createSenchaSwapInstruction({\n        poolState: this.poolState,\n        ...swapParams,\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return [this.poolState.token0Mint, this.poolState.token1Mint];\n  }\n}\n","import { getCurveAmount, getParsedData, IAmmData, ICurveAmount, IPoolInfo, TradeDirection } from '@jup-ag/lifinity-sdk';\nimport { AccountInfo, PublicKey, TransactionInstruction } from '@solana/web3.js';\nimport { AccountInfoMap, Amm, Quote, QuoteParams, SwapParams } from '../amm';\nimport { accountInfoLifinitySwapLayout, LifinitySwapLayoutState, swapStateToPoolInfo } from './swapLayout';\nimport { createLifinitySwapInstruction } from '../jupiterInstruction';\nimport Decimal from 'decimal.js';\n\nexport class LifinityAmm implements Amm {\n  id: string;\n  label = 'Lifinity' as const;\n  shouldPrefetch = false;\n  private swapState: LifinitySwapLayoutState;\n  private poolInfo: IPoolInfo;\n  private accountInfos: Array<{ publicKey: PublicKey; account: AccountInfo<Buffer> }> = [];\n\n  constructor(address: PublicKey, private ammAccountInfo: AccountInfo<Buffer>) {\n    this.id = address.toBase58();\n    this.swapState = accountInfoLifinitySwapLayout(address, ammAccountInfo);\n    this.poolInfo = swapStateToPoolInfo(this.swapState);\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    return [\n      this.swapState.poolCoinTokenAccount,\n      this.swapState.poolPcTokenAccount,\n      this.swapState.configAccount,\n      this.swapState.pythAccount,\n      this.swapState.pythPcAccount,\n    ];\n  }\n\n  update(accountInfoMap: AccountInfoMap): void {\n    this.getAccountsForUpdate().forEach((publicKey, idx) => {\n      const account = accountInfoMap.get(publicKey.toBase58());\n      if (account) {\n        this.accountInfos[idx] = {\n          publicKey,\n          account,\n        };\n      }\n    });\n  }\n\n  getQuote({ sourceMint, amount }: QuoteParams): Quote {\n    if (this.accountInfos.length !== this.getAccountsForUpdate().length) {\n      throw new Error('Accounts not loaded');\n    }\n\n    const tradeDirection = this.swapState.poolCoinMint.equals(sourceMint) ? TradeDirection.AtoB : TradeDirection.BtoA;\n    const { amm, pyth, pythPc, fees, coinBalance, pcBalance, config }: IAmmData = getParsedData(\n      [{ publicKey: this.swapState.amm, account: this.ammAccountInfo }, ...this.accountInfos],\n      this.poolInfo,\n    );\n\n    if (\n      !pyth.status.equals(1) ||\n      // pythPc can be undefined from the lifinity SDK\n      (pythPc && !pythPc.status.equals(1))\n    ) {\n      throw new Error('Pyth accounts are outdated');\n    }\n\n    const amountIn = new Decimal(amount);\n    const result: ICurveAmount = getCurveAmount(\n      amountIn,\n      pyth.publishSlot.toNumber(), // Use pyth publish slot to not throw error\n      amm,\n      fees,\n      coinBalance,\n      pcBalance,\n      config,\n      pyth,\n      pythPc,\n      tradeDirection,\n    );\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount: result.amountSwapped.toNumber(),\n      feeAmount: result.fee.toNumber(),\n      feeMint: sourceMint.toBase58(),\n      feePct: result.feePercent.toNumber(),\n      priceImpactPct: result.priceImpact.toNumber(),\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams): TransactionInstruction[] {\n    return [\n      createLifinitySwapInstruction({\n        swapState: this.swapState,\n        ...swapParams,\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return [this.swapState.poolCoinMint, this.swapState.poolPcMint];\n  }\n}\n","import { AccountInfo, PublicKey } from '@solana/web3.js';\nimport { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { LIFINITY_AMM_LAYOUT, IPoolInfo } from '@jup-ag/lifinity-sdk';\n\nexport interface LifinitySwapLayoutState {\n  programId: PublicKey;\n  authority: PublicKey;\n  amm: PublicKey;\n  tokenAMint: PublicKey;\n  tokenBMint: PublicKey;\n  poolMint: PublicKey;\n  feeAccount: PublicKey;\n  pythAccount: PublicKey;\n  pythPcAccount: PublicKey;\n  configAccount: PublicKey;\n  poolCoinTokenAccount: PublicKey;\n  poolCoinMint: PublicKey;\n  poolPcTokenAccount: PublicKey;\n  poolPcMint: PublicKey;\n}\n\nexport const swapStateToPoolInfo = (state: LifinitySwapLayoutState): IPoolInfo => {\n  return {\n    amm: state.amm.toBase58(),\n    configAccount: state.configAccount.toBase58(),\n    feeAccount: state.feeAccount.toBase58(),\n    pythAccount: state.pythAccount.toBase58(),\n    pythPcAccount: state.pythPcAccount.toBase58(),\n    poolCoinMint: state.poolCoinMint.toBase58(),\n    poolCoinTokenAccount: state.poolCoinTokenAccount.toBase58(),\n    poolMint: state.poolMint.toBase58(),\n    poolPcTokenAccount: state.poolPcTokenAccount.toBase58(),\n    poolPcMint: state.poolPcMint.toBase58(),\n    // We don't use decimals at the moment, so default to 0, if we need to use it later, we can add it from API\n    poolCoinDecimal: 0,\n    poolPcDecimal: 0,\n    poolMintDecimal: 0,\n    pythBaseDecimal: 0,\n  };\n};\n\nexport const accountInfoLifinitySwapLayout = (\n  address: PublicKey,\n  accountInfo: AccountInfo<Buffer>,\n): LifinitySwapLayoutState => {\n  const programId = accountInfo.owner;\n  const decoded = LIFINITY_AMM_LAYOUT.decode(accountInfo.data);\n  const [authority] = findProgramAddressSync([address.toBuffer()], programId);\n\n  return {\n    programId,\n    authority,\n    amm: address,\n    tokenAMint: decoded.tokenAMint,\n    tokenBMint: decoded.tokenBMint,\n    poolMint: decoded.poolMint,\n    feeAccount: decoded.poolFeeAccount,\n    pythAccount: decoded.pythAccount,\n    pythPcAccount: decoded.pythPcAccount,\n    configAccount: decoded.configAccount,\n    poolCoinTokenAccount: decoded.tokenAAccount,\n    poolCoinMint: decoded.tokenAMint,\n    poolPcTokenAccount: decoded.tokenBAccount,\n    poolPcMint: decoded.tokenBMint,\n  };\n};\n","import { AccountInfo, PublicKey } from '@solana/web3.js';\nimport Decimal from 'decimal.js';\nimport { AccountInfoMap, Amm, Quote, QuoteParams, SwapParams } from '../amm';\nimport { createWhirlpoolSwapInstruction } from '../jupiterInstruction';\nimport { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { WHIRLPOOL_PROGRAM_ID } from '../../constants';\nimport {\n  parseWhirlpool,\n  parseTickArray,\n  WhirlpoolData,\n  getSwapQuote,\n  getTickArrayPks,\n  TickArrayData,\n  getTickArrayPublicKeysForSwap,\n} from '@jup-ag/whirlpool-sdk';\nimport BN from 'bn.js';\n\nconst FEE_RATE_MUL_VALUE = 1_000_000;\n\nfunction fromX64(num: BN): Decimal {\n  return new Decimal(num.toString()).mul(Decimal.pow(2, -64));\n}\n\nfunction parseWhirlpoolSafe(address: PublicKey, data: Buffer) {\n  const whirlpoolData = parseWhirlpool(data);\n  if (!whirlpoolData) throw new Error(`Failed to parse whilpool ${address.toBase58()}`);\n  return whirlpoolData;\n}\n\nexport class WhirlpoolAmm implements Amm {\n  id: string;\n  label = 'Orca (Whirlpools)';\n  shouldPrefetch = true;\n\n  private whirlpoolData: WhirlpoolData;\n  private tickArrays: Map<string, TickArrayData> = new Map();\n  private tickPks: PublicKey[];\n  private oracle: PublicKey;\n  private feePct: number;\n\n  constructor(private address: PublicKey, whirlpoolAccountInfo: AccountInfo<Buffer>) {\n    this.id = address.toBase58();\n    this.whirlpoolData = parseWhirlpoolSafe(address, whirlpoolAccountInfo.data);\n\n    this.oracle = findProgramAddressSync([Buffer.from('oracle'), address.toBuffer()], WHIRLPOOL_PROGRAM_ID)[0];\n    this.feePct = new Decimal(this.whirlpoolData.feeRate).div(FEE_RATE_MUL_VALUE).toNumber();\n    this.tickPks = getTickArrayPks(address, this.whirlpoolData);\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    // The tickCurrentIndex is technically behind here, belonging to the last refresh\n    return [this.address, ...this.tickPks];\n  }\n\n  update(accountInfoMap: AccountInfoMap): void {\n    const whirlpoolAccountInfo = accountInfoMap.get(this.address.toBase58());\n    if (!whirlpoolAccountInfo) throw new Error(`Missing ${this.address.toBase58()}`);\n    this.whirlpoolData = parseWhirlpoolSafe(this.address, whirlpoolAccountInfo.data);\n    this.tickPks = getTickArrayPks(this.address, this.whirlpoolData);\n\n    this.tickArrays.clear();\n    for (const tickArrayPk of this.tickPks) {\n      const tickArrayAddress = tickArrayPk.toBase58();\n      const tickArrayAccountInfo = accountInfoMap.get(tickArrayAddress);\n      if (!tickArrayAccountInfo) {\n        // This can happen if we reach an uninitialized tick, and it is likely to occur right now\n        continue;\n      }\n      const tickArray = parseTickArray(tickArrayAccountInfo.data);\n      if (!tickArray) throw new Error(`Could not parse tick array ${tickArrayAddress}`);\n      this.tickArrays.set(tickArrayAddress, tickArray);\n    }\n  }\n\n  getQuote({ sourceMint, amount }: QuoteParams): Quote {\n    const swapQuote = getSwapQuote({\n      poolAddress: this.address,\n      whirlpool: this.whirlpoolData,\n      tickArrays: this.tickArrays,\n      tokenMint: sourceMint,\n      tokenAmount: new BN(amount.toString()),\n      isInput: true,\n      // slippageTolerance,\n    });\n\n    const inAmount = Number(swapQuote.amountIn.toString());\n    const feeAmount = Math.floor(this.feePct * inAmount);\n\n    const quotePrice = swapQuote.aToB\n      ? new Decimal(swapQuote.amountOut.toString()).div(swapQuote.amountIn.toString())\n      : new Decimal(swapQuote.amountIn.toString()).div(swapQuote.amountOut.toString());\n\n    const currentPrice = fromX64(this.whirlpoolData.sqrtPrice).pow(2);\n    const priceImpactPct = currentPrice.minus(quotePrice).div(currentPrice).abs().toNumber();\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount,\n      outAmount: Number(swapQuote.amountOut.toString()),\n      feeAmount,\n      feeMint: sourceMint.toBase58(),\n      feePct: this.feePct,\n      priceImpactPct: Number(priceImpactPct),\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams) {\n    const aToB = swapParams.sourceMint.equals(this.whirlpoolData.tokenMintA);\n\n    const [tickArray0, tickArray1, tickArray2] = getTickArrayPublicKeysForSwap(\n      this.whirlpoolData.tickCurrentIndex,\n      this.whirlpoolData.sqrtPrice,\n      this.whirlpoolData.tickSpacing,\n      this.address,\n      this.tickArrays,\n      WHIRLPOOL_PROGRAM_ID,\n      aToB,\n    );\n\n    return [\n      createWhirlpoolSwapInstruction({\n        additionalArgs: {\n          aToB,\n          whirlpool: this.address,\n          tickArray0,\n          tickArray1,\n          tickArray2,\n          oracle: this.oracle,\n          ...this.whirlpoolData,\n        },\n        ...swapParams,\n      }),\n    ];\n  }\n\n  get reserveTokenMints() {\n    return [this.whirlpoolData.tokenMintA, this.whirlpoolData.tokenMintB];\n  }\n}\n","// TODO: Move this to SDK rather than being maintained by us\nimport {\n  CyclosCore,\n  buildTick,\n  generateBitmapWord,\n  nextInitializedBit,\n  tickPosition,\n  TickDataProvider,\n  PoolVars,\n  TICK_SEED,\n  u32ToSeed,\n  BITMAP_SEED,\n  TickMath,\n  u16ToSeed,\n} from '@jup-ag/cykura-sdk';\nimport * as anchor from '@project-serum/anchor';\nimport { BN, IdlAccounts } from '@project-serum/anchor';\nimport { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { AccountInfo, PublicKey } from '@solana/web3.js';\nimport JSBI from 'jsbi';\n\nexport type TickBitmapState = IdlAccounts<CyclosCore>['tickBitmapState'];\nexport type TickState = IdlAccounts<CyclosCore>['tickState'];\n\nexport class SolanaTickDataProvider implements TickDataProvider {\n  program: anchor.Program<CyclosCore>;\n  pool: PoolVars;\n\n  bitmapCache: Map<\n    number,\n    {\n      address: PublicKey;\n      word: anchor.BN;\n    }\n  >;\n\n  tickCache: Map<\n    number,\n    {\n      address: PublicKey;\n      liquidityNet: JSBI;\n    }\n  >;\n\n  accountsToFetch: { bitmaps: PublicKey[]; ticks: PublicKey[] } = { bitmaps: [], ticks: [] };\n\n  constructor(program: anchor.Program<CyclosCore>, pool: PoolVars) {\n    this.program = program;\n    this.pool = pool;\n    this.bitmapCache = new Map();\n    this.tickCache = new Map();\n  }\n\n  /**\n   * Caches ticks and bitmap accounts near the current price\n   * @param tickCurrent The current pool tick\n   * @param tickSpacing The pool tick spacing\n   */\n  async eagerLoadCache(tickCurrent: number, tickSpacing: number) {\n    // fetch 10 bitmaps on each side in a single fetch. Find active ticks and read them together\n    const compressed = JSBI.toNumber(JSBI.divide(JSBI.BigInt(tickCurrent), JSBI.BigInt(tickSpacing)));\n    const { wordPos } = tickPosition(compressed);\n\n    try {\n      const bitmapsToFetch = [];\n      const { wordPos: WORD_POS_MIN } = tickPosition(Math.floor(TickMath.MIN_TICK / tickSpacing));\n      const { wordPos: WORD_POS_MAX } = tickPosition(Math.floor(TickMath.MAX_TICK / tickSpacing));\n      const minWord = Math.max(wordPos - 10, WORD_POS_MIN);\n      const maxWord = Math.min(wordPos + 10, WORD_POS_MAX);\n      for (let i = minWord; i < maxWord; i++) {\n        bitmapsToFetch.push(this.getBitmapAddressSync(i));\n      }\n\n      const fetchedBitmaps = (await this.program.account.tickBitmapState.fetchMultiple(\n        bitmapsToFetch,\n      )) as (TickBitmapState | null)[];\n\n      const tickAddresses = [];\n      for (let i = 0; i < maxWord - minWord; i++) {\n        const currentWordPos = i + minWord;\n        const wordArray = fetchedBitmaps[i]?.word;\n        const word = wordArray ? generateBitmapWord(wordArray) : new BN(0);\n        this.bitmapCache.set(currentWordPos, {\n          address: bitmapsToFetch[i],\n          word,\n        });\n        if (word && !word.eqn(0)) {\n          for (let j = 0; j < 256; j++) {\n            if (word.shrn(j).and(new BN(1)).eqn(1)) {\n              const tick = ((currentWordPos << 8) + j) * tickSpacing;\n              const tickAddress = this.getTickAddressSync(tick);\n              tickAddresses.push(tickAddress);\n            }\n          }\n        }\n      }\n\n      const fetchedTicks = (await this.program.account.tickState.fetchMultiple(tickAddresses)) as (TickState | null)[];\n      for (const i in tickAddresses) {\n        const fetchedTick = fetchedTicks[i];\n        if (!fetchedTick) continue;\n\n        const { tick, liquidityNet } = fetchedTick;\n        this.tickCache.set(tick, {\n          address: tickAddresses[i],\n          liquidityNet: JSBI.BigInt(liquidityNet),\n        });\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  /**\n   * Return accounts to cache and returns early if there is insufficient data\n   * @param tickCurrent The current pool tick\n   * @param tickSpacing The pool tick spacing\n   */\n  lazyLoadAccountsToCache(tickCurrent: number, tickSpacing: number): PublicKey[] {\n    // fetch 10 bitmaps on each side in a single fetch. Find active ticks and read them together\n    const compressed = JSBI.toNumber(JSBI.divide(JSBI.BigInt(tickCurrent), JSBI.BigInt(tickSpacing)));\n    const { wordPos } = tickPosition(compressed);\n\n    const bitmapsToFetch: PublicKey[] = [];\n    const bitmaps: ({ address: PublicKey; word: anchor.BN } | undefined)[] = [];\n    const { wordPos: WORD_POS_MIN } = tickPosition(Math.floor(TickMath.MIN_TICK / tickSpacing));\n    const { wordPos: WORD_POS_MAX } = tickPosition(Math.floor(TickMath.MAX_TICK / tickSpacing));\n    const minWord = Math.max(wordPos - 10, WORD_POS_MIN);\n    const maxWord = Math.min(wordPos + 10, WORD_POS_MAX);\n    for (let i = minWord; i < maxWord; i++) {\n      bitmapsToFetch.push(this.getBitmapAddressSync(i));\n      const bitmap = this.bitmapCache.get(i);\n      bitmaps.push(bitmap);\n    }\n\n    const tickAddressesToFetch = [];\n    for (let i = 0; i < maxWord - minWord; i++) {\n      const currentWordPos = i + minWord;\n      // We might not have the bitmap yet in the first iteration\n      const word = bitmaps[i]?.word ?? new BN(0);\n      this.bitmapCache.set(currentWordPos, {\n        address: bitmapsToFetch[i],\n        word,\n      });\n      if (word && !word.eqn(0)) {\n        for (let j = 0; j < 256; j++) {\n          if (word.shrn(j).and(new BN(1)).eqn(1)) {\n            const tick = ((currentWordPos << 8) + j) * tickSpacing;\n            const tickAddress = this.getTickAddressSync(tick);\n            tickAddressesToFetch.push(tickAddress);\n          }\n        }\n      }\n    }\n\n    this.accountsToFetch = { bitmaps: bitmapsToFetch, ticks: tickAddressesToFetch };\n    return [...bitmapsToFetch, ...tickAddressesToFetch];\n  }\n\n  getTick(tick: number): {\n    address: anchor.web3.PublicKey;\n    liquidityNet: JSBI;\n  } {\n    let savedTick = this.tickCache.get(tick);\n    if (!savedTick) {\n      throw new Error('Tick not cached');\n    }\n\n    return {\n      address: savedTick.address,\n      liquidityNet: savedTick.liquidityNet,\n    };\n  }\n\n  async getTickAddress(tick: number): Promise<anchor.web3.PublicKey> {\n    return this.getTickAddressSync(tick);\n  }\n\n  getTickAddressSync(tick: number): anchor.web3.PublicKey {\n    return findProgramAddressSync(\n      [TICK_SEED, this.pool.token0.toBuffer(), this.pool.token1.toBuffer(), u32ToSeed(this.pool.fee), u32ToSeed(tick)],\n      this.program.programId,\n    )[0];\n  }\n\n  async getBitmapAddress(wordPos: number): Promise<anchor.web3.PublicKey> {\n    return this.getBitmapAddressSync(wordPos);\n  }\n\n  getBitmapAddressSync(wordPos: number): anchor.web3.PublicKey {\n    return findProgramAddressSync(\n      [\n        BITMAP_SEED,\n        this.pool.token0.toBuffer(),\n        this.pool.token1.toBuffer(),\n        u32ToSeed(this.pool.fee),\n        u16ToSeed(wordPos),\n      ],\n      this.program.programId,\n    )[0];\n  }\n\n  /**\n   * Fetches the cached bitmap for the word\n   * @param wordPos\n   */\n  getBitmap(wordPos: number): {\n    address: anchor.web3.PublicKey;\n    word: anchor.BN;\n  } {\n    let savedBitmap = this.bitmapCache.get(wordPos);\n    if (!savedBitmap) {\n      throw new Error('Bitmap not cached');\n    }\n\n    return savedBitmap;\n  }\n\n  /**\n   * Finds the next initialized tick in the given word. Fetched bitmaps are saved in a\n   * cache for quicker lookups in future.\n   * @param tick The current tick\n   * @param lte Whether to look for a tick less than or equal to the current one, or a tick greater than or equal to\n   * @param tickSpacing The tick spacing for the pool\n   * @returns\n   */\n  nextInitializedTickWithinOneWord(\n    tick: number,\n    lte: boolean,\n    tickSpacing: number,\n  ): [number, boolean, number, number, PublicKey] {\n    let compressed = JSBI.toNumber(JSBI.divide(JSBI.BigInt(tick), JSBI.BigInt(tickSpacing)));\n    if (tick < 0 && tick % tickSpacing !== 0) {\n      compressed -= 1;\n    }\n    if (!lte) {\n      compressed += 1;\n    }\n\n    const { wordPos, bitPos } = tickPosition(compressed);\n    const cachedBitmap = this.getBitmap(wordPos);\n\n    const { next: nextBit, initialized } = nextInitializedBit(cachedBitmap.word, bitPos, lte);\n    const nextTick = buildTick(wordPos, nextBit, tickSpacing);\n    return [nextTick, initialized, wordPos, bitPos, cachedBitmap.address];\n  }\n\n  // Change this to be a blind decoder rather than decode what we know\n  updateCachedAccountInfos(accountInfoMap: Map<string, AccountInfo<Buffer> | null>) {\n    for (const bitmapAddress of this.accountsToFetch.bitmaps) {\n      const bitmapAccountInfo = accountInfoMap.get(bitmapAddress.toBase58());\n      if (bitmapAccountInfo) {\n        const tickBitmapState = this.program.coder.accounts.decode<TickBitmapState>(\n          'tickBitmapState',\n          bitmapAccountInfo.data,\n        );\n\n        this.bitmapCache.set(tickBitmapState.wordPos, {\n          address: bitmapAddress,\n          word: generateBitmapWord(tickBitmapState.word),\n        });\n      }\n    }\n\n    for (const tickAddress of this.accountsToFetch.ticks) {\n      const tickStateAccountInfo = accountInfoMap.get(tickAddress.toBase58());\n      if (tickStateAccountInfo) {\n        const tickState = this.program.coder.accounts.decode<TickState>('tickState', tickStateAccountInfo.data);\n        this.tickCache.set(tickState.tick, {\n          address: tickAddress,\n          liquidityNet: JSBI.BigInt(tickState.liquidityNet),\n        });\n      }\n    }\n  }\n}\n","import { AccountInfo, AccountMeta, Connection, PublicKey, TransactionInstruction } from '@solana/web3.js';\nimport JSBI from 'jsbi';\nimport * as anchor from '@project-serum/anchor';\nimport { AccountInfoMap, Amm, Quote, QuoteParams, SwapParams } from '../amm';\nimport { Pool as CykuraPool, CyclosCore, IDL, OBSERVATION_SEED, u32ToSeed, u16ToSeed } from '@jup-ag/cykura-sdk';\nimport { CurrencyAmount, Token } from '@jup-ag/cykura-sdk-core';\nimport { IdlAccounts, Wallet } from '@project-serum/anchor';\nimport { SolanaTickDataProvider } from './solanaTickDataProvider';\nimport { CYKURA_PROGRAM_ID } from '../../constants';\nimport { ASSOCIATED_TOKEN_PROGRAM_ID, TOKEN_PROGRAM_ID } from '@solana/spl-token';\nimport { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { createCykuraSwapInstruction } from '../jupiterInstruction';\nimport { toDecimal } from '@jup-ag/math';\n\nexport type PoolState = IdlAccounts<CyclosCore>['poolState'];\n\nconst FEE_DENOMINATOR = 1_000_000;\n\nconst provider = new anchor.Provider(null as unknown as Connection, null as unknown as Wallet, {\n  skipPreflight: false,\n});\nconst CYCLOS_CORE = new anchor.Program<CyclosCore>(IDL, CYKURA_PROGRAM_ID, provider);\n\nexport class CykuraAmm implements Amm {\n  label = 'Cykura' as const;\n  id: string;\n  shouldPrefetch = true;\n  private poolState: PoolState;\n  private pool: CykuraPool;\n  private tickDataProvider: SolanaTickDataProvider;\n  private tokens: { token0: Token; token1: Token };\n  public vaults: { vault0: PublicKey; vault1: PublicKey };\n  private swapAccountMetas: AccountMeta[] = [];\n  private feePct: number;\n\n  constructor(private address: PublicKey, accountInfoOrPoolState: AccountInfo<Buffer> | PoolState) {\n    this.id = address.toBase58();\n    let poolState: PoolState;\n    if ('data' in accountInfoOrPoolState) {\n      poolState = CYCLOS_CORE.coder.accounts.decode<PoolState>('poolState', accountInfoOrPoolState.data);\n    } else {\n      poolState = accountInfoOrPoolState;\n    }\n\n    this.poolState = poolState;\n\n    const { token0, token1, fee, sqrtPriceX32, liquidity, tick } = this.poolState;\n\n    this.tickDataProvider = new SolanaTickDataProvider(CYCLOS_CORE, {\n      token0,\n      token1,\n      fee,\n    });\n\n    this.tokens = {\n      token0: new Token(101, token0, 0, '', ''),\n      token1: new Token(101, token1, 0, '', ''),\n    };\n\n    this.pool = new CykuraPool(\n      this.tokens.token0,\n      this.tokens.token1,\n      fee,\n      JSBI.BigInt(sqrtPriceX32.toString()),\n      JSBI.BigInt(liquidity.toString()),\n      tick,\n      this.tickDataProvider,\n    );\n\n    this.vaults = {\n      vault0: findProgramAddressSync(\n        [this.address.toBuffer(), TOKEN_PROGRAM_ID.toBuffer(), token0.toBuffer()],\n        ASSOCIATED_TOKEN_PROGRAM_ID,\n      )[0],\n      vault1: findProgramAddressSync(\n        [this.address.toBuffer(), TOKEN_PROGRAM_ID.toBuffer(), token1.toBuffer()],\n        ASSOCIATED_TOKEN_PROGRAM_ID,\n      )[0],\n    };\n\n    this.feePct = this.poolState.fee / FEE_DENOMINATOR;\n  }\n\n  getAccountsForUpdate(): PublicKey[] {\n    return [\n      this.address,\n      ...this.tickDataProvider.lazyLoadAccountsToCache(this.pool.tickCurrent, this.pool.tickSpacing),\n    ];\n  }\n\n  update(accountInfoMap: AccountInfoMap) {\n    const poolAccountInfo = accountInfoMap.get(this.address.toBase58());\n    if (!poolAccountInfo) {\n      throw new Error(`Could not find poolAccountInfo ${this.address.toBase58()}`);\n    }\n    this.poolState = CYCLOS_CORE.coder.accounts.decode<PoolState>('poolState', poolAccountInfo.data);\n    const { fee, sqrtPriceX32, liquidity, tick } = this.poolState;\n    this.pool = new CykuraPool(\n      this.tokens.token0,\n      this.tokens.token1,\n      fee,\n      JSBI.BigInt(sqrtPriceX32.toString()),\n      JSBI.BigInt(liquidity.toString()),\n      tick,\n      this.tickDataProvider,\n    );\n\n    this.tickDataProvider.updateCachedAccountInfos(accountInfoMap);\n  }\n\n  getQuote({ sourceMint, amount }: QuoteParams): Quote {\n    const inputToken = sourceMint.equals(this.poolState.token0) ? this.tokens.token0 : this.tokens.token1;\n    const [currentOutAmount, newPool, swapAccountMetas] = this.pool.getOutputAmount(\n      CurrencyAmount.fromRawAmount(inputToken, JSBI.BigInt(amount)),\n    );\n    this.swapAccountMetas = swapAccountMetas;\n\n    const priceImpactDecimal = toDecimal(JSBI.subtract(this.pool.sqrtRatioX32, newPool.sqrtRatioX32)).div(\n      this.pool.sqrtRatioX32.toString(),\n    );\n\n    return {\n      notEnoughLiquidity: false,\n      inAmount: amount,\n      outAmount: JSBI.toNumber(currentOutAmount.quotient),\n      // Might not be spot on but avoids many conversions\n      feeAmount: Math.floor((amount * this.poolState.fee) / FEE_DENOMINATOR),\n      feeMint: sourceMint.toBase58(),\n      feePct: this.feePct,\n      priceImpactPct: priceImpactDecimal.toNumber(),\n    };\n  }\n\n  createSwapInstructions(swapParams: SwapParams): TransactionInstruction[] {\n    const [inputVault, outputVault] = swapParams.sourceMint.equals(this.poolState.token0)\n      ? [this.vaults.vault0, this.vaults.vault1]\n      : [this.vaults.vault1, this.vaults.vault0];\n\n    const lastObservationState = findProgramAddressSync(\n      [\n        OBSERVATION_SEED,\n        this.poolState.token0.toBuffer(),\n        this.poolState.token1.toBuffer(),\n        u32ToSeed(this.poolState.fee),\n        u16ToSeed(this.poolState.observationIndex),\n      ],\n      CYKURA_PROGRAM_ID,\n    )[0];\n\n    const nextObservationState = findProgramAddressSync(\n      [\n        OBSERVATION_SEED,\n        this.poolState.token0.toBuffer(),\n        this.poolState.token1.toBuffer(),\n        u32ToSeed(this.poolState.fee),\n        u16ToSeed((this.poolState.observationIndex + 1) % this.poolState.observationCardinalityNext),\n      ],\n      CYKURA_PROGRAM_ID,\n    )[0];\n\n    const additionalArgs = {\n      poolAddress: this.address,\n      inputVault,\n      outputVault,\n      nextObservationState,\n      lastObservationState,\n      swapAccountMetas: this.swapAccountMetas,\n    };\n    return [createCykuraSwapInstruction({ ...swapParams, additionalArgs })];\n  }\n\n  get reserveTokenMints() {\n    return [this.poolState.token0, this.poolState.token1];\n  }\n}\n","import { AccountInfo, Connection, PublicKey } from '@solana/web3.js';\nimport { isValidRoute, MarketInfo } from './market';\nimport { WRAPPED_SOL_MINT } from '../constants';\nimport { RaydiumAmm } from './raydium/raydiumAmm';\nimport fetch from 'cross-fetch';\nimport { TokenRouteSegments } from './types';\nimport { Amm, prefetchAmms } from './amm';\nimport { SerumAmm } from './serum/serumAmm';\nimport { ammFactory } from './ammFactory';\nimport { getSaberWrappedDecimalsAmms, SaberAddDecimalsAmm } from './saber/saberAddDecimalsAmm';\nimport { SplitTradeAmm } from './split-trade/splitTradeAmm';\nimport { getTwoPermutations } from '../utils/getTwoPermutations';\nimport { chunkedGetMultipleAccountInfos } from '../utils/chunkedGetMultipleAccountInfos';\n\nexport interface TransactionFeeInfo {\n  signatureFee: number;\n  openOrdersDeposits: number[];\n  ataDeposits: number[];\n  /* Overall amount that will be deducted from user wallet after the swap */\n  totalFeeAndDeposits: number;\n  /* Amount for fee, deposits and temporary token accounts */\n  minimumSOLForTransaction: number;\n}\n\nexport interface RouteInfo {\n  marketInfos: MarketInfo[];\n  inAmount: number;\n  outAmount: number;\n  outAmountWithSlippage: number;\n  priceImpactPct: number;\n  getDepositAndFee: () => Promise<TransactionFeeInfo | undefined>;\n}\n\ntype MarketsCache = Array<\n  Omit<AccountInfo<Buffer>, 'data' | 'owner'> & {\n    data: [string, 'base64'];\n    owner: string;\n    pubkey: string;\n  }\n>;\n\ntype KeyedAccountInfo = AccountInfo<Buffer> & {\n  pubkey: PublicKey;\n  // api can pass some extra params\n  params?: any;\n};\n\nexport const fetchMarketCache = async (url: string) => {\n  const marketsCache = (await (await fetch(url)).json()) as MarketsCache;\n  return marketsCache;\n};\n\n/** For testing purposes when api does not have the new pools */\nexport async function fetchExtraKeyedAccountInfos(connection: Connection, pks: PublicKey[]) {\n  const extraKeyedAccountInfos = (\n    await chunkedGetMultipleAccountInfos(\n      connection,\n      pks.map((item) => item.toBase58()),\n    )\n  ).map((item, index) => {\n    const pubkey = pks[index];\n    if (!item) throw new Error(`Failed to fetch pool ${pubkey.toBase58()}`);\n    return { pubkey, ...item };\n  });\n  return extraKeyedAccountInfos;\n}\n\nexport async function getAllAmms(connection: Connection, marketsCache: MarketsCache): Promise<Amm[]> {\n  const marketCacheToAccountInfo = (marketsCache: MarketsCache): Array<KeyedAccountInfo> => {\n    return marketsCache.map((market) => {\n      const {\n        data: [accountInfo, format],\n        pubkey,\n        ...rest\n      } = market;\n      return {\n        ...rest,\n        pubkey: new PublicKey(pubkey),\n        data: Buffer.from(accountInfo, format),\n        owner: new PublicKey(rest.owner),\n      };\n    });\n  };\n\n  const marketKeyedAccountInfos = marketCacheToAccountInfo(marketsCache);\n\n  // this is used for development\n  const extraKeys: Array<PublicKey> = [];\n\n  if (extraKeys.length) {\n    const extraKeyedAccountInfos = await fetchExtraKeyedAccountInfos(connection, extraKeys);\n    marketKeyedAccountInfos.push(...extraKeyedAccountInfos);\n  }\n\n  const amms = marketKeyedAccountInfos.reduce((acc, keyedAccountInfo) => {\n    const amm = ammFactory(keyedAccountInfo.pubkey, keyedAccountInfo, keyedAccountInfo.params);\n    // Amm might not be recognized by the current version of the frontend\n    // or be in a state we don't want\n    if (amm) {\n      acc.push(amm);\n    }\n    return acc;\n  }, new Array<Amm>());\n\n  await prefetchAmms(\n    amms.filter((amm) => amm.shouldPrefetch),\n    connection,\n  );\n\n  amms.push(...getSaberWrappedDecimalsAmms());\n\n  return amms;\n}\n\nexport function ammCrossProtocolPairs(arr: Amm[], callback: (a: Amm, b: Amm) => void) {\n  for (let i = 0; i < arr.length; i++) {\n    for (let j = i + 1; j < arr.length; j++) {\n      // Don't pair amm with same label\n      if (arr[i].label !== arr[j].label) {\n        callback(arr[i], arr[j]);\n      }\n    }\n  }\n}\n\nexport function getTokenRouteSegments(amms: Amm[]): TokenRouteSegments {\n  const tokenRouteSegments = new Map<string, Map<string, Amm[]>>();\n\n  amms.forEach((amm) => {\n    const reserveTokenMintPermutations = getTwoPermutations(amm.reserveTokenMints);\n    reserveTokenMintPermutations.forEach(([firstReserveMint, secondReserveMint]) => {\n      addSegment(firstReserveMint.toBase58(), secondReserveMint.toBase58(), amm, tokenRouteSegments);\n    });\n  });\n\n  return tokenRouteSegments;\n}\n\nfunction addSegment(inMint: string, outMint: string, amm: Amm, tokenRouteSegments: TokenRouteSegments) {\n  let segments = tokenRouteSegments.get(inMint);\n\n  if (!segments) {\n    segments = new Map<string, Amm[]>([[outMint, []]]);\n    tokenRouteSegments.set(inMint, segments);\n  }\n\n  let amms = segments.get(outMint);\n  if (!amms) {\n    amms = [];\n    segments.set(outMint, amms);\n  }\n\n  amms.push(amm);\n}\n\nexport type Route = {\n  amms: Amm[];\n  mints: PublicKey[];\n};\n\n/*\n * Construct TokenRouteSegment that is only used for the selected inputMint and outputMint\n * Example:\n *   SOL => USDC, the map would consist of\n *     - SOL => USDC => Amm[]\n *     - SOL => USDT => Amm[]\n *     - USDT => SOL => Amm[]\n */\nexport function computeInputRouteSegments({\n  inputMint,\n  outputMint,\n  tokenRouteSegments,\n  intermediateTokens,\n}: {\n  inputMint: string;\n  outputMint: string;\n  tokenRouteSegments: TokenRouteSegments;\n  intermediateTokens?: string[];\n}): TokenRouteSegments {\n  const inputRouteSegments: TokenRouteSegments = new Map();\n\n  const inputSegment = tokenRouteSegments.get(inputMint);\n  const outputSegment = tokenRouteSegments.get(outputMint);\n\n  if (inputSegment && outputSegment) {\n    const inputInnerMap = new Map<string, Amm[]>();\n    const outputInnerMap = new Map<string, Amm[]>();\n\n    for (let [outMint, amms] of inputSegment.entries()) {\n      if (outMint === outputMint) {\n        inputInnerMap.set(outMint, amms);\n        outputInnerMap.set(inputMint, amms);\n        continue;\n      }\n\n      if (intermediateTokens && !intermediateTokens.includes(outMint)) {\n        continue;\n      }\n      const intersectionAmms = outputSegment.get(outMint);\n      if (intersectionAmms) {\n        inputRouteSegments.set(\n          outMint,\n          new Map([\n            [inputMint, amms],\n            [outputMint, intersectionAmms],\n          ]),\n        );\n        inputInnerMap.set(outMint, amms);\n        outputInnerMap.set(outMint, intersectionAmms);\n      }\n    }\n    inputRouteSegments.set(inputMint, inputInnerMap);\n    inputRouteSegments.set(outputMint, outputInnerMap);\n  }\n\n  return inputRouteSegments;\n}\n\nexport function computeRouteMap(\n  tokenRouteSegments: TokenRouteSegments,\n  intermediateTokens?: string[],\n  onlyDirectRoutes?: boolean,\n): Map<string, string[]> {\n  const routeMap = new Map<string, string[]>();\n\n  for (const [tokenMint, firstLevelOutputs] of tokenRouteSegments) {\n    const validOutputMints = new Set<string>();\n\n    for (const [firstLevelOutputMint, firstLevelAmms] of firstLevelOutputs) {\n      validOutputMints.add(firstLevelOutputMint);\n\n      if (onlyDirectRoutes) {\n        continue;\n      }\n      // add the single level output as possible valid mints as well\n      const secondLevelOutputs = tokenRouteSegments.get(firstLevelOutputMint) ?? [];\n      for (const [secondLevelOutputMint, secondLevelAmms] of secondLevelOutputs) {\n        // Prevent output mint == input mint when routing\n        if (secondLevelOutputMint === tokenMint) {\n          continue;\n        }\n\n        // if intermediateTokens is specified and it doesnt include in the intermediateTokens, skip it\n        if (intermediateTokens && !intermediateTokens.includes(firstLevelOutputMint)) {\n          continue;\n        }\n\n        for (const firstLevelAmm of firstLevelAmms) {\n          for (const secondLevelAmm of secondLevelAmms) {\n            if (isValidRoute(firstLevelAmm, secondLevelAmm)) {\n              validOutputMints.add(secondLevelOutputMint);\n              break;\n            }\n          }\n        }\n      }\n    }\n    routeMap.set(tokenMint, Array.from(validOutputMints));\n  }\n\n  return routeMap;\n}\n\ninterface SplitTradeRequiredParams {\n  hasSerumOpenOrderInstruction: boolean;\n}\n\nexport function isSplitSetupRequired(\n  marketInfos: MarketInfo[],\n  { hasSerumOpenOrderInstruction }: SplitTradeRequiredParams,\n): { needSetup: boolean; needCleanup: boolean } {\n  let firstAmm: Amm;\n  let secondAmm: Amm;\n\n  if (marketInfos.length === 1) {\n    const amm = marketInfos[0].amm;\n    if (amm instanceof SplitTradeAmm) {\n      firstAmm = amm.firstAmm;\n      secondAmm = amm.secondAmm;\n    } else {\n      return { needSetup: false, needCleanup: false };\n    }\n  } else {\n    [firstAmm, secondAmm] = marketInfos.map((marketInfo) => marketInfo.amm);\n  }\n\n  if (firstAmm instanceof RaydiumAmm || secondAmm instanceof RaydiumAmm) {\n    return { needSetup: true, needCleanup: true };\n  } else if (firstAmm instanceof SerumAmm && secondAmm instanceof SerumAmm) {\n    return { needSetup: true, needCleanup: true };\n  } else if (hasSerumOpenOrderInstruction) {\n    return { needSetup: true, needCleanup: false };\n  }\n\n  return { needSetup: false, needCleanup: false };\n}\n\n// We cannot add platform fee to all possible routing due to transaction size limit\nexport function isPlatformFeeSupported(amms: Amm[]): boolean {\n  if (amms.length > 1) {\n    const [firstMarket, secondMarket] = amms;\n\n    if (firstMarket instanceof RaydiumAmm && secondMarket instanceof RaydiumAmm) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function getRouteInfoUniqueId(routeInfo: RouteInfo) {\n  return routeInfo.marketInfos.map((marketInfo) => `${marketInfo.amm.id}-${marketInfo.inputMint}`).join('-');\n}\n","import { deserializeAccount } from '@mercurial-finance/optimist';\nimport { ASSOCIATED_TOKEN_PROGRAM_ID, Token, TOKEN_PROGRAM_ID } from '@solana/spl-token';\nimport { Connection, PublicKey, SystemProgram, TransactionInstruction } from '@solana/web3.js';\nimport { WRAPPED_SOL_MINT } from '../constants';\nimport { getEmptyInstruction, Instruction } from './instruction';\nimport { Owner } from './Owner';\n\n// Leverage the existing ATA when present\nexport async function createAndCloseWSOLAccount({\n  connection,\n  amount,\n  owner: { publicKey },\n}: {\n  connection: Connection;\n  owner: Owner;\n  amount: number;\n}): Promise<Instruction & { address: PublicKey }> {\n  const result = getEmptyInstruction();\n  result.instructions = [];\n\n  const toAccount = await Token.getAssociatedTokenAddress(\n    ASSOCIATED_TOKEN_PROGRAM_ID,\n    TOKEN_PROGRAM_ID,\n    WRAPPED_SOL_MINT,\n    publicKey,\n    true,\n  );\n\n  const info = await connection.getAccountInfo(toAccount);\n\n  if (info === null) {\n    result.instructions.push(\n      createAssociatedTokenAccountInstruction(publicKey, toAccount, publicKey, WRAPPED_SOL_MINT),\n    );\n  }\n\n  // Fund account and sync\n  result.instructions.push(\n    SystemProgram.transfer({\n      fromPubkey: publicKey,\n      toPubkey: toAccount,\n      lamports: amount,\n    }),\n  );\n  result.instructions.push(\n    // This is not exposed by the types, but indeed it exists\n    (Token as any).createSyncNativeInstruction(TOKEN_PROGRAM_ID, toAccount),\n  );\n\n  result.cleanupInstructions = [\n    Token.createCloseAccountInstruction(TOKEN_PROGRAM_ID, toAccount, publicKey, publicKey, []),\n  ];\n\n  return {\n    address: toAccount,\n    ...result,\n  };\n}\n\nexport async function findOrCreateAssociatedAccountByMint({\n  connection,\n  payer,\n  owner: { publicKey },\n  mintAddress,\n  unwrapSOL,\n}: {\n  connection: Connection;\n  payer: PublicKey;\n  owner: Owner;\n  mintAddress: PublicKey | string;\n  unwrapSOL: boolean;\n}): Promise<Instruction & { address: PublicKey }> {\n  const mint = typeof mintAddress === 'string' ? new PublicKey(mintAddress) : mintAddress;\n  const toAccount = await Token.getAssociatedTokenAddress(\n    ASSOCIATED_TOKEN_PROGRAM_ID,\n    TOKEN_PROGRAM_ID,\n    mint,\n    publicKey,\n    true,\n  );\n  const cleanupInstructions: TransactionInstruction[] = [];\n  const instructions: TransactionInstruction[] = [];\n\n  const info = await connection.getAccountInfo(toAccount);\n\n  if (info === null) {\n    instructions.push(createAssociatedTokenAccountInstruction(payer, toAccount, publicKey, mint));\n  } else {\n    const tokenAccountInfo = deserializeAccount(info.data);\n\n    if (tokenAccountInfo && !tokenAccountInfo.owner.equals(publicKey)) {\n      // What to do at the top level in UIs and SDK?\n      throw new Error(`/!\\ ATA ${toAccount.toBase58()} is not owned by ${publicKey.toBase58()}`);\n    }\n  }\n\n  // We close it when wrapped SOL\n  if (mint.equals(WRAPPED_SOL_MINT) && unwrapSOL) {\n    cleanupInstructions.push(\n      Token.createCloseAccountInstruction(TOKEN_PROGRAM_ID, toAccount, publicKey, publicKey, []),\n    );\n  }\n\n  return {\n    address: toAccount,\n    instructions: instructions,\n    cleanupInstructions,\n    signers: [],\n  };\n}\n\n// 0.1.x @solana/spl-token does not have the version without the rent sysvar\n// Source: https://github.com/solana-labs/solana-program-library/blob/dc5684445f0b42ba36a0157f06c561d967a7cb34/associated-token-account/program/src/instruction.rs#L16-L25\nexport function createAssociatedTokenAccountInstruction(\n  payer: PublicKey,\n  associatedToken: PublicKey,\n  owner: PublicKey,\n  mint: PublicKey,\n  programId = TOKEN_PROGRAM_ID,\n  associatedTokenProgramId = ASSOCIATED_TOKEN_PROGRAM_ID,\n): TransactionInstruction {\n  const keys = [\n    { pubkey: payer, isSigner: true, isWritable: true },\n    { pubkey: associatedToken, isSigner: false, isWritable: true },\n    { pubkey: owner, isSigner: false, isWritable: false },\n    { pubkey: mint, isSigner: false, isWritable: false },\n    { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },\n    { pubkey: programId, isSigner: false, isWritable: false },\n  ];\n\n  return new TransactionInstruction({\n    keys,\n    programId: associatedTokenProgramId,\n    data: Buffer.alloc(0),\n  });\n}\n","import { Signer, Transaction, TransactionInstruction, TransactionSignature } from '@solana/web3.js';\n\nexport const getEmptyInstruction: () => Instruction = () => ({\n  instructions: [],\n  cleanupInstructions: [],\n  signers: [],\n});\n\nexport type Instruction = {\n  instructions: TransactionInstruction[];\n  cleanupInstructions: TransactionInstruction[];\n  signers: Signer[];\n};\n\nexport type TransactionPayload = {\n  transaction: Transaction;\n  signers: Signer[];\n  execute: () => Promise<TransactionSignature>;\n};\n","import { Connection, Keypair, PublicKey, TransactionInstruction } from '@solana/web3.js';\nimport { isPlatformFeeSupported, RouteInfo } from './routes';\nimport { getEmptyInstruction, Instruction } from '../utils/instruction';\nimport { findOrCreateAssociatedAccountByMint } from '../utils/token';\nimport { createSetTokenLedgerInstruction } from './jupiterInstruction';\nimport { Owner } from '../utils/Owner';\nimport { PlatformFee } from './types';\nimport { QuoteMintToReferrer } from '..';\nimport { isSerumAndRaydium } from './market';\n\ntype RouteToInstructionsParams = {\n  user: Owner;\n  tokenLedger: PublicKey;\n  openOrdersAddresses: (PublicKey | undefined)[];\n  userSourceTokenAccountAddress: PublicKey;\n  userIntermediaryTokenAccountAddress: PublicKey | undefined;\n  userDestinationTokenAccountAddress: PublicKey;\n  routeInfo: RouteInfo;\n  platformFee: PlatformFee | undefined;\n  quoteMintToReferrer: QuoteMintToReferrer;\n};\n\nasync function routeToInstructions({\n  user,\n  tokenLedger,\n  openOrdersAddresses,\n  userSourceTokenAccountAddress,\n  userIntermediaryTokenAccountAddress,\n  userDestinationTokenAccountAddress,\n  routeInfo,\n  platformFee,\n  quoteMintToReferrer,\n}: RouteToInstructionsParams): Promise<Instruction> {\n  const outAmountWithSlippage = routeInfo.outAmountWithSlippage;\n  const inputAmount = routeInfo.inAmount;\n\n  const legs = routeInfo.marketInfos.length;\n  if (legs === 2 && !userIntermediaryTokenAccountAddress) {\n    throw new Error('Missing intermediary token account');\n  }\n\n  // Drop referrer if space is scarce\n  const effectiveQuoteMintToReferrer =\n    platformFee && isSerumAndRaydium(routeInfo.marketInfos) ? undefined : quoteMintToReferrer;\n\n  const userIntermediateTokenAccountAddresses = userIntermediaryTokenAccountAddress\n    ? [userIntermediaryTokenAccountAddress]\n    : [];\n  const userTokenAccountAddresses = [\n    userSourceTokenAccountAddress,\n    ...userIntermediateTokenAccountAddresses,\n    userDestinationTokenAccountAddress,\n  ];\n\n  const platformFeeSupported = isPlatformFeeSupported(routeInfo.marketInfos.map((mi) => mi.amm));\n\n  const instructions: TransactionInstruction[] = [\n    createSetTokenLedgerInstruction(tokenLedger, userTokenAccountAddresses[1]),\n  ];\n\n  for (const [index, marketInfo] of routeInfo.marketInfos.entries()) {\n    const amm = marketInfo.amm;\n    const legInputAmount = index === 0 ? inputAmount : null;\n    const legOutAmountWithSlippage = index === legs - 1 ? outAmountWithSlippage : 0;\n    const legPlatformFee = index === legs - 1 && platformFeeSupported ? platformFee : undefined;\n\n    const [userSourceTokenAccount, userDestinationTokenAccount] = userTokenAccountAddresses.slice(index);\n\n    instructions.push(\n      ...amm.createSwapInstructions({\n        sourceMint: marketInfo.inputMint,\n        destinationMint: marketInfo.outputMint,\n        userSourceTokenAccount,\n        userDestinationTokenAccount,\n        userTransferAuthority: user.publicKey,\n        inAmount: legInputAmount,\n        minimumOutAmount: legOutAmountWithSlippage,\n        tokenLedger,\n        openOrdersAddress: openOrdersAddresses[index],\n        platformFee: legPlatformFee,\n        quoteMintToReferrer: effectiveQuoteMintToReferrer,\n      }),\n    );\n  }\n\n  const { signers, cleanupInstructions } = getEmptyInstruction();\n\n  if (user.isKeyPair && user.signer) {\n    signers.push(user.signer);\n  }\n  return {\n    signers,\n    cleanupInstructions,\n    instructions,\n  };\n}\n\nexport const routeAtaInstructions = async ({\n  connection,\n  marketInfos,\n  owner,\n  unwrapSOL,\n}: {\n  connection: Connection;\n  marketInfos: RouteInfo['marketInfos'];\n  owner: Owner;\n  unwrapSOL: boolean;\n}) => {\n  const getUserIntermediateTokenAccountAddress = async () => {\n    const userIntermediateTokenAccountAddress =\n      marketInfos.length === 2\n        ? await findOrCreateAssociatedAccountByMint({\n            connection,\n            owner: owner,\n            payer: owner.publicKey,\n            mintAddress: marketInfos[0].outputMint,\n            unwrapSOL,\n          })\n        : undefined;\n    return userIntermediateTokenAccountAddress;\n  };\n\n  const getUserDestinationTokenAccountAddress = () => {\n    return findOrCreateAssociatedAccountByMint({\n      connection,\n      owner: owner,\n      payer: owner.publicKey,\n      mintAddress: marketInfos.length === 2 ? marketInfos[1].outputMint : marketInfos[0].outputMint,\n      unwrapSOL,\n    });\n  };\n\n  const [userIntermediaryTokenAccountResult, userDestinationTokenAccountResult] = await Promise.all([\n    getUserIntermediateTokenAccountAddress(),\n    getUserDestinationTokenAccountAddress(),\n  ]);\n\n  return {\n    userIntermediaryTokenAccountResult,\n    userDestinationTokenAccountResult,\n  };\n};\n\nexport default routeToInstructions;\n","import { Connection, PublicKey } from '@solana/web3.js';\nimport { SerumMarket } from '../market';\nimport { getEmptyInstruction, Instruction } from '../../utils/instruction';\nimport { wait } from '../../utils/wait';\nimport { createOpenOrdersInstruction } from '../jupiterInstruction';\n\nexport type MarketToOpenOrdersAddress = Map<string, PublicKey>;\n\nexport async function getOrCreateOpenOrdersAddress(\n  connection: Connection,\n  user: PublicKey,\n  serumMarket: SerumMarket,\n  marketToOpenOrdersAddress?: MarketToOpenOrdersAddress,\n): Promise<(Instruction & { address: PublicKey }) | undefined> {\n  const result = getEmptyInstruction();\n\n  const marketAddress = serumMarket.address.toString();\n\n  if (marketToOpenOrdersAddress) {\n    // check existing map\n    let openOrdersAddress = marketToOpenOrdersAddress.get(marketAddress);\n\n    if (openOrdersAddress) {\n      let openOrdersAccountInfo = null;\n\n      // We verify if it indeed exists, with low commitment to pick it up, to address the unsafe behaviour below\n      openOrdersAccountInfo = await connection.getAccountInfo(openOrdersAddress, 'confirmed');\n\n      if (openOrdersAccountInfo) {\n        return {\n          ...result,\n          address: openOrdersAddress,\n        };\n      }\n    }\n  }\n\n  const [newOpenOrdersAddress, ix] = createOpenOrdersInstruction(serumMarket, user);\n\n  const newOpenOrdersAddressInfo = await connection.getAccountInfo(newOpenOrdersAddress);\n\n  if (!newOpenOrdersAddressInfo) {\n    result.instructions = [ix];\n  }\n\n  // This is unsafe, since we don't know yet if it has succeeded\n  marketToOpenOrdersAddress?.set(serumMarket.address.toString(), newOpenOrdersAddress);\n\n  return {\n    ...result,\n    address: newOpenOrdersAddress,\n  };\n}\n","import { TOKEN_PROGRAM_ID } from '@solana/spl-token';\nimport { Connection, FeeCalculator, PublicKey } from '@solana/web3.js';\nimport type { SerumOpenOrdersMap } from '..';\nimport { WRAPPED_SOL_MINT } from '../constants';\nimport { deserializeAccount } from '@mercurial-finance/optimist';\nimport { RouteInfo, TransactionFeeInfo } from './routes';\nimport { routeAtaInstructions } from './routeToInstructions';\nimport { getOrCreateOpenOrdersAddress } from './serum/openOrders';\nimport { SerumAmm } from './serum/serumAmm';\nimport { SplitTradeAmm } from './split-trade/splitTradeAmm';\nimport { PlatformFeeAndAccounts, SetupInstructions } from './types';\nimport { Owner } from '../utils/Owner';\n\nconst SERUM_OPEN_ACCOUNT_LAMPORTS = 23_352_760;\nconst OPEN_TOKEN_ACCOUNT_LAMPORTS = 2_039_280;\n\nfunction sum(values: number[]) {\n  return values.reduce((value, acc) => {\n    acc += value;\n    return acc;\n  }, 0);\n}\n\nconst calculateTransactionDepositAndFee = ({\n  intermediate,\n  destination,\n  openOrders,\n  hasWrapUnwrapSOL,\n  feeCalculator,\n}: SetupInstructions & {\n  hasWrapUnwrapSOL: boolean;\n  feeCalculator: FeeCalculator;\n}): TransactionFeeInfo => {\n  const openOrdersDeposits = openOrders\n    .filter((ooi) => ooi && ooi.instructions.length > 0)\n    .map(() => SERUM_OPEN_ACCOUNT_LAMPORTS);\n  const ataDeposits = [intermediate, destination]\n    .filter((item) => item?.instructions.length && item.cleanupInstructions.length === 0)\n    .map(() => OPEN_TOKEN_ACCOUNT_LAMPORTS);\n\n  const signatureFee =\n    ([...openOrders?.map((oo) => oo?.signers), intermediate?.signers, destination.signers].filter(Boolean).flat()\n      .length +\n      1) *\n    feeCalculator.lamportsPerSignature;\n\n  const totalFeeAndDeposits = sum([signatureFee, ...openOrdersDeposits, ...ataDeposits]);\n\n  // We need to account for temporary wrapped SOL token accounts as intermediary or output\n  const minimumSOLForTransaction = sum([\n    signatureFee,\n    ...openOrdersDeposits,\n    ...[intermediate, destination]\n      .filter((item) => (item?.instructions.length ?? 0) > 0)\n      .map(() => OPEN_TOKEN_ACCOUNT_LAMPORTS),\n    hasWrapUnwrapSOL ? OPEN_TOKEN_ACCOUNT_LAMPORTS : 0,\n  ]);\n\n  return {\n    signatureFee,\n    openOrdersDeposits,\n    ataDeposits,\n    totalFeeAndDeposits,\n    minimumSOLForTransaction,\n  };\n};\n\nexport const getDepositAndFeeFromInstructions = async ({\n  connection,\n  owner,\n  inputMint,\n  marketInfos,\n  feeCalculator,\n  serumOpenOrdersPromise,\n  wrapUnwrapSOL: unwrapSOL,\n}: {\n  connection: Connection;\n  owner: Owner;\n  inputMint: PublicKey;\n  marketInfos: RouteInfo['marketInfos'];\n  feeCalculator: FeeCalculator;\n  /* promise because we can choose not to await it when we dont need it */\n  serumOpenOrdersPromise: Promise<SerumOpenOrdersMap>;\n  wrapUnwrapSOL: boolean;\n}) => {\n  const hasWrapUnwrapSOL = inputMint.equals(WRAPPED_SOL_MINT) && unwrapSOL;\n\n  const openOrdersInstructionsPromise = Promise.all(\n    marketInfos.map(async (marketInfo) => {\n      const amm = marketInfo.amm;\n      if (amm instanceof SerumAmm || amm instanceof SplitTradeAmm) {\n        if (!amm.market) return;\n        return await getOrCreateOpenOrdersAddress(\n          connection,\n          owner.publicKey,\n          amm.market,\n          await serumOpenOrdersPromise,\n        );\n      }\n      return;\n    }),\n  );\n\n  const promise = routeAtaInstructions({ connection, marketInfos, owner, unwrapSOL }).then(\n    ({ userIntermediaryTokenAccountResult, userDestinationTokenAccountResult }) => {\n      return openOrdersInstructionsPromise.then((openOrdersInstructions) => ({\n        intermediate: userIntermediaryTokenAccountResult,\n        destination: userDestinationTokenAccountResult,\n        openOrders: openOrdersInstructions,\n      }));\n    },\n  );\n\n  const instructionResult = await promise;\n\n  return calculateTransactionDepositAndFee({\n    ...instructionResult,\n    hasWrapUnwrapSOL,\n    feeCalculator,\n  });\n};\n\nexport const NO_PLATFORM_FEE: PlatformFeeAndAccounts = {\n  feeBps: 0,\n  feeAccounts: new Map<string, PublicKey>(),\n};\n\nexport async function getPlatformFeeAccounts(\n  connection: Connection,\n  feeAccountOwner: PublicKey,\n): Promise<Map<string, PublicKey>> {\n  const tokenAccounts = (\n    await connection.getTokenAccountsByOwner(feeAccountOwner, {\n      programId: TOKEN_PROGRAM_ID,\n    })\n  ).value;\n\n  const feeAccounts = tokenAccounts.reduce((acc, tokenAccount) => {\n    const deserializedtokenAccount = deserializeAccount(tokenAccount.account.data);\n    if (deserializedtokenAccount) {\n      acc.set(deserializedtokenAccount.mint.toBase58(), tokenAccount.pubkey);\n    }\n    return acc;\n  }, new Map<string, PublicKey>());\n\n  return feeAccounts;\n}\n","import {\n  Connection,\n  PublicKey,\n  Transaction,\n  TransactionCtorFields_DEPRECATED,\n  Signer,\n  TransactionInstruction,\n} from '@solana/web3.js';\nimport { Instruction, TransactionPayload } from './instruction';\nimport { Owner } from './Owner';\n\nexport class TransactionBuilder {\n  private connection: Connection;\n  private feePayer: PublicKey;\n  private instructions: Instruction[];\n  private owner: Owner;\n\n  constructor(connection: Connection, feePayer: PublicKey, owner: Owner) {\n    this.connection = connection;\n    this.feePayer = feePayer;\n    this.instructions = [];\n    this.owner = owner;\n  }\n\n  addInstruction(instruction: Instruction): TransactionBuilder {\n    this.instructions.push(instruction);\n    return this;\n  }\n\n  async build(recentBlockHash?: string): Promise<TransactionPayload> {\n    if (!recentBlockHash) {\n      recentBlockHash = (await this.connection.getLatestBlockhash('confirmed')).blockhash;\n    }\n\n    const txFields: TransactionCtorFields_DEPRECATED = {\n      recentBlockhash: recentBlockHash,\n      feePayer: this.feePayer,\n    };\n\n    let instructions: TransactionInstruction[] = [];\n    let cleanupInstructions: TransactionInstruction[] = [];\n    let signers: Signer[] = [];\n    this.instructions.forEach((curr) => {\n      instructions = instructions.concat(curr.instructions);\n      cleanupInstructions = cleanupInstructions.concat(curr.cleanupInstructions);\n      signers = signers.concat(curr.signers);\n    });\n\n    const transaction = new Transaction(txFields);\n    instructions.concat(cleanupInstructions).forEach((ix) => transaction.add(ix));\n    transaction.feePayer = this.feePayer;\n\n    return {\n      transaction: transaction,\n      signers: signers,\n      execute: this.owner.isKeyPair\n        ? () => {\n            return this.connection.sendTransaction(transaction, signers);\n          }\n        : async () => {\n            throw new Error('Please use a Keypair for the owner parameter to enable the execute function');\n          },\n    };\n  }\n}\n","import { Keypair, PublicKey, Signer } from '@solana/web3.js';\n\ntype _Owner = Keypair | PublicKey;\n\nexport class Owner {\n  private readonly _owner: _Owner;\n\n  constructor(owner: _Owner) {\n    this._owner = owner;\n  }\n\n  get publicKey(): PublicKey {\n    if (Owner.isKeyPair(this._owner)) {\n      return this._owner.publicKey;\n    }\n\n    return this._owner;\n  }\n\n  get signer(): Signer | undefined {\n    return Owner.isKeyPair(this._owner) ? this._owner : undefined;\n  }\n\n  get isKeyPair(): boolean {\n    return Owner.isKeyPair(this._owner);\n  }\n\n  get isPublicKey(): boolean {\n    return Owner.isPublicKey(this._owner);\n  }\n\n  static isKeyPair(owner: _Owner): owner is Keypair {\n    return (owner as Keypair).secretKey !== undefined;\n  }\n\n  static isPublicKey(owner: _Owner): owner is PublicKey {\n    return !Owner.isKeyPair(owner);\n  }\n}\n","export const wait = (time: number) => new Promise<void>((resolve) => setTimeout(resolve, time));\n","import { TransactionError } from '@mercurial-finance/optimist';\nimport { bs58 } from '@project-serum/anchor/dist/cjs/utils/bytes';\nimport {\n  ConfirmedTransactionMeta,\n  Connection,\n  PublicKey,\n  SendOptions,\n  Transaction,\n  TransactionResponse,\n  TransactionSignature,\n} from '@solana/web3.js';\nimport Decimal from 'decimal.js';\nimport promiseRetry from 'promise-retry';\nimport { WRAPPED_SOL_MINT, JUPITER_ERRORS } from '../constants';\nimport { wait } from './wait';\n\ntype ResponseMeta = NonNullable<TransactionResponse['meta']>;\ntype ReponseTransaction = TransactionResponse['transaction'];\n\nfunction diffTokenBalance(accountKeyIndex: number, meta: ConfirmedTransactionMeta): number | undefined {\n  const postBalance = meta.postTokenBalances?.find(\n    (postTokenBalance) => postTokenBalance.accountIndex === accountKeyIndex,\n  )?.uiTokenAmount.amount;\n  const preBalance = meta.preTokenBalances?.find((preTokenBalance) => preTokenBalance.accountIndex === accountKeyIndex)\n    ?.uiTokenAmount.amount;\n\n  // When token account is created it isn't present in preBalance\n  if (!postBalance) return;\n  return Math.abs(parseInt(postBalance) - (preBalance !== undefined ? parseInt(preBalance) : 0));\n}\n\nexport function extractTokenBalanceChangeFromTransaction(\n  meta: ResponseMeta,\n  transaction: ReponseTransaction,\n  tokenAccountAddress: PublicKey,\n): number | undefined {\n  const message = transaction.message;\n\n  if (!meta) {\n    return;\n  }\n  const index = message.accountKeys.findIndex((p) => p.equals(tokenAccountAddress));\n\n  return diffTokenBalance(index, meta);\n}\n\nexport function extractSOLChangeFromTransaction(\n  meta: ResponseMeta,\n  transaction: ReponseTransaction,\n  user: PublicKey,\n): number {\n  let accountKeyIndex = transaction.message.accountKeys.findIndex((p) => p.equals(user));\n\n  if (accountKeyIndex !== -1) {\n    return Math.abs(meta.postBalances[accountKeyIndex] - meta.preBalances[accountKeyIndex]);\n  }\n\n  // if 0 is returned it will throw error in the caller function\n  return 0;\n}\n\nexport function getWritableKeys(transaction: Transaction) {\n  return [\n    ...new Set(\n      transaction.instructions\n        .map((inst) => inst.keys.filter((key) => key.isWritable).map((k) => k.pubkey))\n        .reduce((acc, el) => acc.concat(el)),\n    ).values(),\n  ];\n}\n\nexport function getTokenBalanceChangesFromTransactionResponse({\n  txid,\n  inputMint,\n  outputMint,\n  user,\n  sourceAddress,\n  destinationAddress,\n  transactionResponse,\n  hasWrappedSOL,\n}: {\n  txid: TransactionSignature;\n  inputMint: PublicKey;\n  outputMint: PublicKey;\n  user: PublicKey;\n  sourceAddress: PublicKey;\n  destinationAddress: PublicKey;\n  transactionResponse: TransactionResponse | null;\n  hasWrappedSOL: boolean;\n}) {\n  let sourceTokenBalanceChange: number | undefined;\n  let destinationTokenBalanceChange: number | undefined;\n\n  if (transactionResponse) {\n    let { meta, transaction } = transactionResponse;\n    if (meta) {\n      sourceTokenBalanceChange =\n        inputMint.equals(WRAPPED_SOL_MINT) && !hasWrappedSOL\n          ? extractSOLChangeFromTransaction(meta, transaction, user)\n          : extractTokenBalanceChangeFromTransaction(meta, transaction, sourceAddress);\n      destinationTokenBalanceChange =\n        outputMint.equals(WRAPPED_SOL_MINT) && !hasWrappedSOL\n          ? extractSOLChangeFromTransaction(meta, transaction, user)\n          : extractTokenBalanceChangeFromTransaction(meta, transaction, destinationAddress);\n    }\n  }\n\n  if (!(sourceTokenBalanceChange && destinationTokenBalanceChange)) {\n    throw new TransactionError(\n      'Cannot find source or destination token account balance change',\n      txid,\n      JUPITER_ERRORS['BalancesNotExtractedProperly'].code,\n    );\n  }\n\n  return [sourceTokenBalanceChange, destinationTokenBalanceChange];\n}\n\nexport async function pollForConfirmedTransaction(\n  connection: Connection,\n  txid: TransactionSignature,\n): Promise<TransactionResponse | null> {\n  return promiseRetry(\n    async (retry) => {\n      const response = await connection.getTransaction(txid, {\n        commitment: 'confirmed',\n      });\n      if (!response) {\n        retry(\n          new TransactionError('Transaction was not confirmed', txid, JUPITER_ERRORS['TransactionNotConfirmed'].code),\n        );\n      }\n      return response;\n    },\n    {\n      retries: 30,\n      minTimeout: 500,\n    },\n  ).catch(() => null);\n}\n\nexport function getUnixTs() {\n  return new Date().getTime();\n}\n\nconst SEND_OPTIONS: SendOptions = { skipPreflight: true, maxRetries: 2 };\n\n/**\n * awaits confirmation while resending the transaction periodically\n *\n * Our RPC node settings\n * solana_send_leader_count: 8\n * solana_send_retry_ms: 15000\n **/\nexport async function transactionSenderAndConfirmationWaiter(\n  connection: Connection,\n  signedTransaction: Transaction,\n  timeout = 120_000, // 2 minutes, (sendInterval * sendRetries) = 80_000 + extra wait 40_000\n  pollInterval = 500,\n  sendInterval = 2_000,\n  sendRetries = 40,\n): Promise<{ txid: TransactionSignature; transactionResponse: TransactionResponse | null }> {\n  const rawTransaction = signedTransaction.serialize();\n  const txid = await connection.sendRawTransaction(rawTransaction, SEND_OPTIONS);\n\n  const start = getUnixTs();\n  let lastSendTimestamp = getUnixTs();\n  let retries = 0;\n\n  while (getUnixTs() - start < timeout) {\n    const timestamp = getUnixTs();\n    if (retries < sendRetries && timestamp - lastSendTimestamp > sendInterval) {\n      lastSendTimestamp = timestamp;\n      retries += 1;\n      await connection.sendRawTransaction(rawTransaction, SEND_OPTIONS);\n    }\n    const response = await Promise.any([\n      connection.getTransaction(txid, {\n        commitment: 'confirmed',\n      }),\n      wait(5000),\n    ]);\n    if (response) return { txid, transactionResponse: response };\n    await wait(pollInterval);\n  }\n  return { txid, transactionResponse: null };\n}\n\nexport function getSignature(transaction: Transaction) {\n  const signature = transaction.signature;\n  if (!signature) {\n    throw new Error('Transaction has no signature');\n  }\n  return bs58.encode(signature);\n}\n","// The package is missing cjs. Apache License 2.0\n// https://github.com/ehmicky/fast-cartesian/blob/619a497dffd978fb4a09a83f2ca047915579774f/src/main.js\n\n// Validate 'array()' input\nconst validateInput = function <T>(arrays: T[][]) {\n  if (!Array.isArray(arrays)) {\n    throw new TypeError('Argument must be an array of arrays');\n  }\n\n  arrays.forEach(validateArray);\n  validateDimensions(arrays);\n  validateCombinations(arrays);\n};\n\nconst validateArray = function <T>(array: T[]) {\n  if (!Array.isArray(array)) {\n    throw new TypeError(`Argument must be an array: ${array}`);\n  }\n};\n\n// Maximum number of nested `for` loops. In my machine, it's 604 but it is\n// engine-specific so we use a safe number. Above the limit, a max call stack\n// error is thrown by the engine.\nconst validateDimensions = function <T>({ length }: T[]) {\n  if (length >= MAX_DIMENSIONS) {\n    throw new TypeError(\n      `Too many arrays (${length}): please use the 'big-cartesian' library instead of 'fast-cartesian'`,\n    );\n  }\n};\n\nconst MAX_DIMENSIONS = 1e2;\n\n// Max array size in JavaScript. This is the limit of the final return value.\nconst validateCombinations = function <T>(arrays: T[][]) {\n  const size = arrays.reduce(multiplySize, 1);\n\n  if (size >= MAX_SIZE) {\n    const sizeStr = Number.isFinite(size) ? ` (${size.toExponential(0)})` : '';\n    throw new TypeError(\n      `Too many combinations${sizeStr}: please use the 'big-cartesian' library instead of 'fast-cartesian'`,\n    );\n  }\n};\n\nconst multiplySize = function <T>(size: number, array: T[]) {\n  return size * array.length;\n};\n\nconst MAX_SIZE = 4294967296; // 2 ** 32 = 4,294,967,296\n\n// Does a cartesian product on several arrays.\n// Returns an array with the results.\n// Optimized to be the fastest implementation in JavaScript.\nexport default function fastCartesian<T>(arrays: T[][]): T[][] {\n  validateInput(arrays);\n\n  if (arrays.length === 0) {\n    return [];\n  }\n\n  const loopFunc = getLoopFunc(arrays.length);\n  const result: T[][] = [];\n  loopFunc(arrays, result);\n  return result;\n}\n\nconst getLoopFunc = function (length: number) {\n  const cachedLoopFunc = cache[length];\n\n  if (cachedLoopFunc !== undefined) {\n    return cachedLoopFunc;\n  }\n\n  const loopFunc = mGetLoopFunc(length);\n  // eslint-disable-next-line fp/no-mutation\n  cache[length] = loopFunc;\n  return loopFunc;\n};\n\nconst cache: Record<number, any> = {};\n\n// Create a function with `new Function()` that does:\n//   function(arrays, results) {\n//     for (const value0 of arrays[0]) {\n//       for (const value1 of arrays[1]) {\n//         // and so on\n//         results.push([value0, value1])\n//       }\n//     }\n//   }\nconst mGetLoopFunc = function (length: number) {\n  const indexes = Array.from({ length }, getIndex);\n  const start = indexes.map((index) => `for (const value${index} of arrays[${index}]) {`).join('\\n');\n  const middle = indexes.map((index) => `value${index}`).join(', ');\n  const end = '}\\n'.repeat(length);\n\n  // eslint-disable-next-line no-new-func\n  return new Function('arrays', 'result', `${start}\\nresult.push([${middle}])\\n${end}`);\n};\n\nconst getIndex = function (value: any, index: number) {\n  return String(index);\n};\n","import { Connection, PublicKey } from '@solana/web3.js';\nimport { chunkedGetMultipleAccountInfos } from '../utils/chunkedGetMultipleAccountInfos';\nimport { Amm, Quote } from './amm';\nimport { SplitTradeAmm } from './split-trade/splitTradeAmm';\nimport { isValidRoute, MarketInfo } from './market';\nimport { ammCrossProtocolPairs, isPlatformFeeSupported, Route, RouteInfo, TransactionFeeInfo } from './routes';\nimport { TokenRouteSegments } from './types';\nimport { IS_DEV } from '../constants';\nimport fastCartesian from '../utils/cartesian';\n\nconst PLATFORM_FEE_DENOMINATOR = 10000;\n\nexport async function fetchAccountInfos(connection: Connection, routes: TokenRouteSegments): Promise<void> {\n  const accountInfosMap = new Map();\n\n  const accountsToFetchSet = new Set<string>();\n  const ammMap = new Map<string, Amm>();\n  routes.forEach((innerMap) => {\n    innerMap.forEach((amms) => {\n      amms.forEach((amm) => {\n        ammMap.set(amm.id, amm);\n        amm.getAccountsForUpdate().forEach((account) => {\n          // Only add accountInfos that is not in the Map\n          accountsToFetchSet.add(account.toBase58());\n        });\n      });\n    });\n  });\n\n  const accountsToFetch = Array.from(accountsToFetchSet);\n\n  if (accountsToFetch.length > 0) {\n    const accountInfos = await chunkedGetMultipleAccountInfos(connection, accountsToFetch);\n\n    accountInfos.forEach((item, index) => {\n      const publicKey = accountsToFetch[index];\n      if (item) {\n        accountInfosMap.set(publicKey, item);\n      }\n    });\n\n    ammMap.forEach((amm) => {\n      amm.update(accountInfosMap);\n    });\n  }\n}\n\ninterface GetQuotesParams {\n  inputRouteSegment: TokenRouteSegments;\n  amount: number;\n  inputMint: PublicKey;\n  outputMint: PublicKey;\n  platformFeeBps: number;\n  slippage: number;\n  filterTopNResult?: number;\n  onlyDirectRoutes?: boolean;\n  getDepositAndFeeForRoute: (params: {\n    marketInfos: RouteInfo['marketInfos'];\n  }) => Promise<TransactionFeeInfo | undefined>;\n}\n\nfunction getInputOutputId({ inputMint, outputMint }: { inputMint: string; outputMint: string }) {\n  return `${inputMint}-${outputMint}`;\n}\n\nfunction getQuoteId({ ammId, amount }: { ammId: string; amount: number }) {\n  return `${ammId}-${amount}`;\n}\n\ntype QuoteMap = Map<string, Quote>;\n\nfunction getQuoteMap({\n  amms,\n  inputMint,\n  outputMint,\n  amount,\n  filterTopNResult = 3,\n}: {\n  amms: Amm[];\n  inputMint: string;\n  outputMint: string;\n  amount: number;\n  filterTopNResult?: number;\n}): QuoteMap {\n  const quotes = amms\n    .map((amm) => {\n      try {\n        const quote = amm.getQuote({\n          amount,\n          sourceMint: new PublicKey(inputMint),\n          destinationMint: new PublicKey(outputMint),\n        });\n        return { quote, id: amm.id };\n      } catch (e) {\n        if (IS_DEV) {\n          console.error(e);\n        }\n        return undefined;\n      }\n    })\n    .sort((a, b) => (b?.quote.outAmount || 0) - (a?.quote.outAmount || 0))\n    // only choose top 3 rates\n    .filter((item, idx) => item && item.quote.inAmount && idx < filterTopNResult) as Array<{\n    id: string;\n    quote: Quote;\n  }>;\n\n  return new Map<string, Quote>(quotes.map((item) => [getQuoteId({ ammId: item.id, amount }), item.quote]));\n}\n\n// Change this to support N-1 level of hops\nconst MAX_LEVEL = 2;\n\nexport function processInputRouteSegmentToRoutesInfos({\n  inputRouteSegment,\n  inputMint,\n  outputMint,\n  amount,\n  getDepositAndFeeForRoute,\n  platformFeeBps,\n  slippage,\n  filterTopNResult,\n  onlyDirectRoutes,\n}: GetQuotesParams) {\n  const inputMintString = inputMint.toBase58();\n  const outputMintString = outputMint.toBase58();\n  // (InputMint-OutputMint) map to (AmmId-InputAmount) map to Quote from the amm with the inputAmount\n  // this is used to prevent calculation being repeated later on.\n  const tradeIdQuoteMap = new Map<string, Map<string, Quote>>();\n  const inputMintInnerMap = inputRouteSegment.get(inputMintString);\n\n  const routes: Route[] = [];\n\n  if (!inputMintInnerMap) {\n    throw new Error('No routes found for the input and output mints');\n  }\n\n  const maxLevel = onlyDirectRoutes ? 0 : MAX_LEVEL;\n\n  /*\n   * It get the rate of all single pair that is linked to the inputMint\n   * Example: SOL => USDC, will have direct pair, while\n   *          SOL => USDT, USDT => SOL will have a hop\n   *\n   * So we go through each of the hop and get the top 3 rate and drop others\n   * This will eventually reduce the needs to compute bad rate for the same pair\n   *\n   * The loop below is doing for the inputMint, while the one after is doing for the outputMint.\n   */\n  const walkTheTree = ({\n    inputMint,\n    level = 0,\n    walked = [inputMint],\n  }: {\n    inputMint: string;\n    amount: number;\n    level?: number;\n    walked?: string[];\n  }) => {\n    const inputMintInnerMap = inputRouteSegment.get(inputMint);\n\n    if (inputMintInnerMap) {\n      inputMintInnerMap.forEach((amms, outMint) => {\n        const tradeId = getInputOutputId({\n          inputMint,\n          outputMint: outMint,\n        });\n\n        const quoteMap = getQuoteMap({\n          amms,\n          inputMint,\n          outputMint: outMint,\n          amount,\n          filterTopNResult,\n        });\n\n        const filteredAmms = amms.filter((amm) => quoteMap.has(getQuoteId({ ammId: amm.id, amount })));\n\n        // add split trade in when outputMint match and it's not direct only routes\n        if (outMint === outputMintString && !onlyDirectRoutes) {\n          ammCrossProtocolPairs(filteredAmms.slice(), (firstAmm, secondAmm) => {\n            const splitTradeAmm = SplitTradeAmm.create(firstAmm, secondAmm);\n            if (splitTradeAmm) {\n              filteredAmms.push(splitTradeAmm);\n            }\n          });\n        }\n\n        inputMintInnerMap.set(outMint, filteredAmms);\n        tradeIdQuoteMap.set(tradeId, quoteMap);\n\n        // keep looping if not walked and not reached max level\n        if (outMint !== outputMintString && quoteMap.size && !walked.includes(outMint) && level < maxLevel - 1) {\n          walkTheTree({\n            inputMint: outMint,\n            amount: quoteMap.values().next().value.outAmount,\n            level: level + 1,\n            walked: walked.concat(outMint),\n          });\n        } else if (outMint === outputMintString) {\n          // if output reached, we add the route\n\n          const mints = walked.concat(outMint);\n          const _mints = mints.map((i) => new PublicKey(i));\n          const ammsArr = mints.reduce((amms, _, index) => {\n            if (index < mints.length - 1) {\n              amms.push(inputRouteSegment.get(mints[index])?.get(mints[index + 1])!);\n            }\n            return amms;\n          }, [] as Amm[][]);\n\n          const permutations: Amm[][] = fastCartesian(ammsArr);\n\n          permutations.forEach((item) => {\n            if (item.length === 1 || isValidRoute(item[0], item[1])) {\n              routes.push({\n                amms: item,\n                mints: _mints,\n              });\n            }\n          });\n        }\n      });\n    }\n  };\n\n  walkTheTree({\n    inputMint: inputMintString,\n    amount: amount,\n  });\n\n  const routesInfo: RouteInfo[] = routes\n    .map((route) => {\n      const { amms, mints } = route;\n\n      // Chain all amms\n      let marketInfos: MarketInfo[] = [];\n      let intermediateAmount = amount;\n      let outAmountWithSlippage = amount;\n      const platformFeeSupported = isPlatformFeeSupported(amms);\n      const tokenMints: PublicKey[] = mints;\n\n      const legs = amms.length;\n      for (const [i, amm] of amms.entries()) {\n        try {\n          const sourceMint = tokenMints[i];\n          const destinationMint = tokenMints[i + 1];\n\n          const tradeId = getInputOutputId({\n            inputMint: sourceMint.toBase58(),\n            outputMint: destinationMint.toBase58(),\n          });\n\n          const cacheQuote = tradeIdQuoteMap\n            .get(tradeId)\n            ?.get(getQuoteId({ ammId: amm.id, amount: intermediateAmount }));\n\n          const quote =\n            cacheQuote ||\n            amm.getQuote({\n              sourceMint,\n              destinationMint,\n              amount: intermediateAmount,\n            });\n\n          // Platform fee applicable only on last leg\n          const platformFee =\n            legs - 1 === i && platformFeeSupported\n              ? {\n                  amount: Math.floor((quote.outAmount * platformFeeBps) / PLATFORM_FEE_DENOMINATOR),\n                  mint: destinationMint.toBase58(),\n                  pct: platformFeeBps / 100,\n                }\n              : { amount: 0, mint: destinationMint.toBase58(), pct: 0 };\n\n          const outAmountAfterFees = Math.max(0, quote.outAmount - platformFee.amount);\n\n          const legOutAmountWithSlippage = Math.round(outAmountAfterFees * (1 - slippage / 100));\n\n          marketInfos.push({\n            amm,\n            inputMint: sourceMint,\n            outputMint: destinationMint,\n            notEnoughLiquidity: quote.notEnoughLiquidity,\n            minInAmount: quote.minInAmount,\n            minOutAmount: quote.minOutAmount,\n            inAmount: quote.inAmount,\n            outAmount: outAmountAfterFees,\n            priceImpactPct: quote.priceImpactPct,\n            lpFee: {\n              amount: quote.feeAmount,\n              mint: quote.feeMint,\n              pct: quote.feePct,\n            },\n            platformFee,\n          });\n\n          intermediateAmount = outAmountAfterFees;\n          outAmountWithSlippage = legOutAmountWithSlippage;\n        } catch (e: any) {\n          if (IS_DEV) {\n            console.error(e);\n          }\n\n          return undefined;\n        }\n      }\n\n      return {\n        marketInfos,\n        getDepositAndFee: () => getDepositAndFeeForRoute({ marketInfos }),\n        inAmount: marketInfos[0].inAmount,\n        outAmount: intermediateAmount,\n        outAmountWithSlippage: outAmountWithSlippage,\n        priceImpactPct:\n          1 -\n          marketInfos.reduce((priceFactor, marketInfo) => {\n            priceFactor *= 1 - marketInfo.priceImpactPct;\n            return priceFactor;\n          }, 1),\n      };\n    })\n    .filter((item): item is RouteInfo => item !== undefined)\n    .sort((a, b) => b.outAmount - a.outAmount); // sort based on which one have better output\n\n  return routesInfo;\n}\n","import { parseErrorForTransaction, TransactionError } from '@mercurial-finance/optimist';\nimport { TransactionResponse, TransactionSignature } from '@solana/web3.js';\n\n// Throws when not found or contains error to satisfy upper control flow\nexport async function validateTransactionResponse({\n  txid,\n  transactionResponse,\n}: {\n  txid: string;\n  transactionResponse: TransactionResponse | null;\n}): Promise<{ txid: TransactionSignature; transactionResponse: TransactionResponse | null }> {\n  if (!transactionResponse) {\n    throw new TransactionError('Transaction was not confirmed', txid);\n  }\n  if (transactionResponse?.meta?.err) {\n    let { message, code } = await parseErrorForTransaction(transactionResponse);\n\n    switch (code) {\n      case 6000: {\n        message = 'Slippage error';\n      }\n    }\n\n    throw new TransactionError(message || '', txid, code);\n  }\n  return { txid, transactionResponse };\n}\n","import { ASSOCIATED_TOKEN_PROGRAM_ID, Token, TOKEN_PROGRAM_ID } from '@solana/spl-token';\nimport {\n  Cluster,\n  Connection,\n  FeeCalculator,\n  Keypair,\n  PublicKey,\n  Transaction,\n  TransactionSignature,\n} from '@solana/web3.js';\n\nimport { OpenOrders } from '@project-serum/serum';\nimport {\n  computeInputRouteSegments,\n  computeRouteMap,\n  fetchMarketCache,\n  getAllAmms,\n  getTokenRouteSegments,\n  isSplitSetupRequired,\n  RouteInfo,\n} from './routes';\nimport { MarketInfo } from './market';\nimport {\n  DEVNET_SERUM_DEX_PROGRAM,\n  JUPITER_WALLET,\n  MAINNET_SERUM_DEX_PROGRAM,\n  WRAPPED_SOL_MINT,\n  MARKETS_URL,\n  SWAP_PROTOCOL_TOKENS,\n} from '../constants';\nimport { getDepositAndFeeFromInstructions, NO_PLATFORM_FEE } from './fee';\nimport routeToInstructions, { routeAtaInstructions } from './routeToInstructions';\nimport { getOrCreateOpenOrdersAddress } from './serum/openOrders';\nimport { createAndCloseWSOLAccount } from '../utils/token';\nimport { getEmptyInstruction, Instruction } from '../utils/instruction';\nimport { TransactionBuilder } from '../utils/TransactionBuilder';\nimport { Owner } from '../utils/Owner';\nimport {\n  getSignature,\n  getTokenBalanceChangesFromTransactionResponse,\n  transactionSenderAndConfirmationWaiter,\n} from '../utils/transactionHelpers';\nimport { createInitializeTokenLedgerInstruction, TOKEN_LEDGER } from './jupiterInstruction';\nimport { fetchAccountInfos, processInputRouteSegmentToRoutesInfos } from './computeRouteInfos';\nimport type { SignerWalletAdapter } from '@solana/wallet-adapter-base';\nimport { TokenRouteSegments, PlatformFeeAndAccounts, QuoteMintToReferrer } from './types';\nimport { SerumAmm } from './serum/serumAmm';\nimport { SaberAmm } from './saber/saberAmm';\nimport { SplTokenSwapAmm } from './spl-token-swap/splTokenSwapAmm';\nimport { MercurialAmm } from './mercurial/mercurialAmm';\nimport { AldrinAmm } from './aldrin/aldrinAmm';\nimport { RaydiumAmm } from './raydium/raydiumAmm';\nimport { CropperAmm } from './cropper/cropperAmm';\nimport { SenchaAmm } from './sencha/senchaAmm';\nimport { SplitTradeAmm } from './split-trade/splitTradeAmm';\nimport { TokenMintAddress, SetupInstructions } from './types';\nimport { getPlatformFeeAccounts } from './fee';\nimport { Amm } from './amm';\nimport { validateTransactionResponse } from '../utils/tx/errors';\nimport { TransactionError } from '@mercurial-finance/optimist';\nimport { getSaberWrappedDecimalsAmms, SaberAddDecimalsAmm } from './saber/saberAddDecimalsAmm';\nimport { getTopTokens } from './getTopTokens';\nimport { WhirlpoolAmm } from './whirlpool/whirlpoolAmm';\nimport { CykuraAmm } from './cykura/cykuraAmm';\n\nexport type SerumOpenOrdersMap = Map<string, PublicKey>;\nexport { MarketInfo } from './market';\nexport { getPlatformFeeAccounts } from './fee';\nexport * from './types';\nexport { transactionSenderAndConfirmationWaiter } from '../utils/transactionHelpers';\nexport { RouteInfo, TransactionFeeInfo, getRouteInfoUniqueId } from './routes';\nexport { getSaberWrappedDecimalsAmms };\nexport {\n  AldrinAmm,\n  CykuraAmm,\n  RaydiumAmm,\n  SerumAmm,\n  SaberAmm,\n  SplTokenSwapAmm,\n  MercurialAmm,\n  CropperAmm,\n  SenchaAmm,\n  SaberAddDecimalsAmm,\n  SplitTradeAmm,\n  WhirlpoolAmm,\n};\n\nexport type SwapResult =\n  | {\n      txid: string;\n      inputAddress: PublicKey;\n      outputAddress: PublicKey;\n      inputAmount: number | undefined;\n      outputAmount: number | undefined;\n    }\n  | {\n      error?: TransactionError;\n    };\n\ntype InputMintAndOutputMint = string;\n\ntype JupiterLoadParams = {\n  connection: Connection;\n  cluster: Cluster;\n  user?: PublicKey | Keypair;\n  platformFeeAndAccounts?: PlatformFeeAndAccounts;\n  quoteMintToReferrer?: Map<TokenMintAddress, PublicKey>;\n  /**\n   * If === -1, mean it will not fetch when shouldFetch == false\n   * If === 0, mean it will fetch everytime\n   */\n  routeCacheDuration?: number;\n  wrapUnwrapSOL?: boolean;\n  marketUrl?: string;\n  /**\n   * On multi-leg trades, the intermediate tokens is restricted to X top tokens in volume and certain utility tokens (Saber wrapped decimal tokens)\n   * This is to reduce the load by having to compute trades through routes that are not so liquid\n   */\n  restrictIntermediateTokens?: boolean;\n  /** See {@link Jupiter.tokenLedger}, default to the standard Jupiter token ledger */\n  tokenLedger?: PublicKey;\n  /** See {@link Jupiter.shouldLoadSerumOpenOrders}, default to true */\n  shouldLoadSerumOpenOrders?: boolean;\n};\n\nexport type OnTransaction = (\n  txid: TransactionSignature,\n  totalTxs: number,\n  txDescription: IConfirmationTxDescription,\n) => void;\n\nexport type IConfirmationTxDescription = 'SETUP' | 'SWAP' | 'CLEANUP';\ntype ExecuteParams = {\n  wallet?: Pick<SignerWalletAdapter, 'sendTransaction' | 'signAllTransactions' | 'signTransaction'>;\n  /**\n   * Allows to customize control of sending and awaiting confirmation in the single/multi transaction flow\n   */\n  onTransaction?: OnTransaction;\n};\n\nexport class Jupiter {\n  /* promise because we can choose not to await it when we dont need it */\n  private serumOpenOrdersPromise: Promise<SerumOpenOrdersMap> | undefined = undefined;\n  private user: Keypair | PublicKey | undefined;\n  private routeCache = new Map<InputMintAndOutputMint, { fetchTimestamp: number }>();\n\n  constructor(\n    private connection: Connection,\n    private cluster: Cluster,\n    public tokenRouteSegments: TokenRouteSegments,\n    private feeCalculator: FeeCalculator,\n    private platformFeeAndAccounts: PlatformFeeAndAccounts,\n    /** Referrer account to collect Serum referrer fees for each given quote mint, the referrer fee is 20% of the Serum protocol fee */\n    private quoteMintToReferrer: QuoteMintToReferrer,\n    /** route cache duration in ms */\n    private routeCacheDuration: number = 0,\n    /** When set to true (default) native SOL is wrapped and wSOL unwrapped in each swap, otherwise it assumes wSOL is funded when it exists */\n    private wrapUnwrapSOL: boolean = true,\n    /** A token ledger which can be used to track volume as it can be made unique per platform, also alleviates write locks on a single token ledger account */\n    private tokenLedger: PublicKey,\n    private intermediateTokens: TokenMintAddress[] | undefined,\n    /** Perform a getProgramAccounts on user's serum open orders. Recomended to turn off if RPC is slow to perform a gPA */\n    private shouldLoadSerumOpenOrders: boolean,\n  ) {}\n\n  /**\n   * load performs the necessary async scaffolding of the Jupiter object\n   */\n  static async load({\n    connection,\n    cluster,\n    user,\n    platformFeeAndAccounts = NO_PLATFORM_FEE,\n    quoteMintToReferrer,\n    routeCacheDuration = 0,\n    wrapUnwrapSOL = true,\n    // @internal,\n    marketUrl,\n    restrictIntermediateTokens = false,\n    tokenLedger = TOKEN_LEDGER,\n    shouldLoadSerumOpenOrders = true,\n  }: JupiterLoadParams) {\n    const [\n      tokenRouteSegments,\n      {\n        value: { feeCalculator },\n      },\n      _quoteMintToReferrer,\n      intermediateTokens,\n    ] = await Promise.all([\n      Jupiter.fetchTokenRouteSegments(connection, cluster, marketUrl),\n      connection.getRecentBlockhashAndContext('processed'),\n      quoteMintToReferrer ?? getPlatformFeeAccounts(connection, new PublicKey(JUPITER_WALLET)),\n      restrictIntermediateTokens ? Jupiter.getIntermediateTokens() : undefined,\n    ]);\n\n    const jupiter = new Jupiter(\n      connection,\n      cluster,\n      tokenRouteSegments,\n      feeCalculator,\n      platformFeeAndAccounts,\n      _quoteMintToReferrer,\n      routeCacheDuration,\n      wrapUnwrapSOL,\n      tokenLedger,\n      intermediateTokens,\n      shouldLoadSerumOpenOrders,\n    );\n    if (user) jupiter.setUserPublicKey(user);\n    return jupiter;\n  }\n\n  getAccountToAmmMap() {\n    const accountToAmmMap = new Map<string, Amm>();\n    this.tokenRouteSegments.forEach((tokenRouteSegment) => {\n      Array.from(tokenRouteSegment.values()).forEach((marketInfos) => {\n        marketInfos.forEach((amm) => {\n          amm.getAccountsForUpdate().forEach((account) => {\n            accountToAmmMap.set(account.toBase58(), amm);\n          });\n        });\n      });\n    });\n    return accountToAmmMap;\n  }\n\n  public getDepositAndFees = async ({\n    marketInfos,\n    userPublicKey,\n    /**\n     * We can use Jupiter.findSerumOpenOrdersForOwner for this, if we want to reuse existing user serum open orders.\n     */\n    serumOpenOrdersPromise = Promise.resolve(new Map()),\n  }: {\n    marketInfos: MarketInfo[];\n    userPublicKey: PublicKey;\n    serumOpenOrdersPromise?: Promise<SerumOpenOrdersMap>;\n  }) => {\n    return getDepositAndFeeFromInstructions({\n      connection: this.connection,\n      feeCalculator: this.feeCalculator,\n      inputMint: marketInfos[0].inputMint,\n      marketInfos,\n      serumOpenOrdersPromise,\n      owner: new Owner(userPublicKey),\n      wrapUnwrapSOL: this.wrapUnwrapSOL,\n    });\n  };\n\n  private getDepositAndFeesForUser = ({ marketInfos }: { marketInfos: MarketInfo[] }) => {\n    if (this.user && this.serumOpenOrdersPromise) {\n      const user = new Owner(this.user);\n\n      return this.getDepositAndFees({\n        marketInfos,\n        userPublicKey: user.publicKey,\n        serumOpenOrdersPromise: this.serumOpenOrdersPromise,\n      });\n    }\n    return Promise.resolve(undefined);\n  };\n\n  async computeRoutes({\n    inputMint,\n    outputMint,\n    inputAmount,\n    slippage,\n    feeBps = 0,\n    forceFetch,\n    onlyDirectRoutes,\n    filterTopNResult,\n  }: {\n    inputMint: PublicKey;\n    outputMint: PublicKey;\n    inputAmount: number;\n    slippage: number;\n    feeBps?: number;\n    forceFetch?: boolean;\n    onlyDirectRoutes?: boolean;\n    /**\n     * filter how many top individual route to be used to compared\n     */\n    filterTopNResult?: number;\n  }) {\n    const inputMintString = inputMint.toBase58();\n    const outputMintString = outputMint.toBase58();\n\n    // Platform fee can only be applied when fee account exists\n    const platformFeeBps =\n      feeBps ||\n      (this.platformFeeAndAccounts.feeAccounts.get(outputMintString) ? this.platformFeeAndAccounts.feeBps : 0);\n\n    const now = new Date().getTime();\n\n    // do sort so that it's always the same order for the same inputMint and outputMint and vice versa\n    const inputMintAndOutputMint = [inputMintString, outputMintString].sort((a, b) => a.localeCompare(b)).join('');\n\n    const routeCache = this.routeCache.get(inputMintAndOutputMint);\n\n    const inputRouteSegment = computeInputRouteSegments({\n      inputMint: inputMintString,\n      outputMint: outputMintString,\n      tokenRouteSegments: this.tokenRouteSegments,\n      intermediateTokens: this.intermediateTokens,\n    });\n\n    let shouldBustCache = false;\n    // special -1 condition to not fetch\n    if (this.routeCacheDuration === -1) {\n      shouldBustCache = false;\n    } else if (this.routeCacheDuration === 0) {\n      shouldBustCache = true;\n    } else {\n      if (routeCache) {\n        const { fetchTimestamp } = routeCache;\n        if (now - fetchTimestamp > this.routeCacheDuration) {\n          shouldBustCache = true;\n        }\n      } else {\n        shouldBustCache = true;\n      }\n    }\n\n    if (forceFetch || shouldBustCache) {\n      await fetchAccountInfos(this.connection, inputRouteSegment);\n      this.routeCache.set(inputMintAndOutputMint, {\n        fetchTimestamp: new Date().getTime(),\n      });\n    }\n\n    try {\n      const routesInfos = processInputRouteSegmentToRoutesInfos({\n        inputRouteSegment: inputRouteSegment,\n        inputMint: inputMint,\n        outputMint: outputMint,\n        amount: inputAmount,\n        getDepositAndFeeForRoute: this.getDepositAndFeesForUser,\n        onlyDirectRoutes,\n        slippage,\n        platformFeeBps,\n        filterTopNResult,\n      });\n\n      return {\n        routesInfos,\n        /* indicate if the result is fetched or get from cache */\n        cached: !(forceFetch || shouldBustCache),\n      };\n    } catch (e) {\n      throw e;\n    } finally {\n      // clear cache if it is expired\n      this.routeCache.forEach(({ fetchTimestamp }, key) => {\n        if (fetchTimestamp - now > this.routeCacheDuration) {\n          this.routeCache.delete(key);\n        }\n      });\n    }\n  }\n\n  setUserPublicKey(userPublicKey: Keypair | PublicKey) {\n    this.user = userPublicKey;\n    const owner = new Owner(this.user);\n    this.serumOpenOrdersPromise = this.shouldLoadSerumOpenOrders\n      ? Jupiter.findSerumOpenOrdersForOwner({\n          connection: this.connection,\n          cluster: this.cluster,\n          userPublicKey: owner.publicKey,\n        })\n      : Promise.resolve(new Map());\n  }\n\n  /**\n   * The token route segments contains all the routes and the market meta information.\n   */\n  static async fetchTokenRouteSegments(connection: Connection, cluster: Cluster, marketUrl?: string) {\n    const marketCaches = await fetchMarketCache(marketUrl || MARKETS_URL[cluster]);\n    const amms = await getAllAmms(connection, marketCaches);\n\n    const tokenRouteSegments = getTokenRouteSegments(amms);\n\n    return tokenRouteSegments;\n  }\n\n  /**\n   * This generate a routeMap which represents every possible output token mint for a given input token mint.\n   * For example, we have SOL to USDC and this pairs have many routings like\n   * SOL => USDT\n   * USDT => USDC\n   * SOL => USDC\n   *\n   * From here we know that we can have 2 different routing of SOL => USDC.\n   * We do single level routing map but for all coins which result in the route map below:\n   * SOL => USDT, USDC\n   * USDT => SOL\n   * USDC => SOL, USDT\n   *\n   * From this route map we can map out all possible route from one to another by checking the intersection.\n   */\n  getRouteMap(onlyDirectRoutes?: boolean) {\n    return computeRouteMap(this.tokenRouteSegments, this.intermediateTokens, onlyDirectRoutes);\n  }\n\n  /**\n   * Query existing open order account, this query is slow.\n   * We suggest to fetch this in the background.\n   */\n  static findSerumOpenOrdersForOwner = async ({\n    userPublicKey,\n    cluster,\n    connection,\n  }: {\n    userPublicKey: PublicKey;\n    cluster: Cluster;\n    connection: Connection;\n  }) => {\n    const newMarketToOpenOrdersAddress: SerumOpenOrdersMap = new Map();\n\n    if (userPublicKey) {\n      const programId = cluster === 'mainnet-beta' ? MAINNET_SERUM_DEX_PROGRAM : DEVNET_SERUM_DEX_PROGRAM;\n\n      const allOpenOrders = await OpenOrders.findForOwner(connection, userPublicKey, programId);\n\n      allOpenOrders.forEach((openOrders) => {\n        newMarketToOpenOrdersAddress.set(openOrders.market.toString(), openOrders.address);\n      });\n    }\n    return newMarketToOpenOrdersAddress;\n  };\n\n  public exchange: (params: {\n    routeInfo: RouteInfo;\n    /**\n     * This will overwrite the default Jupiter.setUser, useful for stateless usage like API\n     */\n    userPublicKey?: PublicKey;\n    /**\n     * This will overwrite the default token ledger, useful for stateless usage like API\n     */\n    tokenLedger?: PublicKey;\n    /**\n     * This will overwrite the default fee account, useful for stateless usage like API\n     */\n    feeAccount?: PublicKey;\n    /**\n     * This will overwrite the default wrapUnwrapSOL, useful for stateless usage like API\n     */\n    wrapUnwrapSOL?: boolean;\n  }) => Promise<{\n    transactions: {\n      setupTransaction?: Transaction;\n      swapTransaction: Transaction;\n      cleanupTransaction?: Transaction;\n    };\n    execute: (params?: ExecuteParams) => Promise<SwapResult>;\n  }> = async ({ routeInfo, userPublicKey, feeAccount, wrapUnwrapSOL, tokenLedger }) => {\n    const { connection, serumOpenOrdersPromise } = this;\n    const user: PublicKey | Keypair | undefined = userPublicKey || this.user;\n    if (!user) {\n      throw new Error('user not found');\n    }\n\n    const owner = new Owner(user);\n\n    const lastMarketInfoIndex = routeInfo.marketInfos.length - 1;\n    const inputMint = routeInfo.marketInfos[0].inputMint;\n    const outputMint = routeInfo.marketInfos[lastMarketInfoIndex].outputMint;\n    const _wrapUnwrapSOL = wrapUnwrapSOL ?? this.wrapUnwrapSOL;\n\n    const [sourceInstruction, ataInstructions, openOrdersInstructions] = await Promise.all([\n      inputMint.equals(WRAPPED_SOL_MINT) && _wrapUnwrapSOL\n        ? createAndCloseWSOLAccount({\n            connection,\n            owner,\n            amount: routeInfo.inAmount,\n          })\n        : Token.getAssociatedTokenAddress(\n            ASSOCIATED_TOKEN_PROGRAM_ID,\n            TOKEN_PROGRAM_ID,\n            inputMint,\n            owner.publicKey,\n            true,\n          ).then((address) => ({\n            ...getEmptyInstruction(),\n            address,\n          })),\n      routeAtaInstructions({ connection, marketInfos: routeInfo.marketInfos, owner, unwrapSOL: _wrapUnwrapSOL }),\n      Promise.all(\n        routeInfo.marketInfos.map(async ({ amm }) => {\n          if (amm instanceof SerumAmm || amm instanceof SplitTradeAmm) {\n            if (!amm.market) return;\n            return await getOrCreateOpenOrdersAddress(\n              connection,\n              owner.publicKey,\n              amm.market,\n              await serumOpenOrdersPromise,\n            );\n          }\n          return;\n        }),\n      ),\n    ]);\n\n    const instructions = {\n      intermediate: ataInstructions.userIntermediaryTokenAccountResult,\n      destination: ataInstructions.userDestinationTokenAccountResult,\n      openOrders: openOrdersInstructions,\n    };\n\n    const hasOpenOrders = instructions.openOrders.filter(Boolean).length > 0;\n\n    // Construct platform fee\n    feeAccount = feeAccount || this.platformFeeAndAccounts.feeAccounts.get(outputMint.toBase58());\n\n    const platformFee = feeAccount\n      ? {\n          feeBps:\n            this.platformFeeAndAccounts.feeBps ||\n            Math.floor(routeInfo.marketInfos[lastMarketInfoIndex].platformFee.pct * 100),\n          feeAccount,\n        }\n      : undefined;\n\n    const preparedInstructions = await routeToInstructions({\n      user: owner,\n      tokenLedger: tokenLedger || this.tokenLedger,\n      openOrdersAddresses: instructions.openOrders.map((oo) => oo?.address),\n      userSourceTokenAccountAddress: sourceInstruction.address,\n      userIntermediaryTokenAccountAddress: instructions.intermediate?.address,\n      userDestinationTokenAccountAddress: instructions.destination.address,\n      routeInfo,\n      platformFee,\n      quoteMintToReferrer: this.quoteMintToReferrer,\n    });\n\n    const { needCleanup, needSetup } = isSplitSetupRequired(routeInfo.marketInfos, {\n      hasSerumOpenOrderInstruction: hasOpenOrders,\n    });\n\n    const setupTransactionBuilder = new TransactionBuilder(connection, owner.publicKey, owner);\n\n    const transactionBuilder = new TransactionBuilder(connection, owner.publicKey, owner);\n\n    const cleanupTransactionBuilder = new TransactionBuilder(connection, owner.publicKey, owner);\n\n    const ixs = [\n      instructions.intermediate,\n      sourceInstruction,\n      // if source address the same as destination address, then we don't need to setup or cleanup twice, mainly SOL-SOL\n      !instructions.destination.address.equals(sourceInstruction.address) && instructions.destination,\n    ];\n\n    if (needSetup) {\n      if (hasOpenOrders) {\n        instructions.openOrders.forEach((openOrders) => {\n          if (openOrders) {\n            setupTransactionBuilder.addInstruction(openOrders);\n          }\n        });\n      }\n\n      ixs.forEach((instruction) => {\n        if (instruction) {\n          // we cannot put cleanup here because we cannot do cleanup in setupTransaction\n          setupTransactionBuilder.addInstruction({\n            ...instruction,\n            cleanupInstructions: [],\n          });\n\n          if (instruction.cleanupInstructions.length) {\n            const cleanupIx = {\n              ...getEmptyInstruction(),\n              cleanupInstructions: instruction.cleanupInstructions,\n            };\n            if (needCleanup) {\n              cleanupTransactionBuilder.addInstruction(cleanupIx);\n            } else {\n              transactionBuilder.addInstruction(cleanupIx);\n            }\n          }\n        }\n      });\n    } else {\n      if (hasOpenOrders) {\n        instructions.openOrders.forEach((openOrders) => {\n          if (openOrders) {\n            transactionBuilder.addInstruction(openOrders);\n          }\n        });\n      }\n\n      ixs.forEach((instruction) => {\n        if (instruction) {\n          transactionBuilder.addInstruction(instruction);\n        }\n      });\n    }\n\n    transactionBuilder.addInstruction(preparedInstructions);\n\n    const recentBlockHash = (await this.connection.getLatestBlockhash('confirmed')).blockhash;\n\n    const { transaction: setupTransaction } = await setupTransactionBuilder.build(recentBlockHash);\n\n    const { transaction } = await transactionBuilder.build(recentBlockHash);\n\n    const { transaction: cleanupTransaction } = await cleanupTransactionBuilder.build(recentBlockHash);\n\n    const [setupTransactionObject, swapTransactionObject, cleanupTransactionObject] = [\n      setupTransaction.instructions.length ? setupTransaction : undefined,\n      transaction,\n      cleanupTransaction.instructions.length ? cleanupTransaction : undefined,\n    ];\n\n    const setupInstructions = instructions;\n    return {\n      transactions: {\n        setupTransaction: setupTransactionObject,\n        swapTransaction: swapTransactionObject,\n        cleanupTransaction: cleanupTransactionObject,\n      },\n      execute: ({ wallet, onTransaction }: ExecuteParams = {}) =>\n        this.executeInternal({\n          wallet,\n          onTransaction,\n          inputMint,\n          outputMint,\n          sourceInstruction,\n          setupInstructions,\n          setupTransaction: setupTransactionObject,\n          swapTransaction: swapTransactionObject,\n          cleanupTransaction: cleanupTransactionObject,\n          wrapUnwrapSOL: _wrapUnwrapSOL,\n          owner,\n        }),\n    };\n  };\n\n  /** sign, send and await confirmation for an exchange */\n  private async executeInternal({\n    wallet,\n    onTransaction,\n    inputMint,\n    outputMint,\n    sourceInstruction,\n    setupInstructions,\n    setupTransaction,\n    swapTransaction,\n    cleanupTransaction,\n    owner,\n    wrapUnwrapSOL,\n  }: {\n    wallet: ExecuteParams['wallet'];\n    onTransaction?: OnTransaction;\n    inputMint: PublicKey;\n    outputMint: PublicKey;\n    sourceInstruction: Instruction & { address: PublicKey };\n    setupInstructions: SetupInstructions;\n    setupTransaction?: Transaction;\n    swapTransaction: Transaction;\n    cleanupTransaction?: Transaction;\n    wrapUnwrapSOL?: boolean;\n    owner: Owner;\n  }): Promise<SwapResult> {\n    try {\n      const transactions = [setupTransaction, swapTransaction, cleanupTransaction].filter(\n        (tx): tx is Transaction => tx !== undefined,\n      );\n\n      const totalTxs = transactions.length;\n\n      if (owner.signer) {\n        const signer = owner.signer;\n        transactions.forEach((transaction) => {\n          transaction.sign(signer);\n        });\n      } else {\n        if (!wallet) {\n          throw new Error('Signer wallet not found');\n        }\n        if (totalTxs > 1) {\n          await wallet.signAllTransactions(transactions);\n        } else {\n          await wallet.signTransaction(transactions[0]);\n        }\n      }\n\n      if (setupTransaction) {\n        onTransaction?.(getSignature(setupTransaction), totalTxs, 'SETUP');\n\n        await validateTransactionResponse(\n          await transactionSenderAndConfirmationWaiter(this.connection, setupTransaction),\n        );\n      }\n\n      onTransaction?.(getSignature(swapTransaction), totalTxs, 'SWAP');\n\n      let swapError: Error | undefined;\n      let swapResult: SwapResult | undefined = undefined;\n\n      try {\n        const { txid, transactionResponse } = await validateTransactionResponse(\n          await transactionSenderAndConfirmationWaiter(this.connection, swapTransaction),\n        );\n\n        const [sourceTokenBalanceChange, destinationTokenBalanceChange] = getTokenBalanceChangesFromTransactionResponse(\n          {\n            txid,\n            inputMint,\n            outputMint,\n            user: owner.publicKey,\n            sourceAddress: sourceInstruction.address,\n            destinationAddress: setupInstructions.destination.address,\n            transactionResponse,\n            hasWrappedSOL: Boolean(cleanupTransaction) || !wrapUnwrapSOL,\n          },\n        );\n\n        swapResult = {\n          txid,\n          inputAddress: sourceInstruction.address,\n          outputAddress: setupInstructions.destination.address,\n          inputAmount: sourceTokenBalanceChange,\n          outputAmount: destinationTokenBalanceChange,\n        };\n      } catch (e: any) {\n        swapError = e;\n      } finally {\n        if (cleanupTransaction) {\n          onTransaction?.(getSignature(cleanupTransaction), totalTxs, 'CLEANUP');\n\n          // wait for confirmation but swallow error to conserve behaviour\n          await transactionSenderAndConfirmationWaiter(this.connection, cleanupTransaction);\n        }\n      }\n\n      if (swapError || !swapResult) {\n        throw swapError || new Error('Swap failed');\n      }\n\n      // return must be after `finally` clause to ensure we wait what we done in the `finally`\n      return swapResult;\n    } catch (error) {\n      return { error: error as TransactionError };\n    } finally {\n      this.routeCache.clear();\n    }\n  }\n\n  static async getIntermediateTokens() {\n    const intermediateTokensSet = await getTopTokens();\n    for (const swapProtocolToken of SWAP_PROTOCOL_TOKENS) {\n      intermediateTokensSet.add(swapProtocolToken);\n    }\n    const saberDecimalAmms = getSaberWrappedDecimalsAmms();\n\n    saberDecimalAmms.forEach((item) => {\n      intermediateTokensSet.add(item.wrappedToken.addDecimals.mint.toBase58());\n    });\n\n    return Array.from(intermediateTokensSet);\n  }\n\n  static createInitializeTokenLedgerInstruction = createInitializeTokenLedgerInstruction;\n}\n","import { AccountInfo, PublicKey } from '@solana/web3.js';\nimport {\n  ALDRIN_SWAP_V2_PROGRAM_ID,\n  ALDRIN_SWAP_PROGRAM_ID,\n  DEVNET_SERUM_DEX_PROGRAM,\n  MAINNET_SERUM_DEX_PROGRAM,\n  RAYDIUM_AMM_V4_PROGRAM_ID,\n  CROPPER_PROGRAM_ID,\n  CREMA_PROGRAM_ID,\n  SENCHA_PROGRAM_ID,\n  MERCURIAL_SWAP_PROGRAM_ID,\n  LIFINITY_PROGRAM_ID,\n  WHIRLPOOL_PROGRAM_ID,\n  CYKURA_PROGRAM_ID,\n} from '../constants';\nimport { Amm } from './amm';\nimport { SerumMarket, StableSwap } from './market';\nimport { SWAP_PROGRAM_ID as SABER_SWAP_PROGRAM_ID } from '@saberhq/stableswap-sdk';\nimport { SaberAmm } from './saber/saberAmm';\nimport { SerumAmm } from './serum/serumAmm';\nimport { findProgramAddressSync } from '@project-serum/anchor/dist/cjs/utils/pubkey';\nimport { AldrinAmm } from './aldrin/aldrinAmm';\nimport { PROGRAM_ID_TO_LABEL } from './spl-token-swap/splTokenSwapPools';\nimport { SplTokenSwapAmm } from './spl-token-swap/splTokenSwapAmm';\nimport { MercurialAmm } from './mercurial/mercurialAmm';\nimport { RaydiumAmm } from './raydium/raydiumAmm';\nimport { CropperAmm } from './cropper/cropperAmm';\nimport { CremaAmm } from './crema/cremaAmm';\nimport { SenchaAmm } from './sencha/senchaAmm';\nimport { LifinityAmm } from './lifinity/lifinityAmm';\nimport { WhirlpoolAmm } from './whirlpool/whirlpoolAmm';\nimport { CykuraAmm } from './cykura/cykuraAmm';\n\nexport function ammFactory(address: PublicKey, accountInfo: AccountInfo<Buffer>, params?: any): Amm | undefined {\n  const programId = new PublicKey(accountInfo.owner);\n\n  if (programId.equals(MAINNET_SERUM_DEX_PROGRAM) || programId.equals(DEVNET_SERUM_DEX_PROGRAM)) {\n    const decoded = SerumMarket.getLayout(programId).decode(accountInfo.data);\n    if (!decoded.accountFlags.initialized || !decoded.accountFlags.market) {\n      throw new Error('Invalid market');\n    }\n    const serumMarket = new SerumMarket(decoded, 0, 0, {}, programId);\n    return new SerumAmm(serumMarket);\n  } else if (programId.equals(RAYDIUM_AMM_V4_PROGRAM_ID)) {\n    const raydiumAmm = new RaydiumAmm(address, accountInfo, params);\n    if (raydiumAmm.status === 1) {\n      return raydiumAmm;\n    }\n  } else if (programId.equals(MERCURIAL_SWAP_PROGRAM_ID)) {\n    return new MercurialAmm(address, accountInfo, params);\n  } else if (programId.equals(SABER_SWAP_PROGRAM_ID)) {\n    const stableSwap = StableSwap.loadWithData(\n      address,\n      accountInfo.data,\n      findProgramAddressSync([address.toBuffer()], SABER_SWAP_PROGRAM_ID)[0],\n    );\n\n    if (stableSwap.state.isPaused || !stableSwap.state.isInitialized) return;\n\n    return new SaberAmm(stableSwap);\n  } else if (programId.equals(CREMA_PROGRAM_ID)) {\n    return new CremaAmm(address, accountInfo);\n  } else if (programId.equals(ALDRIN_SWAP_PROGRAM_ID) || programId.equals(ALDRIN_SWAP_V2_PROGRAM_ID)) {\n    return new AldrinAmm(address, accountInfo, params);\n  } else if ([...PROGRAM_ID_TO_LABEL.keys()].includes(programId.toBase58())) {\n    const label = PROGRAM_ID_TO_LABEL.get(accountInfo.owner.toBase58()) ?? 'Unknown';\n    return new SplTokenSwapAmm(address, accountInfo, label);\n  } else if (programId.equals(CROPPER_PROGRAM_ID)) {\n    return new CropperAmm(address, accountInfo, params);\n  } else if (programId.equals(SENCHA_PROGRAM_ID)) {\n    const senchaAmm = new SenchaAmm(address, accountInfo);\n    if (senchaAmm.isPaused) return;\n    return senchaAmm;\n  } else if (programId.equals(LIFINITY_PROGRAM_ID)) {\n    return new LifinityAmm(address, accountInfo);\n  } else if (programId.equals(WHIRLPOOL_PROGRAM_ID)) {\n    return new WhirlpoolAmm(address, accountInfo);\n  } else if (programId.equals(CYKURA_PROGRAM_ID)) {\n    return new CykuraAmm(address, accountInfo);\n  }\n  // Not supported by frontend\n  return;\n}\n","import fetch from 'cross-fetch';\n\ntype Address = string;\n\nexport async function getTopTokens() {\n  const topTokens = (await (await fetch('https://cache.jup.ag/top-tokens')).json()) as Address[];\n\n  return new Set(topTokens.filter((_, idx) => idx < 60));\n}\n"],"names":["IDL","version","name","instructions","accounts","isMut","isSigner","args","type","option","defined","kind","fields","types","variants","errors","code","msg","WRAPPED_SOL_MINT","PublicKey","MAINNET_SERUM_DEX_PROGRAM","DEVNET_SERUM_DEX_PROGRAM","MARKETS_URL","devnet","testnet","RAYDIUM_AMM_V4_PROGRAM_ID","ALDRIN_SWAP_PROGRAM_ID","ALDRIN_SWAP_V2_PROGRAM_ID","SABER_ADD_DECIMALS_PROGRAM_ID","CROPPER_PROGRAM_ID","SENCHA_PROGRAM_ID","LIFINITY_PROGRAM_ID","CREMA_PROGRAM_ID","JUPITER_WALLET","MERCURIAL_SWAP_PROGRAM_ID","WHIRLPOOL_PROGRAM_ID","CYKURA_PROGRAM_ID","CYKURA_FACTORY_STATE_ADDRESS","SWAP_PROTOCOL_TOKENS","JUPITER_ERRORS","Object","freeze","TransactionNotConfirmed","BalancesNotExtractedProperly","reduce","accErrors","error","PublicKeyLayout","Layout","constructor","property","layout","blob","super","span","this","getSpan","b","offset","decode","encode","src","toBuffer","publicKey","U64Layout","u64","toArrayLike","Buffer","uint64","uint128","CropperTokenSwapLayout","struct","u8","CropperStateLayout","CROPPER_STATE_ADDRESS","accountInfoToCropperPoolState","address","accountInfo","programId","owner","decoded","data","authority","findProgramAddressSync","isInitialized","Boolean","nonce","ammId","serumProgramId","tokenProgramId","tokenAAccount","tokenBAccount","serumMarket","poolMint","mintA","mintB","Side","Bid","bid","Ask","ask","JUPITER_PROGRAM_ID","JUPITER_PROGRAM","Program","PRODUCTION_TOKEN_LEDGERS","TOKEN_LEDGER","Math","floor","random","length","stableSwapNPoolIntoMercurialExchange","swayLayout","sourceTokenAccount","destinationTokenAccount","userTransferAuthority","swapProgram","swapState","tokenProgram","TOKEN_PROGRAM_ID","poolAuthority","raydiumAmmToRaydiumSwap","raydiumAmm","userSourceTokenAccount","userDestinationTokenAccount","ammAuthority","Uint8Array","from","replace","serumMarketKeys","Error","ammOpenOrders","poolCoinTokenAccount","poolPcTokenAccount","serumBids","serumAsks","serumEventQueue","serumCoinVaultAccount","serumPcVaultAccount","serumVaultSigner","userSourceOwner","marketIntoSerumSwap","market","openOrdersAddress","orderPayerTokenAccountAddress","coinWallet","pcWallet","vaultSigner","createProgramAddressSync","vaultSignerNonce","openOrders","requestQueue","eventQueue","bids","bidsAddress","asks","asksAddress","coinVault","baseVault","pcVault","quoteVault","orderPayerTokenAccount","dexProgram","rent","SYSVAR_RENT_PUBKEY","createMercurialExchangeInstruction","swapLayout","inAmount","minimumOutAmount","tokenLedger","platformFee","_platformFee$feeBps","remainingAccounts","swapTokenAccount","tokenAccounts","push","pubkey","isWritable","prepareRemainingAccounts","feeAccount","instruction","mercurialExchange","BN","feeBps","createSerumSwapInstruction","sourceMint","referrer","_platformFee$feeBps2","side","equals","baseMintAddress","serumSwap","createTokenSwapInstruction","tokenSwapState","isStep","_platformFee$feeBps3","swapSource","swapDestination","tokenAccountA","tokenAccountB","stepTokenSwap","tokenSwap","tokenSwapProgram","swap","source","destination","poolToken","poolFee","createSenchaSwapInstruction","poolState","_platformFee$feeBps4","token0Mint","token0Reserves","token1Reserves","feesSource","feesDestination","token0Fees","token1Fees","senchaExchange","userAuthority","inputUserAccount","inputTokenAccount","inputFeesAccount","outputUserAccount","outputTokenAccount","outputFeesAccount","createCropperSwapInstruction","_platformFee$feeBps5","cropperTokenSwap","createRaydiumSwapInstruction","_platformFee$feeBps6","raydiumSwapV2","createAldrinSwapInstruction","_platformFee$feeBps7","userBaseTokenAccount","userQuoteTokenAccount","baseTokenMint","aldrinSwap","pool","poolSigner","baseTokenVault","quoteTokenVault","feePoolTokenAccount","walletAuthority","createAldrinV2SwapInstruction","curve","_platformFee$feeBps8","aldrinV2Swap","createCremaSwapInstruction","_platformFee$feeBps9","cremaTokenSwap","poolSourceTokenAccount","poolDestinationTokenAccount","poolTicksAccount","ticksKey","createRiskCheckAndFeeInstruction","_platformFee$feeBps10","riskCheckAndFee","createSetTokenLedgerInstruction","tokenAccountAddress","setTokenLedger","tokenAccount","saberPoolIntoSaberSwap","saberPool","sourceMintAddress","feesTokenAccount","state","tokenA","mint","tokenB","adminFeeAccount","reserve","config","swapProgramID","swapAccount","swapAuthority","createSaberSwapInstruction","stableSwap","_platformFee$feeBps11","saberSwap","createSaberAddDecimalsDepositInstruction","addDecimals","_platformFee$feeBps12","saberAddDecimalsDeposit","addDecimalsProgram","wrapper","wrapperMint","wrapperUnderlyingTokens","userUnderlyingTokens","userWrappedTokens","createSaberAddDecimalsWithdrawInstruction","_platformFee$feeBps13","saberAddDecimalsWithdraw","createLifinitySwapInstruction","_platformFee$feeBps14","tokenAMint","lifinityTokenSwap","amm","sourceInfo","destinationInfo","pythAccount","pythPcAccount","configAccount","createCykuraSwapInstruction","additionalArgs","_platformFee$feeBps15","cykuraSwap","signer","factoryState","poolAddress","inputVault","outputVault","lastObservationState","coreProgram","concat","swapAccountMetas","nextObservationState","createWhirlpoolSwapInstruction","_platformFee$feeBps16","tokenOwnerAccountA","tokenOwnerAccountB","aToB","whirlpoolSwap","tokenAuthority","whirlpool","tokenVaultA","tokenVaultB","tickArray0","tickArray1","tickArray2","oracle","getSaberWrappedDecimalsAmms","addDecimalsJson","map","addDecimalJson","underlying","underlyingDecimals","decimals","SaberAddDecimalsAmm","WrappedToken","multiplier","getOutputAmount","inputAmount","inputMint","calculateWithdrawOutputAmount","calculateDepositOutputAmount","toString","JSBI","multiply","BigInt","divide","wrappedToken","id","label","shouldPrefetch","toBase58","getAccountsForUpdate","Array","update","_accountInfoMap","getQuote","amount","notEnoughLiquidity","outAmount","toNumber","feeAmount","feeMint","feePct","priceImpactPct","createSwapInstructions","swapParams","reserveTokenMints","getTwoPermutations","array","acc","item","forEach","otherItem","chunks","size","apply","ceil","_","index","slice","async","chunkedGetMultipleAccountInfos","connection","pks","batchChunkSize","maxAccountsChunkSize","Promise","all","batch","batchPubkeys","pubkeys","methodName","_buildArgs","commitment","_rpcBatchRequest","then","batchResults","res","result","value","catch","e","flat","mapAddressToAccountInfos","accountInfoMap","addresses","get","tokenAccountsToJSBIs","AMM_INFO_LAYOUT_V4","nu64","RaydiumAmm","ammAccountInfo","params","coinMint","pcMint","status","ammTargetOrders","coinReserve","pcReserve","calculator","coinMintAddress","pcMintAddress","keys","swapFeeNumerator","swapFeeDenominator","Decimal","div","TokenSwapConstantProduct","Fraction","ZERO_FRACTION","static","serumMarketInfo","decodedMarket","Market","getLayout","poolCoinTokenAccountInfo","poolPcTokenAccountInfo","ammOpenOrdersAccountInfo","coinAmount","pcAmount","tokenAmountAccessor","OpenOrders","fromAccountInfo","add","baseTokenTotal","sub","String","needTakePnlCoin","quoteTokenTotal","needTakePnlPc","tokenAccountInfo","fromBuffer","outputIndex","exchange","expectedOutputAmount","fees","priceImpact","STABLE_MARKET_ADDRESSES","getL2","orderbook","descending","isBids","key","quantity","slab","items","price","ushrn","priceLotsToDecimal","baseLotSize","_decoded","isZero","numerator","denominator","quotient","rem","umod","gcd","divideBnToDecimal","mul","quoteLotSize","_baseSplTokenMultiplier","_quoteSplTokenMultiplier","SerumAmm","_orderbooks","orderbooks","asksAccountInfo","bidsAccountInfo","Orderbook","destinationMint","outAmountMeta","fromAmount","fromMint","toMint","takerFeePct","includes","quoteMintAddress","pcIn","coinOut","bestPrice","worstPrice","totalCost","totalCoins","quoteSizeLots","quoteSizeLotsToNumber","availablePc","ZERO","baseSizeLots","baseSizeLotsToNumber","lotPrice","lotQuantity","equal","orderCoinAmount","orderPcAmount","greaterThanOrEqual","numberLotsPurchasable","subtract","bestPriceDecimal","bestPriceSizeLots","totalCostSizeLots","lessThanOrEqual","minimum","in","out","forecastBuy","coinIn","pcOut","totalCoin","availableCoin","numberLotsCanSell","totalCoinAmountToSell","pcOutInteger","worstPriceDecimal","minus","greaterThan","round","forecastSell","getOutAmountMeta","minInAmount","minOutAmount","_swapParams$quoteMint","quoteMintToReferrer","SplitTradeAmm","firstAmm","secondAmm","portion1","portion2","ammIds","split","isSplitSupported","firstAmmTwoPermutations","secondAmmTwoPermutations","firstAmmTwoPermutation","secondAmmTwoPermutation","every","setPortions","portion","sort","a","join","quoteParams","_firstQuote$minInAmou","_secondQuote$minInAmo","_firstQuote$minOutAmo","_secondQuote$minOutAm","sourceMintString","bestSolution","firstQuote","undefined","secondQuote","p","firstAmount","secondAmount","firstAmmFee","secondAmmFee","isValidRoute","ammA","ammB","SaberAmm","Stable","TWO","calculateAmpFactor","ONE","trade","tokenAccountInfos","info","deserializeAccount","asFraction","toFixed","inputIndex","setAmp","Percentage","number","fromFraction","toDecimalPlaces","num","denom","toDecimal","eq","p2","denomGcd","denomLcm","p1DenomAdjustment","p2DenomAdjustment","p1NumeratorAdjusted","p2NumeratorAdjusted","newNumerator","FEES_LAYOUT","POOL_FIELDS_COMMON","POOL_LAYOUT","POOL_V2_LAYOUT","STABLE_CURVE_LAYOUT","accountInfoToAldrinPoolState","isV2","curveObject","curveType","quoteTokenMint","feeBaseAccount","feeQuoteAccount","traderFee","tradeFeeNumerator","tradeFeeDenominator","ownerFee","ownerTradeFeeNumerator","ownerTradeFeeDenominator","AldrinAmm","amp","TokenSwapStable","STEP_TOKEN_SWAP_PROGRAM_ID","PROGRAM_ID_TO_LABEL","Map","TokenSwapLayout","StepTokenSwapLayout","CurveType","SplTokenSwapAmm","swapStateAccountInfo","tokenSwapAccountInfo","tokenSwapData","tokenPool","ownerWithdrawFeeNumerator","ownerWithdrawFeeDenominator","curveParameters","poolNonce","accountInfoToTokenSwapState","ConstantProduct","FEE_DENOMINATOR","pow","MercurialSwapLayout","u32","accountInfoToMercurialSwapLayout","tokenAccountsLength","precisionMultipliers","precisionMultiplierA","precisionMultiplierB","precisionMultiplierC","precisionMultiplierD","tokenAccountC","tokenAccountD","amplificationCoefficient","feeNumerator","precisionFactor","MercurialAmm","precisionMultiplier","filter","x","findIndex","tokenMints","tokenMint","decodeSwapLayout","CropperAmm","getAccountInfo","stateOwner","feeOwner","initialSupply","returnFeeNumerator","fixedFeeNumerator","feeDenominator","stateAccountInfoToCropperState","tokenAFeeAccount","tokenBFeeAccount","decodePoolState","accountInfoToCremaPoolState","TokenSwapAccountLayout","swapTokenA","swapTokenB","tokenBMint","fee","currentSqrtPrice","currentLiquity","CremaAmm","ticks","ticksAccountInfo","ticksInfo","parseTicksAccount","preSwapA","preSwapB","revert","amountOut","feeUsed","impact","amountIn","calculateSwapA2B","currentPriceA","amountUsed","abs","lessThan","calculateSwapB2A","currentPriceB","SenchaSwapLayout","SenchaAmm","isPaused","bump","token1Mint","tradeFeeKbps","accountInfoToSenchaPoolState","LifinityAmm","poolInfo","accountInfos","LIFINITY_AMM_LAYOUT","poolFeeAccount","poolCoinMint","poolPcMint","accountInfoLifinitySwapLayout","poolCoinDecimal","poolPcDecimal","poolMintDecimal","pythBaseDecimal","idx","account","tradeDirection","TradeDirection","AtoB","BtoA","pyth","pythPc","coinBalance","pcBalance","getParsedData","getCurveAmount","publishSlot","amountSwapped","feePercent","parseWhirlpoolSafe","whirlpoolData","parseWhirlpool","WhirlpoolAmm","whirlpoolAccountInfo","tickArrays","tickPks","feeRate","getTickArrayPks","clear","tickArrayPk","tickArrayAddress","tickArrayAccountInfo","tickArray","parseTickArray","set","swapQuote","getSwapQuote","tokenAmount","isInput","Number","quotePrice","currentPrice","sqrtPrice","tokenMintA","getTickArrayPublicKeysForSwap","tickCurrentIndex","tickSpacing","tokenMintB","SolanaTickDataProvider","program","bitmapCache","tickCache","accountsToFetch","bitmaps","tickCurrent","compressed","wordPos","tickPosition","bitmapsToFetch","WORD_POS_MIN","TickMath","MIN_TICK","WORD_POS_MAX","MAX_TICK","minWord","max","maxWord","min","i","getBitmapAddressSync","fetchedBitmaps","tickBitmapState","fetchMultiple","tickAddresses","_fetchedBitmaps$i","currentWordPos","wordArray","word","generateBitmapWord","eqn","j","shrn","and","tickAddress","getTickAddressSync","fetchedTicks","tickState","fetchedTick","tick","liquidityNet","lazyLoadAccountsToCache","bitmap","tickAddressesToFetch","_bitmaps$i$word","_bitmaps$i","getTick","savedTick","TICK_SEED","token0","token1","u32ToSeed","BITMAP_SEED","u16ToSeed","getBitmap","savedBitmap","nextInitializedTickWithinOneWord","lte","bitPos","cachedBitmap","next","nextBit","initialized","nextInitializedBit","buildTick","updateCachedAccountInfos","bitmapAddress","bitmapAccountInfo","coder","tickStateAccountInfo","CYCLOS_CORE","anchor","Provider","skipPreflight","CykuraAmm","accountInfoOrPoolState","tickDataProvider","tokens","vaults","sqrtPriceX32","liquidity","Token","CykuraPool","Pool","vault0","ASSOCIATED_TOKEN_PROGRAM_ID","vault1","poolAccountInfo","inputToken","currentOutAmount","newPool","CurrencyAmount","fromRawAmount","priceImpactDecimal","sqrtRatioX32","OBSERVATION_SEED","observationIndex","observationCardinalityNext","isPlatformFeeSupported","amms","firstMarket","secondMarket","createAndCloseWSOLAccount","cleanupInstructions","signers","toAccount","getAssociatedTokenAddress","createAssociatedTokenAccountInstruction","SystemProgram","transfer","fromPubkey","toPubkey","lamports","createSyncNativeInstruction","createCloseAccountInstruction","findOrCreateAssociatedAccountByMint","payer","mintAddress","unwrapSOL","associatedToken","associatedTokenProgramId","TransactionInstruction","alloc","routeAtaInstructions","marketInfos","userIntermediaryTokenAccountResult","userDestinationTokenAccountResult","outputMint","getUserIntermediateTokenAccountAddress","getOrCreateOpenOrdersAddress","user","marketToOpenOrdersAddress","marketAddress","openOrdersAccountInfo","newOpenOrdersAddress","ix","createOpenOrders","systemProgram","createOpenOrdersInstruction","sum","values","NO_PLATFORM_FEE","feeAccounts","getPlatformFeeAccounts","feeAccountOwner","getTokenAccountsByOwner","deserializedtokenAccount","TransactionBuilder","feePayer","addInstruction","recentBlockHash","getLatestBlockhash","blockhash","txFields","recentBlockhash","curr","transaction","Transaction","execute","isKeyPair","sendTransaction","Owner","_owner","isPublicKey","secretKey","wait","time","resolve","setTimeout","extractTokenBalanceChangeFromTransaction","meta","accountKeyIndex","_meta$postTokenBalanc","_meta$postTokenBalanc2","_meta$preTokenBalance","_meta$preTokenBalance2","postBalance","postTokenBalances","find","postTokenBalance","accountIndex","uiTokenAmount","preBalance","preTokenBalances","preTokenBalance","parseInt","diffTokenBalance","message","accountKeys","extractSOLChangeFromTransaction","postBalances","preBalances","getUnixTs","Date","getTime","SEND_OPTIONS","maxRetries","transactionSenderAndConfirmationWaiter","signedTransaction","timeout","pollInterval","sendInterval","sendRetries","rawTransaction","serialize","txid","sendRawTransaction","start","lastSendTimestamp","retries","timestamp","response","any","getTransaction","transactionResponse","getSignature","signature","bs58","validateArray","isArray","TypeError","multiplySize","cache","getIndex","getInputOutputId","getQuoteId","processInputRouteSegmentToRoutesInfos","inputRouteSegment","getDepositAndFeeForRoute","platformFeeBps","slippage","filterTopNResult","onlyDirectRoutes","inputMintString","outputMintString","tradeIdQuoteMap","inputMintInnerMap","routes","maxLevel","walkTheTree","level","walked","outMint","tradeId","quoteMap","quotes","quote","getQuoteMap","filteredAmms","has","arr","callback","ammCrossProtocolPairs","splitTradeAmm","create","mints","_mints","ammsArr","_inputRouteSegment$ge","arrays","validateDimensions","sizeStr","isFinite","toExponential","validateCombinations","validateInput","cachedLoopFunc","loopFunc","indexes","middle","end","repeat","Function","mGetLoopFunc","getLoopFunc","fastCartesian","route","intermediateAmount","outAmountWithSlippage","platformFeeSupported","legs","entries","_tradeIdQuoteMap$get","pct","outAmountAfterFees","legOutAmountWithSlippage","lpFee","getDepositAndFee","priceFactor","marketInfo","validateTransactionResponse","_transactionResponse$","TransactionError","err","parseErrorForTransaction","Jupiter","cluster","tokenRouteSegments","feeCalculator","platformFeeAndAccounts","routeCacheDuration","wrapUnwrapSOL","intermediateTokens","shouldLoadSerumOpenOrders","serumOpenOrdersPromise","routeCache","getDepositAndFees","userPublicKey","hasWrapUnwrapSOL","openOrdersInstructionsPromise","promise","openOrdersInstructions","intermediate","openOrdersDeposits","ooi","ataDeposits","signatureFee","oo","lamportsPerSignature","totalFeeAndDeposits","minimumSOLForTransaction","_item$instructions$le","calculateTransactionDepositAndFee","getDepositAndFeeFromInstructions","getDepositAndFeesForUser","routeInfo","_instructions$interme","lastMarketInfoIndex","_wrapUnwrapSOL","sourceInstruction","ataInstructions","hasOpenOrders","preparedInstructions","openOrdersAddresses","userSourceTokenAccountAddress","userIntermediaryTokenAccountAddress","userDestinationTokenAccountAddress","effectiveQuoteMintToReferrer","mi","isSerumAndRaydium","userTokenAccountAddresses","legInputAmount","legPlatformFee","routeToInstructions","needCleanup","needSetup","hasSerumOpenOrderInstruction","isSplitSetupRequired","setupTransactionBuilder","transactionBuilder","cleanupTransactionBuilder","ixs","cleanupIx","setupTransaction","build","cleanupTransaction","setupTransactionObject","swapTransactionObject","cleanupTransactionObject","setupInstructions","transactions","swapTransaction","wallet","onTransaction","executeInternal","marketUrl","restrictIntermediateTokens","_quoteMintToReferrer","fetchTokenRouteSegments","getRecentBlockhashAndContext","getIntermediateTokens","jupiter","setUserPublicKey","getAccountToAmmMap","accountToAmmMap","tokenRouteSegment","forceFetch","now","inputMintAndOutputMint","localeCompare","inputRouteSegments","inputSegment","outputSegment","inputInnerMap","outputInnerMap","intersectionAmms","computeInputRouteSegments","shouldBustCache","fetchTimestamp","accountInfosMap","accountsToFetchSet","Set","ammMap","innerMap","fetchAccountInfos","routesInfos","cached","delete","findSerumOpenOrdersForOwner","marketCaches","fetch","url","json","fetchMarketCache","firstReserveMint","secondReserveMint","inMint","segments","addSegment","getTokenRouteSegments","marketsCache","marketKeyedAccountInfos","format","rest","marketCacheToAccountInfo","extraKeys","extraKeyedAccountInfos","fetchExtraKeyedAccountInfos","keyedAccountInfo","SerumMarket","accountFlags","SABER_SWAP_PROGRAM_ID","StableSwap","loadWithData","SWAP_PROGRAM_ID","_PROGRAM_ID_TO_LABEL$","senchaAmm","ammFactory","prefetchAmms","getAllAmms","getRouteMap","routeMap","firstLevelOutputs","validOutputMints","firstLevelOutputMint","firstLevelAmms","_tokenRouteSegments$g","secondLevelOutputs","secondLevelOutputMint","secondLevelAmms","firstLevelAmm","secondLevelAmm","computeRouteMap","tx","totalTxs","sign","signAllTransactions","signTransaction","swapError","swapResult","sourceTokenBalanceChange","destinationTokenBalanceChange","sourceAddress","destinationAddress","hasWrappedSOL","getTokenBalanceChangesFromTransactionResponse","inputAddress","outputAddress","outputAmount","intermediateTokensSet","topTokens","getTopTokens","swapProtocolToken","newMarketToOpenOrdersAddress","findForOwner","createInitializeTokenLedgerInstruction","initializeTokenLedger","process"],"mappings":"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"}