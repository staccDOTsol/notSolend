"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("promise-retry"),t=require("@solana/spl-token"),o=require("@solana/web3.js");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e);class s extends Error{constructor(e,t,o){super(e),this.txid=void 0,this.code=void 0,this.txid=t,this.code=o,Object.setPrototypeOf(this,Error.prototype)}}const a="Unknown error, visit the explorer",i="So11111111111111111111111111111111111111112";async function c(e,n){const r=await t.Token.getAssociatedTokenAddress(t.ASSOCIATED_TOKEN_PROGRAM_ID,t.TOKEN_PROGRAM_ID,new o.PublicKey(i),n);return{address:r,accountInfo:await e.getAccountInfo(r)}}exports.TransactionError=s,exports.UNKNOWN_ERROR=a,exports.createAndTransferWSOLInstructions=async function(e,n,r){const s=await c(e,n),a=[];s.accountInfo||a.push(t.Token.createAssociatedTokenAccountInstruction(t.ASSOCIATED_TOKEN_PROGRAM_ID,t.TOKEN_PROGRAM_ID,new o.PublicKey(i),s.address,n,n)),a.push(o.SystemProgram.transfer({fromPubkey:n,toPubkey:s.address,lamports:r})),a.push(t.Token.createSyncNativeInstruction(t.TOKEN_PROGRAM_ID,s.address));const{blockhash:u,lastValidBlockHeight:l}=await e.getLatestBlockhash(),d=new o.Transaction({feePayer:n,blockhash:u,lastValidBlockHeight:l});return d.add(...a),d},exports.createUnwrapSolInstructions=async function(e,n){const r=await c(e,n),s=[];if(!r.accountInfo)return;s.push(t.Token.createCloseAccountInstruction(t.TOKEN_PROGRAM_ID,r.address,n,n,[]));const{blockhash:a,lastValidBlockHeight:i}=await e.getLatestBlockhash(),u=new o.Transaction({feePayer:n,blockhash:a,lastValidBlockHeight:i});return u.add(...s),u},exports.deserializeAccount=e=>{if(null==e||0==e.length)return;const n=t.AccountLayout.decode(e);return n.mint=new o.PublicKey(n.mint),n.owner=new o.PublicKey(n.owner),n.amount=t.u64.fromBuffer(n.amount),0===n.delegateOption?(n.delegate=null,n.delegatedAmount=new t.u64(0)):(n.delegate=new o.PublicKey(n.delegate),n.delegatedAmount=t.u64.fromBuffer(n.delegatedAmount)),n.isInitialized=0!==n.state,n.isFrozen=2===n.state,1===n.isNativeOption?(n.rentExemptReserve=t.u64.fromBuffer(n.isNative),n.isNative=!0):(n.rentExemptReserve=null,n.isNative=!1),n.closeAuthority=0===n.closeAuthorityOption?null:new o.PublicKey(n.closeAuthority),n},exports.parseErrorForTransaction=function(e){var t;const o=[];if(null!=e&&e.meta&&e.meta.logMessages&&e.meta.logMessages.forEach((e=>{const t=/Error: (.*)/gm;let n;for(;null!==(n=t.exec(e));)n.index===t.lastIndex&&t.lastIndex++,n.length>1&&o.push(n[1])})),o.length>0)return{message:o.join(",")};const n=null==e||null===(t=e.meta)||void 0===t?void 0:t.err;let r;if(JSON.stringify(n),n&&"string"!=typeof n){const t=n.InstructionError,[o,{Custom:i}]=t;if(r=i,null!=e&&e.meta&&e.meta.logMessages){var s;const o=function(e,t){for(let o=0;o<e.length;o++){const n=e[o].match(new RegExp(`Program ([1-9A-HJ-NP-Za-km-z]{32,44}) failed: custom program error: 0x${t.toString(16)}`));if(n)return n[1]}}(null===(s=e.meta)||void 0===s?void 0:s.logMessages,r);if(o)return"11111111111111111111111111111111"===o?function(e){const t=e[1].Custom;let o="";switch(t){case 0:o="An account with the same address already exists";case 1:o="The account does not have enough SOL to perform the operation";default:o=a}return{code:t,programId:"11111111111111111111111111111111",message:o}}(t):{message:a,programId:o,code:r}}}return{message:"string"==typeof n?n:a,code:r}},exports.pollForConfirmedTransaction=async function(e,t){return r.default((async o=>{const n=await e.getTransaction(t,{commitment:"confirmed"});return n||o(new s("Transaction was not confirmed",t)),n}),{retries:30,minTimeout:500}).catch((()=>null))};
//# sourceMappingURL=optimist.cjs.production.min.js.map
